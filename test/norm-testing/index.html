<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen EXTREMO - Norma de Testing BBVA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-tertiary: #1a1a24;
            --bg-card: #14141e;
            --accent-red: #dc2626;
            --accent-orange: #ea580c;
            --accent-amber: #d97706;
            --accent-purple: #9333ea;
            --accent-pink: #db2777;
            --accent-cyan: #06b6d4;
            --accent-emerald: #10b981;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --border-color: #2d2d3a;
            --glow-red: 0 0 30px rgba(220, 38, 38, 0.3);
            --glow-purple: 0 0 25px rgba(147, 51, 234, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .bg-pattern {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: 
                radial-gradient(ellipse at 20% 80%, rgba(220, 38, 38, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(147, 51, 234, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(234, 88, 12, 0.05) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 2.5rem;
            padding: 2.5rem 2rem;
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
            border-radius: 24px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-red), var(--accent-orange), var(--accent-purple), var(--accent-red));
            background-size: 300% 100%;
            animation: gradient-shift 4s ease infinite;
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .logo-icon {
            width: 80px; height: 80px;
            background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: var(--glow-red);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(220, 38, 38, 0.3); }
            50% { box-shadow: 0 0 40px rgba(220, 38, 38, 0.5); }
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-top: 0.5rem;
        }

        .extreme-badge {
            display: inline-block;
            padding: 0.4rem 1.2rem;
            background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            letter-spacing: 1px;
            color: white;
            margin-top: 1rem;
            animation: pulse-badge 1.5s ease-in-out infinite;
        }

        @keyframes pulse-badge {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .warning-banner {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.15), rgba(234, 88, 12, 0.1));
            border: 2px solid var(--accent-red);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            text-align: left;
        }

        .warning-banner h3 {
            color: var(--accent-red);
            font-size: 1.1rem;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .warning-banner ul {
            color: var(--text-secondary);
            font-size: 0.9rem;
            padding-left: 1.5rem;
            line-height: 1.8;
        }

        .warning-banner li strong {
            color: var(--accent-orange);
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            padding: 1.2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card.correct-stat { border-color: var(--accent-emerald); }
        .stat-card.incorrect-stat { border-color: var(--accent-red); }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 600;
        }

        .stat-value.neutral { background: linear-gradient(135deg, var(--accent-red), var(--accent-orange)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-value.correct { color: var(--accent-emerald); }
        .stat-value.incorrect { color: var(--accent-red); }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.3rem;
        }

        .progress-container {
            background: var(--bg-tertiary);
            border-radius: 10px;
            height: 10px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-red), var(--accent-orange));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .question-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .question-card.answered-correct { border-color: var(--accent-emerald); box-shadow: 0 0 25px rgba(16, 185, 129, 0.2); }
        .question-card.answered-incorrect { border-color: var(--accent-red); box-shadow: var(--glow-red); }

        .question-header {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .question-number {
            background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
            color: white;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 10px;
            font-size: 0.85rem;
        }

        .question-category {
            font-size: 0.8rem;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
        }

        .question-type {
            font-size: 0.7rem;
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .question-type.scenario { background: var(--accent-pink); color: white; }
        .question-type.trap { background: var(--accent-red); color: white; }
        .question-type.numerical { background: var(--accent-cyan); color: black; }
        .question-type.combined { background: var(--accent-purple); color: white; }
        .question-type.negative { background: var(--accent-orange); color: white; }
        .question-type.sequence { background: var(--accent-amber); color: black; }

        .difficulty-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            font-weight: 600;
        }
        .difficulty-badge.extreme { background: linear-gradient(135deg, #dc2626, #7f1d1d); color: white; animation: pulse-badge 2s ease-in-out infinite; }
        .difficulty-badge.expert { background: #dc2626; color: white; }
        .difficulty-badge.hard { background: var(--accent-orange); color: white; }

        .question-text {
            font-size: 1.05rem;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        .scenario-box {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.08), rgba(147, 51, 234, 0.08));
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-left: 4px solid var(--accent-red);
            border-radius: 12px;
            padding: 1.2rem;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .scenario-box strong { color: var(--accent-orange); }
        .scenario-box .highlight { background: rgba(234, 88, 12, 0.2); padding: 0.1rem 0.3rem; border-radius: 3px; }

        .options-list { display: flex; flex-direction: column; gap: 0.75rem; }

        .option {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem 1.2rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover:not(.disabled) {
            border-color: var(--accent-orange);
            background: rgba(234, 88, 12, 0.1);
            transform: translateX(4px);
        }

        .option.correct { border-color: var(--accent-emerald); background: rgba(16, 185, 129, 0.15); }
        .option.incorrect { border-color: var(--accent-red); background: rgba(220, 38, 38, 0.15); }
        .option.disabled { cursor: not-allowed; opacity: 0.7; }
        .option.show-correct { border-color: var(--accent-emerald); background: rgba(16, 185, 129, 0.1); }

        .option-letter {
            width: 38px; height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .option:hover:not(.disabled) .option-letter { background: var(--accent-orange); color: white; }
        .option.correct .option-letter { background: var(--accent-emerald); color: white; }
        .option.incorrect .option-letter { background: var(--accent-red); color: white; }
        .option.show-correct .option-letter { background: var(--accent-emerald); color: white; }

        .option-text { flex: 1; color: var(--text-primary); font-size: 0.95rem; line-height: 1.5; }

        .option-feedback { font-size: 0.85rem; font-weight: 500; margin-left: auto; flex-shrink: 0; }
        .option-feedback.correct { color: var(--accent-emerald); }
        .option-feedback.incorrect { color: var(--accent-red); }

        .feedback-message {
            margin-top: 1.5rem;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 500;
        }

        .feedback-message.correct { background: rgba(16, 185, 129, 0.15); border: 1px solid var(--accent-emerald); color: var(--accent-emerald); }
        .feedback-message.incorrect { background: rgba(220, 38, 38, 0.15); border: 1px solid var(--accent-red); color: var(--accent-red); }

        .feedback-icon { font-size: 1.5rem; }

        .explanation {
            margin-top: 1rem;
            padding: 1.2rem;
            background: rgba(147, 51, 234, 0.08);
            border-left: 3px solid var(--accent-purple);
            border-radius: 0 10px 10px 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .explanation strong { color: var(--accent-orange); }
        .explanation .trap-warning { color: var(--accent-red); font-weight: 600; }
        .explanation .key-point { color: var(--accent-cyan); }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            padding: 0.9rem 2rem;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary { background: linear-gradient(135deg, var(--accent-red), var(--accent-orange)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--glow-red); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-secondary:hover { border-color: var(--accent-orange); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .question-nav {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(42px, 1fr));
            gap: 0.4rem;
            padding: 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            margin-bottom: 2rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .nav-btn {
            width: 42px; height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-btn:hover { border-color: var(--accent-orange); color: var(--accent-orange); }
        .nav-btn.current { background: linear-gradient(135deg, var(--accent-red), var(--accent-orange)); border-color: transparent; color: white; }
        .nav-btn.correct { background: var(--accent-emerald); border-color: transparent; color: white; }
        .nav-btn.incorrect { background: var(--accent-red); border-color: transparent; color: white; }

        .results-container { text-align: center; padding: 3rem; }
        .results-score { font-size: 5rem; font-weight: 700; background: linear-gradient(135deg, var(--accent-red), var(--accent-orange)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 1rem; }
        .results-grade { font-size: 2rem; margin-bottom: 2rem; }
        .results-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin: 2rem 0; }
        .result-stat { background: var(--bg-tertiary); padding: 1.5rem; border-radius: 14px; }
        .result-stat-value { font-family: 'JetBrains Mono', monospace; font-size: 2.2rem; font-weight: 600; }
        .result-stat-value.correct { color: var(--accent-emerald); }
        .result-stat-value.incorrect { color: var(--accent-red); }
        .result-stat-value.unanswered { color: var(--accent-amber); }

        .start-screen { text-align: center; padding: 3rem; }
        .start-screen h2 { font-size: 1.8rem; margin-bottom: 1.5rem; color: var(--accent-orange); }

        .start-info { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 2rem 0; text-align: left; }
        .info-item { background: var(--bg-tertiary); padding: 1.2rem; border-radius: 14px; display: flex; align-items: center; gap: 1rem; border: 1px solid var(--border-color); }
        .info-icon { width: 48px; height: 48px; background: linear-gradient(135deg, var(--accent-red), var(--accent-orange)); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; }
        .info-text h4 { font-size: 0.85rem; color: var(--text-muted); font-weight: 400; }
        .info-text p { font-size: 1.05rem; color: var(--text-primary); font-weight: 600; }

        .question-limit { margin: 1.5rem 0; padding: 1.2rem; background: var(--bg-tertiary); border-radius: 14px; border: 1px solid var(--border-color); }
        .question-limit label { display: block; margin-bottom: 0.5rem; color: var(--text-secondary); }
        .question-limit input { width: 100px; padding: 0.6rem; border-radius: 10px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); font-family: 'JetBrains Mono', monospace; font-size: 1rem; text-align: center; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-orange); }

        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .stats-bar { grid-template-columns: repeat(2, 1fr); }
            .header h1 { font-size: 1.5rem; }
            .start-info { grid-template-columns: 1fr; }
            .results-stats { grid-template-columns: 1fr; }
            .navigation { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
        }

        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    
    <div class="container">
        <header class="header">
            <div class="logo-container">
                <div class="logo-icon">üî•</div>
                <div>
                    <h1>Norma de Testing BBVA</h1>
                    <p class="subtitle">Examen de Certificaci√≥n ‚Äî Nivel EXTREMO</p>
                </div>
            </div>
            <div class="extreme-badge">‚ö†Ô∏è DIFICULTAD M√ÅXIMA ‚ö†Ô∏è</div>
        </header>

        <div id="startScreen" class="question-card start-screen">
            <h2>üéØ Evaluaci√≥n de Certificaci√≥n Extrema</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                Este examen est√° dise√±ado para evaluar conocimiento profundo y detallado.<br>
                Incluye trampas, escenarios complejos y preguntas de combinaci√≥n m√∫ltiple.
            </p>

            <div class="warning-banner">
                <h3>‚ö†Ô∏è ADVERTENCIAS DEL EXAMEN</h3>
                <ul>
                    <li><strong>Preguntas trampa:</strong> Varias respuestas parecen correctas pero solo una lo es</li>
                    <li><strong>Preguntas negativas:</strong> "¬øCu√°l NO es correcto?" - Lee con cuidado</li>
                    <li><strong>Valores exactos:</strong> Se requieren n√∫meros precisos (80%, 0%, 12 meses)</li>
                    <li><strong>Escenarios complejos:</strong> M√∫ltiples factores a considerar simult√°neamente</li>
                    <li><strong>Roles espec√≠ficos:</strong> DEV vs PO vs SO vs AO - diferencias sutiles</li>
                    <li><strong>Secuencias:</strong> El orden exacto de procesos importa</li>
                </ul>
            </div>

            <div class="start-info">
                <div class="info-item">
                    <div class="info-icon">üìã</div>
                    <div class="info-text">
                        <h4>Total de preguntas</h4>
                        <p>70 preguntas</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">üéØ</div>
                    <div class="info-text">
                        <h4>Nivel</h4>
                        <p>EXTREMO</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">‚è±Ô∏è</div>
                    <div class="info-text">
                        <h4>Tiempo sugerido</h4>
                        <p>90 minutos</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">‚úÖ</div>
                    <div class="info-text">
                        <h4>Para aprobar</h4>
                        <p>80% m√≠nimo</p>
                    </div>
                </div>
            </div>

            <div class="question-limit">
                <label>N√∫mero de preguntas:</label>
                <input type="number" id="questionLimit" min="10" max="70" value="70">
                <span style="color: var(--text-muted); margin-left: 0.5rem;">(10-70)</span>
            </div>

            <button class="btn btn-primary" onclick="startExam()" style="margin-top: 1.5rem; padding: 1rem 3rem; font-size: 1.1rem;">
                üî• Iniciar Examen Extremo
            </button>
        </div>

        <div id="examScreen" class="hidden">
            <div class="stats-bar">
                <div class="stat-card"><div class="stat-value neutral" id="currentQuestion">1</div><div class="stat-label">Actual</div></div>
                <div class="stat-card correct-stat"><div class="stat-value correct" id="correctCount">0</div><div class="stat-label">Correctas</div></div>
                <div class="stat-card incorrect-stat"><div class="stat-value incorrect" id="incorrectCount">0</div><div class="stat-label">Incorrectas</div></div>
                <div class="stat-card"><div class="stat-value neutral" id="totalQuestions">70</div><div class="stat-label">Total</div></div>
            </div>
            <div class="progress-container"><div class="progress-bar" id="progressBar" style="width: 0%"></div></div>
            <div class="question-nav" id="questionNav"></div>
            <div class="question-card fade-in" id="questionCard">
                <div class="question-header">
                    <span class="question-number" id="questionNumber">Pregunta 1</span>
                    <span class="question-category" id="questionCategory">Categor√≠a</span>
                    <span class="question-type" id="questionType">Tipo</span>
                    <span class="difficulty-badge" id="difficultyBadge">Dificultad</span>
                </div>
                <div id="scenarioBox"></div>
                <p class="question-text" id="questionText">Texto...</p>
                <div class="options-list" id="optionsList"></div>
                <div id="feedbackContainer"></div>
            </div>
            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()">‚Üê Anterior</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">Siguiente ‚Üí</button>
                <button class="btn btn-primary hidden" id="finishBtn" onclick="finishExam()">üèÅ Finalizar</button>
            </div>
        </div>

        <div id="resultsScreen" class="hidden">
            <div class="question-card results-container">
                <h2 style="margin-bottom: 1rem;">Resultados del Examen Extremo</h2>
                <div class="results-score" id="finalScore">0%</div>
                <div class="results-grade" id="gradeText">Calificaci√≥n</div>
                <div class="results-stats">
                    <div class="result-stat"><div class="result-stat-value correct" id="finalCorrect">0</div><div class="stat-label">Correctas</div></div>
                    <div class="result-stat"><div class="result-stat-value incorrect" id="finalIncorrect">0</div><div class="stat-label">Incorrectas</div></div>
                    <div class="result-stat"><div class="result-stat-value unanswered" id="finalUnanswered">0</div><div class="stat-label">Sin responder</div></div>
                </div>
                <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="reviewAnswers()">üìã Revisar Respuestas</button>
                    <button class="btn btn-primary" onclick="restartExam()">üîÑ Nuevo Intento</button>
                </div>
            </div>
        </div>

        <div id="reviewScreen" class="hidden">
            <div class="question-card" style="margin-bottom: 1rem;">
                <h2 style="margin-bottom: 0.5rem;">Revisi√≥n Detallada</h2>
                <p style="color: var(--text-secondary);">An√°lisis de cada pregunta con explicaciones</p>
            </div>
            <div id="reviewContainer"></div>
            <div class="navigation">
                <button class="btn btn-primary" onclick="backToResults()">‚Üê Volver a Resultados</button>
            </div>
        </div>
    </div>

    <script>
        const allQuestions = [
            // ===== ESCENARIOS COMPLEJOS MULTI-FACTOR =====
            {id:1,category:"Escenario Complejo",type:"scenario",difficulty:"extreme",
            scenario:"Sistema <strong>DORA cr√≠tico</strong> con cambio de emergencia. El Quality Gate de Sonar muestra: <span class='highlight'>0 Cr√≠ticos, 1 Mayor, 0 Seguridad</span>. Cobertura: <span class='highlight'>82%</span>. El PO presiona por desplegar hoy porque hay un problema en producci√≥n. El SO ya dio Vo.Bo. verbal.",
            question:"¬øQu√© debe ocurrir seg√∫n la Norma?",
            options:["Proceder con el despliegue porque es emergencia y el SO aprob√≥ verbalmente","El despliegue debe bloquearse autom√°ticamente por el issue Mayor aunque sea emergencia","Proceder porque la cobertura supera el 80% requerido","Escalar al AO para que autorice la excepci√≥n DORA"],
            correct:1,
            explanation:"<span class='trap-warning'>TRAMPA:</span> Aunque es emergencia y hay aprobaci√≥n verbal del SO, el Quality Gate requiere <span class='key-point'>0% Critical, 0% Major, 0% Security</span>. El 1 Mayor bloquea autom√°ticamente. La cobertura (82%) S√ç cumple, pero eso no anula el bloqueo por issues."},

            {id:2,category:"Escenario Complejo",type:"scenario",difficulty:"extreme",
            scenario:"Aplicaci√≥n nueva requiere usar <strong>datos de producci√≥n</strong> en ambiente de desarrollo para pruebas. El equipo tiene acceso a <strong>HAD</strong> para enmascaramiento. El PO dice que ya se hizo antes sin problemas.",
            question:"¬øQu√© combinaci√≥n de requisitos es CORRECTA?",
            options:["Solo enmascaramiento HAD es suficiente si el PO lo autoriza","Requiere enmascaramiento HAD + consentimiento DyD-09 + aprobaci√≥n documentada","Solo se necesita el consentimiento DyD-09 porque HAD ya enmascara","No se pueden usar datos de producci√≥n bajo ninguna circunstancia"],
            correct:1,
            explanation:"<span class='trap-warning'>TRAMPA:</span> 'Ya se hizo antes' no es justificaci√≥n v√°lida. Usar datos reales requiere: 1) <span class='key-point'>Enmascaramiento HAD</span>, 2) <span class='key-point'>Control DyD-09</span> (documento de autorizaci√≥n). Ambos son obligatorios."},

            {id:3,category:"Escenario Complejo",type:"scenario",difficulty:"extreme",
            scenario:"Error encontrado en pruebas E2E. El DEV argumenta que es un <strong>Falso Positivo</strong> porque el requerimiento est√° mal especificado. El PO dice que es un <strong>error real</strong> que debe corregirse. El SO no est√° disponible.",
            question:"¬øQui√©n tiene la autoridad FINAL para clasificar este error como Falso Positivo?",
            options:["El DEV porque tiene el conocimiento t√©cnico","El PO porque es responsable de los requerimientos","El AO porque es el arquitecto del sistema","Solo el SO puede autorizar la clasificaci√≥n como Falso Positivo"],
            correct:3,
            explanation:"Solo el <span class='key-point'>SO (Service Owner)</span> puede autorizar la clasificaci√≥n como Falso Positivo o Error Asumido. Ni el DEV ni el PO tienen esta autoridad. El AO tiene otras responsabilidades (Plan Estrat√©gico, Hacking √âtico)."},

            {id:4,category:"Escenario Complejo",type:"scenario",difficulty:"extreme",
            scenario:"Componente de terceros (librer√≠a open source) necesita actualizarse por vulnerabilidad cr√≠tica. El proveedor dice que ya pas√≥ sus propias pruebas de seguridad certificadas.",
            question:"¬øQu√© pruebas son OBLIGATORIAS seg√∫n la Norma, independientemente de las certificaciones del proveedor?",
            options:["Ninguna adicional si el proveedor tiene certificaci√≥n ISO 27001","Solo SCA para verificar obsolescencia","SCA + SAST + Verificaci√≥n de integridad","Solo SAST porque es una vulnerabilidad de seguridad"],
            correct:2,
            explanation:"Para componentes de terceros siempre se requieren: <span class='key-point'>SCA</span> (obsolescencia y licencias), <span class='key-point'>SAST</span> (vulnerabilidades), y <span class='key-point'>verificaci√≥n de integridad</span> (tampering). Las certificaciones del proveedor NO eximen de estas pruebas."},

            {id:5,category:"Escenario Complejo",type:"scenario",difficulty:"extreme",
            scenario:"Sistema <strong>SOX</strong> pas√≥ todas las pruebas hace <span class='highlight'>10 meses</span>. No ha habido cambios. Auditor√≠a solicita evidencias de pruebas.",
            question:"¬øLas evidencias estar√°n disponibles?",
            options:["No, las evidencias expiraron a los 3 meses","S√≠, sistemas DORA/SOX retienen evidencias por 12 meses","S√≠, pero solo si hubo m√°s de 10 ejecuciones","No, porque no hubo cambios recientes que generen nuevas evidencias"],
            correct:1,
            explanation:"<span class='key-point'>Sistemas DORA/SOX</span> tienen retenci√≥n especial: <span class='key-point'>12 meses</span> de evidencias. Los sistemas regulares son 3 meses o 10 ejecuciones. El sistema SOX de 10 meses S√ç tendr√° evidencias."},

            // ===== PREGUNTAS NUM√âRICAS EXACTAS =====
            {id:6,category:"Valores Exactos",type:"numerical",difficulty:"extreme",
            question:"¬øCu√°les son los umbrales EXACTOS del Quality Gate de Sonar para poder desplegar?",
            options:["<5% Critical, <5% Major, <5% Security","0% Critical, 0% Major, 0% Security","<1% Critical, <1% Major, 0% Security","0% Critical, <5% Major, 0% Security"],
            correct:1,
            explanation:"Los umbrales son <span class='key-point'>exactamente 0%</span> para los tres: Critical, Major y Security. No hay tolerancia. Cualquier valor mayor bloquea el despliegue autom√°ticamente."},

            {id:7,category:"Valores Exactos",type:"numerical",difficulty:"extreme",
            question:"Para pruebas unitarias, ¬øcu√°l es la combinaci√≥n CORRECTA de requisitos?",
            options:["‚â•80% cobertura, 100% pass rate","‚â•90% cobertura, ‚â•95% pass rate","100% cobertura, 100% pass rate","‚â•75% cobertura, 100% pass rate"],
            correct:0,
            explanation:"Pruebas unitarias requieren: <span class='key-point'>‚â•80% cobertura</span> + <span class='key-point'>100% pass rate</span>. No se requiere 90% ni 100% de cobertura, pero el pass rate s√≠ debe ser 100%."},

            {id:8,category:"Valores Exactos",type:"numerical",difficulty:"expert",
            question:"¬øCu√°ntos tipos de pruebas debe contemplar el Plan de Pruebas por cada Servicio N2?",
            options:["5 tipos de pruebas","7 tipos de pruebas","10 tipos de pruebas","12 tipos de pruebas"],
            correct:2,
            explanation:"El Plan de Pruebas debe contemplar <span class='key-point'>10 tipos de pruebas</span> por cada Servicio N2: Unitarias, Integraci√≥n, Funcionales, Regresi√≥n, Humo, Rendimiento, Seguridad (SAST/DAST), Hacking √âtico, Aceptaci√≥n, Monitoreo Fraude."},

            {id:9,category:"Valores Exactos",type:"numerical",difficulty:"extreme",
            question:"¬øCu√°l es el per√≠odo de retenci√≥n de evidencias para un sistema NO cr√≠tico (no DORA/SOX)?",
            options:["3 meses o 10 ejecuciones, lo que ocurra primero","3 meses o 10 ejecuciones, lo que ocurra despu√©s","6 meses fijos","12 meses como todos los sistemas"],
            correct:0,
            explanation:"Sistemas regulares: <span class='key-point'>3 meses o 10 ejecuciones, lo que ocurra primero</span>. Solo DORA/SOX tienen 12 meses. El criterio es 'lo que ocurra primero', no despu√©s."},

            // ===== PREGUNTAS TRAMPA DE ROLES =====
            {id:10,category:"Roles Trampa",type:"trap",difficulty:"extreme",
            question:"¬øQui√©n EJECUTA las pruebas de Hacking √âtico?",
            options:["El equipo DEV","El PO","El AO","Un equipo externo de seguridad independiente"],
            correct:2,
            explanation:"<span class='trap-warning'>TRAMPA COM√öN:</span> El <span class='key-point'>AO (Application Owner)</span> ejecuta Hacking √âtico. NO el DEV (ejecuta todos los tipos de pruebas excepto Hacking √âtico), NO equipos externos necesariamente."},

            {id:11,category:"Roles Trampa",type:"trap",difficulty:"extreme",
            question:"¬øQui√©n es responsable de la Deuda T√©cnica en un proyecto de MANTENIMIENTO?",
            options:["El PO siempre es responsable de la deuda t√©cnica","El SO en mantenimiento","El DEV porque genera el c√≥digo","El AO porque es el arquitecto"],
            correct:1,
            explanation:"<span class='trap-warning'>TRAMPA:</span> La responsabilidad de Deuda T√©cnica CAMBIA seg√∫n el contexto: <span class='key-point'>PO para desarrollos nuevos</span>, <span class='key-point'>SO para mantenimiento</span>. La pregunta espec√≠fica 'mantenimiento', por lo tanto es el SO."},

            {id:12,category:"Roles Trampa",type:"trap",difficulty:"extreme",
            question:"¬øQui√©n es responsable de asegurar que el CVT est√© completo antes del despliegue?",
            options:["El DEV porque ejecuta las pruebas","El PO porque certifica la aceptaci√≥n","El SO porque da el Vo.Bo.","El Change Lead de la instalaci√≥n"],
            correct:3,
            explanation:"El <span class='key-point'>Change Lead</span> es responsable de la completitud del CVT. El SO da Vo.Bo., el PO certifica aceptaci√≥n, pero la verificaci√≥n del CVT completo es del Change Lead."},

            {id:13,category:"Roles Trampa",type:"trap",difficulty:"expert",
            question:"¬øQui√©n ejecuta las pruebas de Rendimiento y Capacidad para sistemas DORA cr√≠ticos?",
            options:["El equipo DEV del proyecto","El PO con apoyo del DEV","El equipo DQ/Red Team","El AO junto con Infrastructure"],
            correct:2,
            explanation:"Para sistemas <span class='key-point'>DORA cr√≠ticos</span>, las pruebas de Rendimiento y Capacidad las ejecuta el <span class='key-point'>equipo DQ/Red Team</span>, no el DEV regular."},

            {id:14,category:"Roles Trampa",type:"trap",difficulty:"extreme",
            question:"¬øQui√©n genera el Plan Estrat√©gico de Pruebas?",
            options:["El DEV con apoyo del QA","El PO","El AO","El Release Manager"],
            correct:2,
            explanation:"El <span class='key-point'>AO (Application Owner)</span> genera el Plan Estrat√©gico de Pruebas. NO confundir con el Plan de Pruebas operativo que involucra al DEV."},

            // ===== PREGUNTAS NEGATIVAS =====
            {id:15,category:"Pregunta Negativa",type:"negative",difficulty:"extreme",
            question:"¬øCu√°l de las siguientes NO es una disposici√≥n de error v√°lida seg√∫n la Norma?",
            options:["Corregido","Falso Positivo","Asumido","Pospuesto"],
            correct:3,
            explanation:"Las disposiciones v√°lidas son: <span class='key-point'>Corregido, Falso Positivo, Asumido</span>. '<span class='trap-warning'>Pospuesto</span>' NO existe como disposici√≥n en la Norma."},

            {id:16,category:"Pregunta Negativa",type:"negative",difficulty:"extreme",
            question:"¬øCu√°l NO es uno de los 7 Principios de la Norma de Testing?",
            options:["Prevalencia Legal","Concurrencia","Automatizaci√≥n Total","Viabilidad"],
            correct:2,
            explanation:"Los 7 principios incluyen: Prevalencia Legal, Concurrencia, Viabilidad, Proporcionalidad, Shift-Left, <span class='key-point'>Automatizaci√≥n</span> (no 'Total'). '<span class='trap-warning'>Automatizaci√≥n Total</span>' no existe como principio."},

            {id:17,category:"Pregunta Negativa",type:"negative",difficulty:"expert",
            question:"¬øCu√°l NO es responsabilidad del DEV seg√∫n la Norma?",
            options:["Ejecutar pruebas unitarias","Ejecutar pruebas de integraci√≥n","Autorizar errores como Asumidos","Ejecutar pruebas de regresi√≥n"],
            correct:2,
            explanation:"El DEV ejecuta TODOS los tipos de pruebas. Sin embargo, <span class='key-point'>autorizar errores como Asumidos</span> es responsabilidad exclusiva del <span class='key-point'>SO</span>, no del DEV."},

            {id:18,category:"Pregunta Negativa",type:"negative",difficulty:"extreme",
            question:"¬øCu√°l de estas fases NO pertenece al proceso E2E de pruebas?",
            options:["Ideaci√≥n","Delegaci√≥n","Certificaci√≥n","Gesti√≥n de Cambios"],
            correct:2,
            explanation:"Las fases E2E son: Ideaci√≥n ‚Üí Dise√±o ‚Üí Desarrollo ‚Üí Pruebas E2E ‚Üí Delegaci√≥n ‚Üí Gesti√≥n de Cambios. '<span class='trap-warning'>Certificaci√≥n</span>' NO es una fase del proceso E2E."},

            // ===== SECUENCIAS Y ORDEN =====
            {id:19,category:"Secuencias",type:"sequence",difficulty:"extreme",
            question:"¬øCu√°l es el orden CORRECTO del proceso E2E?",
            options:["Dise√±o ‚Üí Ideaci√≥n ‚Üí Desarrollo ‚Üí Pruebas ‚Üí Delegaci√≥n ‚Üí Cambios","Ideaci√≥n ‚Üí Desarrollo ‚Üí Dise√±o ‚Üí Pruebas ‚Üí Cambios ‚Üí Delegaci√≥n","Ideaci√≥n ‚Üí Dise√±o ‚Üí Desarrollo ‚Üí Pruebas E2E ‚Üí Delegaci√≥n ‚Üí Gesti√≥n de Cambios","Ideaci√≥n ‚Üí Dise√±o ‚Üí Pruebas ‚Üí Desarrollo ‚Üí Delegaci√≥n ‚Üí Cambios"],
            correct:2,
            explanation:"Orden correcto: <span class='key-point'>Ideaci√≥n ‚Üí Dise√±o (Plan de Pruebas) ‚Üí Desarrollo ‚Üí Pruebas E2E (RMP) ‚Üí Delegaci√≥n ‚Üí Gesti√≥n de Cambios</span>."},

            {id:20,category:"Secuencias",type:"sequence",difficulty:"expert",
            question:"¬øCu√°l es el orden correcto de la trazabilidad seg√∫n la Norma?",
            options:["Pruebas ‚Üí Requerimiento ‚Üí CRQ ‚Üí Resultados","Requerimiento ‚Üí CRQ ‚Üí Pruebas ‚Üí Resultados","Requerimiento ‚Üí Pruebas (C204) ‚Üí Resultados ‚Üí CRQ","CRQ ‚Üí Requerimiento ‚Üí Pruebas ‚Üí Resultados"],
            correct:2,
            explanation:"Trazabilidad correcta: <span class='key-point'>Requerimiento ‚Üí Pruebas (C204) ‚Üí Resultados ‚Üí CRQ</span>. El CRQ viene al final, despu√©s de los resultados."},

            // ===== PREGUNTAS DE COMBINACI√ìN =====
            {id:21,category:"Combinaci√≥n",type:"combined",difficulty:"extreme",
            question:"Para un sistema DORA cr√≠tico, ¬øqu√© combinaci√≥n de requisitos es correcta?",
            options:["Quality Gate 0/0/0 + 80% cobertura + evidencias 3 meses","Quality Gate 0/0/0 + 80% cobertura + evidencias 12 meses + pruebas DQ/Red Team","Quality Gate <5/<5/0 + 90% cobertura + evidencias 12 meses","Solo Quality Gate 0/0/0 es diferente para DORA"],
            correct:1,
            explanation:"Sistemas DORA cr√≠ticos: <span class='key-point'>Quality Gate 0/0/0</span> + <span class='key-point'>‚â•80% cobertura</span> + <span class='key-point'>12 meses retenci√≥n</span> + <span class='key-point'>pruebas Rendimiento/Capacidad por DQ/Red Team</span>."},

            {id:22,category:"Combinaci√≥n",type:"combined",difficulty:"extreme",
            question:"Cuando se detecta un error en producci√≥n desde septiembre 2025, ¬øqu√© proceso aplica?",
            options:["Se registra en Jira y se asigna al DEV","Se abre ticket FDS en Helix y sigue el proceso de incidencias EEPP","Se registra como bug en el backlog del sprint","Se comunica al PO para priorizaci√≥n"],
            correct:1,
            explanation:"Desde <span class='key-point'>septiembre 2025</span>, los errores de producci√≥n (incidencias EEPP) se gestionan mediante <span class='key-point'>tickets FDS en Helix</span>, no en Jira ni backlog regular."},

            // ===== PRINCIPIOS AVANZADOS =====
            {id:23,category:"Principios",type:"trap",difficulty:"extreme",
            question:"El principio de 'Concurrencia' establece que:",
            options:["Todas las pruebas deben ejecutarse en paralelo","Cuando hay conflicto entre normativas, se aplica la m√°s permisiva","Cuando hay conflicto entre normativas, se aplica la m√°s restrictiva","Las pruebas concurrentes tienen prioridad"],
            correct:2,
            explanation:"<span class='trap-warning'>TRAMPA:</span> Concurrencia NO es sobre paralelismo. Significa que cuando hay <span class='key-point'>conflicto entre normativas, se aplica la M√ÅS RESTRICTIVA</span>."},

            {id:24,category:"Principios",type:"trap",difficulty:"extreme",
            question:"El principio de 'Prevalencia Legal' significa:",
            options:["Las pruebas legales tienen prioridad sobre las t√©cnicas","La normativa de mayor rango prevalece sobre las de menor rango","Los requisitos legales deben probarse primero","Solo aplica para sistemas con datos de clientes"],
            correct:1,
            explanation:"Prevalencia Legal: <span class='key-point'>La normativa de mayor rango prevalece sobre las de menor rango</span>. Es una jerarqu√≠a normativa, no sobre tipos de pruebas."},

            {id:25,category:"Principios",type:"trap",difficulty:"expert",
            question:"El principio de 'Viabilidad' establece que:",
            options:["Solo se prueban funcionalidades viables t√©cnicamente","Si un control no es viable, se puede omitir sin documentar","Si un control no es viable, se debe documentar la excepci√≥n con justificaci√≥n","Las pruebas no viables se posponen autom√°ticamente"],
            correct:2,
            explanation:"Viabilidad: Si un control <span class='key-point'>no es t√©cnicamente viable, se debe documentar la excepci√≥n</span> con justificaci√≥n. No se puede omitir sin documentar."},

            // ===== VERIFICACI√ìN VS VALIDACI√ìN =====
            {id:26,category:"Conceptos",type:"trap",difficulty:"extreme",
            question:"'Verificaci√≥n' responde a la pregunta:",
            options:["¬øConstruimos el sistema correcto?","¬øConstruimos correctamente el sistema?","¬øEl usuario est√° satisfecho?","¬øEl sistema es seguro?"],
            correct:1,
            explanation:"<span class='key-point'>Verificaci√≥n = '¬øConstruimos correctamente el sistema?' (Built right?)</span>. Validaci√≥n = '¬øConstruimos el sistema correcto?' (Built good system?). Son conceptos diferentes."},

            {id:27,category:"Conceptos",type:"trap",difficulty:"extreme",
            question:"'Validaci√≥n' responde a la pregunta:",
            options:["¬øEl c√≥digo compila sin errores?","¬øLas pruebas unitarias pasan?","¬øConstruimos el sistema correcto?","¬øEl sistema cumple con est√°ndares de c√≥digo?"],
            correct:2,
            explanation:"<span class='key-point'>Validaci√≥n = '¬øConstruimos el sistema correcto?' (Built good system?)</span>. Se enfoca en si el sistema cumple las necesidades del usuario, no solo especificaciones t√©cnicas."},

            // ===== CVT DETALLADO =====
            {id:28,category:"CVT",type:"scenario",difficulty:"extreme",
            scenario:"Est√°s completando el CVT para una aplicaci√≥n distribuida (ASO-API) nueva. El control <strong>DyD-004</strong> solicita evidencia.",
            question:"¬øQu√© evidencia espec√≠fica requiere DyD-004?",
            options:["C√≥digo en repositorio Bitbucket/GitHub","An√°lisis est√°tico SAST con Chimera","Pruebas de seguridad aplicativa m√°s correcciones de vulnerabilidades altas/cr√≠ticas","Hacking √âtico con dictamen"],
            correct:2,
            explanation:"<span class='key-point'>DyD-004</span> es Pruebas de Seguridad Aplicativa, que <span class='key-point'>solo aplica para sistemas distribuidos</span> (ASO-API, Web, Mobile). Requiere estrategia, plan y correcciones de vulnerabilidades altas/cr√≠ticas."},

            {id:29,category:"CVT",type:"trap",difficulty:"extreme",
            question:"El control PRO-02 (Ready for Operation) se requiere:",
            options:["Para todos los cambios en producci√≥n","Solo para aplicaciones nuevas o cambios de infraestructura relevantes","Solo para sistemas DORA/SOX","Solo cuando hay cambios de base de datos"],
            correct:1,
            explanation:"<span class='key-point'>PRO-02 (RFO)</span> solo aplica para <span class='key-point'>aplicaciones nuevas o cambios de infraestructura relevantes</span>. No todos los cambios lo requieren."},

            {id:30,category:"CVT",type:"numerical",difficulty:"expert",
            question:"¬øCu√°ntos controles tiene el CVT en total?",
            options:["10 controles","12 controles","16 controles","20 controles"],
            correct:2,
            explanation:"El CVT tiene exactamente <span class='key-point'>16 controles</span>: DyD-001 a DyD-009, PRO-01 a PRO-03, SEG-01 a SEG-02, FRA-01, DMA-01."},

            // ===== GOLDEN RULES =====
            {id:31,category:"Golden Rules",type:"trap",difficulty:"extreme",
            question:"La Regla de Oro #1 establece:",
            options:["Automatizar todas las pruebas","Las pruebas son responsabilidad del equipo de QA","La calidad se prueba, no se construye","El Tester prueba, el Developer desarrolla, el Arquitecto dise√±a"],
            correct:3,
            explanation:"<span class='key-point'>Golden Rule #1: El Tester prueba, el Developer desarrolla, el Arquitecto dise√±a</span>. Define la separaci√≥n de responsabilidades."},

            {id:32,category:"Golden Rules",type:"trap",difficulty:"extreme",
            question:"¬øCu√°l es la Regla de Oro sobre pruebas automatizadas?",
            options:["La automatizaci√≥n es opcional si hay pruebas manuales suficientes","Toda prueba funcional debe ser automatizable y estar en un repositorio de pruebas","Solo las pruebas de regresi√≥n deben automatizarse","La automatizaci√≥n solo aplica para sistemas cr√≠ticos"],
            correct:1,
            explanation:"Golden Rule: <span class='key-point'>Toda prueba funcional debe ser automatizable y estar en un repositorio de pruebas</span>. No es opcional."},

            // ===== M√ÅS ESCENARIOS COMPLEJOS =====
            {id:33,category:"Escenario Complejo",type:"scenario",difficulty:"extreme",
            scenario:"Aplicaci√≥n con <span class='highlight'>3 issues Mayores</span> en Sonar. El equipo argumenta que son <strong>falsos positivos</strong> relacionados con c√≥digo legacy que no se puede modificar. El PO aprueba continuar.",
            question:"¬øQu√© debe ocurrir?",
            options:["Proceder porque el PO aprob√≥ y son falsos positivos t√©cnicamente justificados","Bloqueo autom√°tico hasta que los 3 issues se resuelvan a 0","Escalar al AO para excepci√≥n t√©cnica","Documentar como deuda t√©cnica y proceder"],
            correct:1,
            explanation:"<span class='trap-warning'>TRAMPA:</span> No importa si son 'falsos positivos' argumentados o si el PO aprueba. <span class='key-point'>El Quality Gate requiere 0 Mayores</span>. El bloqueo es autom√°tico. Los falsos positivos deben configurarse en Sonar, no justificarse verbalmente."},

            {id:34,category:"Escenario Complejo",type:"scenario",difficulty:"extreme",
            scenario:"Sistema en producci√≥n detecta comportamiento an√≥malo. Hay un <strong>error que afecta transacciones</strong> de clientes. El equipo quiere hacer rollback inmediato.",
            question:"¬øCu√°l es el proceso correcto seg√∫n la Norma?",
            options:["Rollback inmediato y documentar despu√©s","Abrir ticket FDS en Helix, evaluar impacto, ejecutar plan de rollback documentado en CRQ","Notificar al PO y esperar aprobaci√≥n para rollback","Escalar a Auditor√≠a antes de cualquier acci√≥n"],
            correct:1,
            explanation:"Proceso correcto: <span class='key-point'>Ticket FDS en Helix</span> (desde septiembre 2025), evaluar impacto, seguir <span class='key-point'>plan de rollback documentado en CRQ</span>. No se hace rollback sin seguir el proceso."},

            {id:35,category:"Escenario Complejo",type:"scenario",difficulty:"extreme",
            scenario:"Pruebas E2E completadas con <span class='highlight'>95% de casos exitosos</span>. El 5% restante son errores menores de UI que no afectan funcionalidad core. Deadline es ma√±ana.",
            question:"¬øSe puede proceder al despliegue?",
            options:["S√≠, porque 95% es suficiente y los errores son menores","No, se requiere 100% de casos exitosos sin excepciones","Depende de la clasificaci√≥n de los errores y aprobaci√≥n del SO para errores Asumidos","S√≠, con documentaci√≥n de los errores pendientes"],
            correct:2,
            explanation:"<span class='key-point'>Depende de la disposici√≥n de los errores</span>. Si el SO los clasifica como 'Asumidos' con justificaci√≥n documentada, se puede proceder. No es autom√°tico ni por porcentaje."},

            // ===== DOCUMENTACI√ìN Y EVIDENCIAS =====
            {id:36,category:"Evidencias",type:"trap",difficulty:"expert",
            question:"¬øD√≥nde se almacena el Plan de Pruebas seg√∫n la Norma?",
            options:["En Jira como √©pica","En el repositorio de c√≥digo junto al proyecto","En Confluence del equipo","Debe seguir la estructura documental est√°ndar (A800, C100, C200, etc.)"],
            correct:3,
            explanation:"El Plan de Pruebas debe seguir la <span class='key-point'>estructura documental est√°ndar</span>: A800, C100, P950, C200, C204, T950, etc. No es un documento libre en cualquier herramienta."},

            {id:37,category:"Evidencias",type:"trap",difficulty:"expert",
            question:"¬øQu√© documentos conforman la evidencia de pruebas funcionales ejecutadas?",
            options:["Solo capturas de pantalla","C204 y/o T950","Logs del sistema","Aprobaci√≥n por correo del PO"],
            correct:1,
            explanation:"Evidencia de pruebas funcionales: <span class='key-point'>C204</span> (casos ejecutados) y/o <span class='key-point'>T950</span> (evidencias). Son los formatos est√°ndar definidos."},

            // ===== INTEGRACIONES Y DEPENDENCIAS =====
            {id:38,category:"Integraciones",type:"scenario",difficulty:"extreme",
            scenario:"Tu aplicaci√≥n consume una API de otro equipo. Esa API cambi√≥ su contrato sin notificarte. Tus pruebas de integraci√≥n fallan en ambiente de desarrollo.",
            question:"¬øQu√© tipo de prueba debi√≥ haber prevenido este problema?",
            options:["Pruebas unitarias m√°s exhaustivas","Pruebas de contrato en el pipeline","Pruebas de regresi√≥n m√°s frecuentes","Pruebas de humo antes de cada integraci√≥n"],
            correct:1,
            explanation:"<span class='key-point'>Contract Testing</span> verifica que los contratos de APIs no cambien de forma incompatible. Deber√≠a estar en el pipeline para detectar cambios breaking."},

            {id:39,category:"Integraciones",type:"trap",difficulty:"expert",
            question:"Las pruebas de integraci√≥n verifican:",
            options:["Que cada m√≥dulo funciona aisladamente","Que los componentes funcionan correctamente cuando se conectan entre s√≠","Solo las conexiones a bases de datos","Solo las llamadas a APIs externas"],
            correct:1,
            explanation:"Pruebas de integraci√≥n: verifican que <span class='key-point'>los componentes funcionan correctamente cuando se conectan entre s√≠</span>. No solo BDs o APIs, sino todas las interacciones."},

            // ===== AMBIENTES =====
            {id:40,category:"Ambientes",type:"trap",difficulty:"extreme",
            question:"¬øEn qu√© ambiente se ejecutan las pruebas del RMP (Release Management Process)?",
            options:["Desarrollo","QA","Pre-producci√≥n/Staging","Producci√≥n"],
            correct:2,
            explanation:"Las pruebas del <span class='key-point'>RMP se ejecutan en pre-producci√≥n/staging</span>, que simula el ambiente productivo. No en desarrollo ni en producci√≥n."},

            {id:41,category:"Ambientes",type:"scenario",difficulty:"expert",
            scenario:"El ambiente de pre-producci√≥n tiene configuraci√≥n diferente a producci√≥n (menos memoria, diferente versi√≥n de BD).",
            question:"¬øQu√© riesgo introduce esto seg√∫n la Norma?",
            options:["Ninguno si las pruebas funcionales pasan","Las pruebas de rendimiento no ser√°n representativas","Solo afecta pruebas de seguridad","El CVT rechazar√° el despliegue autom√°ticamente"],
            correct:1,
            explanation:"Si pre-producci√≥n difiere de producci√≥n, las <span class='key-point'>pruebas de rendimiento no ser√°n representativas</span>. Los resultados no reflejar√°n el comportamiento real en producci√≥n."},

            // ===== TIPOS DE PRUEBAS ESPEC√çFICAS =====
            {id:42,category:"Tipos Pruebas",type:"trap",difficulty:"extreme",
            question:"¬øCu√°l es la diferencia entre pruebas de Humo y pruebas de Sanidad?",
            options:["Son exactamente lo mismo","Humo verifica funcionalidades cr√≠ticas; Sanidad verifica que correcciones no rompieron nada","Humo es manual; Sanidad es automatizada","Humo es para nuevos desarrollos; Sanidad para mantenimiento"],
            correct:1,
            explanation:"<span class='key-point'>Humo (Smoke)</span>: verifica funcionalidades cr√≠ticas b√°sicas. <span class='key-point'>Sanidad (Sanity)</span>: verifica que correcciones espec√≠ficas no introdujeron nuevos problemas. Son complementarias."},

            {id:43,category:"Tipos Pruebas",type:"trap",difficulty:"expert",
            question:"Las pruebas de Aceptaci√≥n son ejecutadas y certificadas por:",
            options:["El equipo de QA","El DEV junto con el QA","El PO","El usuario final"],
            correct:2,
            explanation:"Las pruebas de Aceptaci√≥n son <span class='key-point'>certificadas por el PO</span>. El PO representa al negocio y valida que el sistema cumple los requerimientos."},

            // ===== SEGURIDAD =====
            {id:44,category:"Seguridad",type:"combined",difficulty:"extreme",
            question:"¬øCu√°l es la secuencia correcta de pruebas de seguridad en el pipeline?",
            options:["DAST ‚Üí SAST ‚Üí SCA ‚Üí Hacking √âtico","SAST ‚Üí SCA ‚Üí DAST ‚Üí Hacking √âtico","Hacking √âtico ‚Üí SAST ‚Üí DAST ‚Üí SCA","SCA ‚Üí DAST ‚Üí SAST ‚Üí Hacking √âtico"],
            correct:1,
            explanation:"Secuencia correcta: <span class='key-point'>SAST</span> (c√≥digo est√°tico primero) ‚Üí <span class='key-point'>SCA</span> (componentes) ‚Üí <span class='key-point'>DAST</span> (aplicaci√≥n corriendo) ‚Üí <span class='key-point'>Hacking √âtico</span> (manual al final)."},

            {id:45,category:"Seguridad",type:"trap",difficulty:"extreme",
            question:"El AO debe asegurar que los umbrales de seguridad:",
            options:["Sean configurados por el equipo de seguridad","Se cumplan y est√©n correctamente configurados en las herramientas","Sean m√°s estrictos que los de la Norma","Se revisen solo en auditor√≠as"],
            correct:1,
            explanation:"El AO debe asegurar que los <span class='key-point'>umbrales se cumplan y est√©n correctamente configurados</span>. No solo que existan, sino que est√©n activos y funcionando."},

            // ===== M√ÅS TRAMPAS DE ROLES =====
            {id:46,category:"Roles",type:"trap",difficulty:"extreme",
            question:"¬øQui√©n da el Vo.Bo. (Visto Bueno) para el despliegue a producci√≥n?",
            options:["El PO","El Change Lead","El SO","El AO"],
            correct:2,
            explanation:"El <span class='key-point'>SO da el Vo.Bo.</span> para producci√≥n. El PO certifica aceptaci√≥n, el Change Lead verifica CVT, pero la aprobaci√≥n final es del SO."},

            {id:47,category:"Roles",type:"trap",difficulty:"extreme",
            question:"¬øQui√©n puede autorizar un Error Asumido?",
            options:["El DEV","El PO","El SO","El AO y el SO"],
            correct:2,
            explanation:"<span class='key-point'>Solo el SO</span> puede autorizar errores como 'Asumidos'. Ni el DEV, ni el PO, ni el AO tienen esta autoridad."},

            {id:48,category:"Roles",type:"scenario",difficulty:"extreme",
            scenario:"El PO quiere clasificar un error como 'Falso Positivo' para acelerar el despliegue. El DEV est√° de acuerdo en que es un problema del requerimiento, no del c√≥digo.",
            question:"¬øEs v√°lido este proceso?",
            options:["S√≠, si PO y DEV est√°n de acuerdo","S√≠, el PO tiene autoridad sobre requerimientos","No, solo el SO puede autorizar clasificaci√≥n de Falso Positivo","No, los Falsos Positivos solo aplican para errores de herramientas"],
            correct:2,
            explanation:"<span class='trap-warning'>TRAMPA:</span> Independientemente del acuerdo PO-DEV, <span class='key-point'>solo el SO autoriza</span> la clasificaci√≥n de Falso Positivo. El proceso no es v√°lido sin el SO."},

            // ===== SHIFT-LEFT =====
            {id:49,category:"Shift-Left",type:"conceptual",difficulty:"expert",
            question:"El principio Shift-Left implica:",
            options:["Mover las pruebas al final del ciclo para tener c√≥digo m√°s estable","Actividades de calidad y seguridad a las fases m√°s tempranas del ciclo","Priorizar pruebas de izquierda a derecha","Reducir el n√∫mero de pruebas en cada fase"],
            correct:1,
            explanation:"<span class='key-point'>Shift-Left</span>: mover actividades de calidad y seguridad a fases <span class='key-point'>m√°s tempranas</span> del ciclo, donde los defectos son m√°s baratos de corregir."},

            {id:50,category:"Shift-Left",type:"scenario",difficulty:"extreme",
            scenario:"Un defecto de seguridad se descubre en producci√≥n. El costo de correcci√≥n es 100x mayor que si se hubiera encontrado en dise√±o.",
            question:"¬øQu√© principio de la Norma busca evitar esto?",
            options:["Automatizaci√≥n","Proporcionalidad","Shift-Left","Concurrencia"],
            correct:2,
            explanation:"<span class='key-point'>Shift-Left</span> busca encontrar defectos temprano cuando son <span class='key-point'>m√°s baratos de corregir</span>. Un defecto en producci√≥n es mucho m√°s costoso que en dise√±o."},

            // ===== DEUDA T√âCNICA =====
            {id:51,category:"Deuda T√©cnica",type:"combined",difficulty:"extreme",
            question:"La Deuda T√©cnica registrada debe incluir:",
            options:["Solo el c√≥digo afectado","Solo el estimado de esfuerzo para corregirla","Descripci√≥n, impacto, prioridad y plan de remediaci√≥n","Solo la fecha de creaci√≥n"],
            correct:2,
            explanation:"La Deuda T√©cnica debe documentar: <span class='key-point'>descripci√≥n, impacto, prioridad y plan de remediaci√≥n</span>. No es solo registrar que existe."},

            {id:52,category:"Deuda T√©cnica",type:"trap",difficulty:"extreme",
            question:"¬øCu√°ndo se convierte un Error Asumido en Deuda T√©cnica?",
            options:["Inmediatamente cuando se clasifica como Asumido","Nunca, son conceptos diferentes","Cuando el SO lo autoriza y se documenta para correcci√≥n futura","Solo si afecta sistemas DORA/SOX"],
            correct:2,
            explanation:"Un Error Asumido se convierte en Deuda T√©cnica cuando el <span class='key-point'>SO lo autoriza y se documenta para correcci√≥n futura</span>. No es autom√°tico."},

            // ===== M√âTRICAS =====
            {id:53,category:"M√©tricas",type:"numerical",difficulty:"extreme",
            question:"¬øQu√© m√©tricas de cobertura se consideran en el Quality Gate?",
            options:["Solo cobertura de l√≠neas","Solo cobertura de ramas","Cobertura de l√≠neas y cobertura de ramas","Cobertura de l√≠neas, ramas y mutaci√≥n"],
            correct:2,
            explanation:"El Quality Gate considera <span class='key-point'>cobertura de l√≠neas Y cobertura de ramas</span>. Ambas deben cumplir el umbral del 80%."},

            {id:54,category:"M√©tricas",type:"trap",difficulty:"expert",
            question:"Si la cobertura de l√≠neas es 85% pero la cobertura de ramas es 75%:",
            options:["Cumple el Quality Gate porque l√≠neas supera 80%","No cumple porque ramas est√° por debajo de 80%","Cumple porque el promedio es 80%","Depende del tipo de aplicaci√≥n"],
            correct:1,
            explanation:"<span class='key-point'>Ambas coberturas</span> deben ser ‚â•80%. Si ramas es 75%, <span class='key-point'>no cumple</span> aunque l√≠neas sea 85%. No se promedian."},

            // ===== HERRAMIENTAS =====
            {id:55,category:"Herramientas",type:"trap",difficulty:"expert",
            question:"¬øQu√© herramienta genera los reportes consolidados de vulnerabilidades?",
            options:["SonarQube","Fortify","Chimera","Veracode"],
            correct:2,
            explanation:"<span class='key-point'>Chimera</span> genera los reportes consolidados de vulnerabilidades de todas las herramientas (SAST, DAST, SCA)."},

            {id:56,category:"Herramientas",type:"trap",difficulty:"expert",
            question:"¬øD√≥nde se gestionan las incidencias de producci√≥n desde septiembre 2025?",
            options:["Jira","ServiceNow","Helix (tickets FDS)","Remedy"],
            correct:2,
            explanation:"Desde septiembre 2025, las incidencias EEPP se gestionan en <span class='key-point'>Helix mediante tickets FDS</span>."},

            // ===== ESCENARIOS ADICIONALES =====
            {id:57,category:"Escenario",type:"scenario",difficulty:"extreme",
            scenario:"Durante las pruebas E2E, descubres que un escenario del CVT no fue probado porque el ambiente no lo permit√≠a. El deadline es hoy.",
            question:"¬øQu√© debe ocurrir?",
            options:["Documentar la excepci√≥n y proceder con el despliegue","El despliegue debe detenerse hasta que se complete el CVT","Escalar al PO para que apruebe la excepci√≥n","Posponer solo ese escenario para post-producci√≥n"],
            correct:1,
            explanation:"<span class='key-point'>CVT incompleto = despliegue DETENIDO</span>. No hay excepciones por deadline. El Change Lead no puede aprobar un CVT incompleto."},

            {id:58,category:"Escenario",type:"scenario",difficulty:"extreme",
            scenario:"Prueba de Hacking √âtico encuentra vulnerabilidad <strong>ALTA</strong>. El AO dice que es un riesgo aceptable para el negocio y quiere proceder.",
            question:"¬øPuede el AO aceptar este riesgo y proceder?",
            options:["S√≠, el AO tiene autoridad sobre decisiones t√©cnicas","S√≠, si lo documenta como deuda t√©cnica","No, las vulnerabilidades Altas/Cr√≠ticas de Hacking √âtico deben corregirse","No, pero puede escalar al CISO para excepci√≥n"],
            correct:2,
            explanation:"Las vulnerabilidades <span class='key-point'>Altas y Cr√≠ticas de Hacking √âtico DEBEN corregirse</span>. El AO no puede aceptar este riesgo. Es un requisito no negociable del CVT (DyD-005)."},

            {id:59,category:"Escenario",type:"scenario",difficulty:"extreme",
            scenario:"Sistema legado que NO tiene pruebas automatizadas. Se requiere un cambio urgente. No hay tiempo para crear pruebas automatizadas.",
            question:"¬øQu√© aplica seg√∫n la Norma?",
            options:["Se puede desplegar con pruebas manuales documentadas si el SO aprueba","Imposible desplegar sin pruebas automatizadas seg√∫n Golden Rules","Se aplica el principio de Viabilidad: documentar excepci√≥n con justificaci√≥n","Las pruebas automatizadas son opcionales para sistemas legados"],
            correct:2,
            explanation:"Se aplica el <span class='key-point'>principio de Viabilidad</span>: si no es t√©cnicamente viable, se debe <span class='key-point'>documentar la excepci√≥n con justificaci√≥n</span>. No se omite sin documentar."},

            // ===== CICLO COMPLETO =====
            {id:60,category:"Ciclo",type:"sequence",difficulty:"extreme",
            question:"¬øEn qu√© fase del E2E se genera el Plan de Pruebas?",
            options:["Ideaci√≥n","Dise√±o","Desarrollo","Pruebas E2E"],
            correct:1,
            explanation:"El Plan de Pruebas se genera en la fase de <span class='key-point'>Dise√±o</span>. Ideaci√≥n es para requerimientos, Desarrollo para c√≥digo, Pruebas E2E para ejecuci√≥n."},

            {id:61,category:"Ciclo",type:"trap",difficulty:"extreme",
            question:"¬øCu√°l es la relaci√≥n entre C204 y T950?",
            options:["Son documentos independientes sin relaci√≥n","C204 contiene los casos; T950 contiene las evidencias de ejecuci√≥n","C204 es para pruebas funcionales; T950 para no funcionales","C204 reemplaz√≥ a T950 en la nueva versi√≥n de la Norma"],
            correct:1,
            explanation:"<span class='key-point'>C204</span> = casos de prueba. <span class='key-point'>T950</span> = evidencias de ejecuci√≥n. Son complementarios, no independientes."},

            // ===== REGULACI√ìN =====
            {id:62,category:"Regulaci√≥n",type:"trap",difficulty:"extreme",
            question:"¬øPor qu√© los sistemas DORA/SOX tienen requisitos especiales de testing?",
            options:["Porque son m√°s complejos t√©cnicamente","Por requerimientos regulatorios de auditor√≠a y control de riesgos financieros","Porque manejan m√°s volumen de datos","Por decisi√≥n interna de BBVA"],
            correct:1,
            explanation:"DORA (Digital Operational Resilience Act) y SOX (Sarbanes-Oxley) son <span class='key-point'>regulaciones externas</span> que imponen requisitos de auditor√≠a y control para sistemas financieros."},

            {id:63,category:"Regulaci√≥n",type:"trap",difficulty:"expert",
            question:"La retenci√≥n de 12 meses para evidencias DORA/SOX es:",
            options:["Una recomendaci√≥n de buenas pr√°cticas","Un requisito regulatorio obligatorio","Configurable seg√∫n el riesgo de cada aplicaci√≥n","Solo para evidencias de seguridad"],
            correct:1,
            explanation:"Los <span class='key-point'>12 meses de retenci√≥n para DORA/SOX es un requisito regulatorio obligatorio</span>, no una recomendaci√≥n ni configurable."},

            // ===== PREGUNTAS FINALES DE INTEGRACI√ìN =====
            {id:64,category:"Integraci√≥n",type:"combined",difficulty:"extreme",
            question:"Para un despliegue exitoso, ¬øqu√© combinaci√≥n de aprobaciones es CORRECTA?",
            options:["PO certifica + DEV aprueba + Change Lead verifica CVT","PO certifica aceptaci√≥n + SO da Vo.Bo. + Change Lead verifica CVT completo + CRQ aprobado","AO aprueba + SO certifica + PO da Vo.Bo.","Solo el CRQ aprobado es suficiente si las pruebas pasaron"],
            correct:1,
            explanation:"Combinaci√≥n correcta: <span class='key-point'>PO certifica aceptaci√≥n</span> + <span class='key-point'>SO da Vo.Bo.</span> + <span class='key-point'>Change Lead verifica CVT completo</span> + <span class='key-point'>CRQ aprobado</span>."},

            {id:65,category:"Integraci√≥n",type:"combined",difficulty:"extreme",
            question:"Si un sistema tiene los siguientes resultados: Sonar 0/0/0, Cobertura 79%, 100% pruebas pasan, CVT completo:",
            options:["Puede desplegarse porque Sonar est√° limpio","No puede desplegarse porque la cobertura es menor a 80%","Puede desplegarse con excepci√≥n documentada","Depende de si es sistema DORA o no"],
            correct:1,
            explanation:"<span class='key-point'>Cobertura 79% < 80% requerido</span>. No puede desplegarse. No importa que Sonar est√© limpio o que las pruebas pasen. Todos los criterios deben cumplirse."},

            {id:66,category:"Integraci√≥n",type:"scenario",difficulty:"extreme",
            scenario:"Auditor√≠a solicita evidencias de un sistema que tuvo 15 ejecuciones en los √∫ltimos 2 meses. El sistema NO es DORA/SOX.",
            question:"¬øCu√°ntas ejecuciones tendr√°n evidencias disponibles?",
            options:["Las 15 ejecuciones completas","Solo las √∫ltimas 10 ejecuciones","Solo los √∫ltimos 3 meses de ejecuciones","Depende del tama√±o de las evidencias"],
            correct:1,
            explanation:"Para sistemas no DORA/SOX: retenci√≥n de <span class='key-point'>3 meses O 10 ejecuciones, lo que ocurra primero</span>. Con 15 ejecuciones en 2 meses, solo las <span class='key-point'>√∫ltimas 10</span> estar√°n disponibles."},

            {id:67,category:"Integraci√≥n",type:"trap",difficulty:"extreme",
            question:"El principio de Proporcionalidad establece:",
            options:["Los controles deben ser proporcionales al esfuerzo del equipo","Los controles deben ser proporcionales al riesgo y criticidad del sistema","Las pruebas deben ser proporcionalmente distribuidas en el ciclo","El n√∫mero de pruebas debe ser proporcional al n√∫mero de desarrolladores"],
            correct:1,
            explanation:"<span class='key-point'>Proporcionalidad</span>: los controles deben ser <span class='key-point'>proporcionales al riesgo y criticidad</span> del sistema. Sistemas m√°s cr√≠ticos = m√°s controles."},

            {id:68,category:"Final",type:"combined",difficulty:"extreme",
            question:"¬øCu√°l es la √öNICA raz√≥n v√°lida para NO ejecutar un tipo de prueba requerido?",
            options:["Falta de tiempo antes del deadline","Falta de recursos en el equipo","No aplicabilidad t√©cnica","Aprobaci√≥n verbal del PO"],
            correct:2,
            explanation:"La √∫nica raz√≥n v√°lida es <span class='key-point'>no aplicabilidad t√©cnica documentada</span> seg√∫n el principio de Viabilidad. Tiempo, recursos o aprobaciones verbales no son v√°lidos."},

            {id:69,category:"Final",type:"scenario",difficulty:"extreme",
            scenario:"Desarrollador senior argumenta que su c√≥digo no necesita pruebas unitarias porque es 'c√≥digo trivial' de solo 10 l√≠neas que llama a una API externa.",
            question:"¬øEs v√°lido este argumento seg√∫n la Norma?",
            options:["S√≠, el c√≥digo trivial puede excluirse de pruebas unitarias","S√≠, si el senior lo justifica t√©cnicamente","No, todo c√≥digo debe tener pruebas unitarias sin excepci√≥n basada en complejidad","No, pero puede tener menor cobertura si est√° justificado"],
            correct:2,
            explanation:"<span class='trap-warning'>TRAMPA:</span> No hay excepci√≥n por 'c√≥digo trivial' o experiencia del desarrollador. <span class='key-point'>Todo c√≥digo debe tener pruebas</span>. La Regla de Oro: c√≥digo sin pruebas es c√≥digo incompleto."},

            {id:70,category:"Final",type:"combined",difficulty:"extreme",
            question:"¬øCu√°l es el objetivo PRINCIPAL de todo el marco de Testing seg√∫n la Norma?",
            options:["Cumplir con auditor√≠as regulatorias","Documentar el proceso de desarrollo","Asegurar la calidad y minimizar el riesgo de defectos en producci√≥n","Estandarizar las herramientas de prueba"],
            correct:2,
            explanation:"El objetivo principal es <span class='key-point'>asegurar la calidad y minimizar el riesgo de defectos en producci√≥n</span>. Las auditor√≠as y documentaci√≥n son medios, no el fin."}
        ];

        let questions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let answerResults = {};
        let correctCount = 0;
        let incorrectCount = 0;
        let shuffledOptions = {};

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function shuffleOptionsForQuestion(question, qIndex) {
            const indices = question.options.map((_, i) => i);
            const shuffledIndices = shuffleArray(indices);
            const newCorrectIndex = shuffledIndices.indexOf(question.correct);
            shuffledOptions[qIndex] = { indices: shuffledIndices, correctIndex: newCorrectIndex };
        }

        function startExam() {
            let limit = parseInt(document.getElementById('questionLimit').value) || 70;
            limit = Math.max(10, Math.min(70, limit));
            questions = shuffleArray([...allQuestions]).slice(0, limit);
            shuffledOptions = {};
            questions.forEach((q, i) => shuffleOptionsForQuestion(q, i));
            currentQuestionIndex = 0;
            userAnswers = {};
            answerResults = {};
            correctCount = 0;
            incorrectCount = 0;
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('examScreen').classList.remove('hidden');
            document.getElementById('totalQuestions').textContent = questions.length;
            renderQuestionNav();
            renderQuestion();
            updateStats();
        }

        function renderQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            questions.forEach((_, index) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                if (index === currentQuestionIndex) btn.classList.add('current');
                if (answerResults[index] === true) btn.classList.add('correct');
                if (answerResults[index] === false) btn.classList.add('incorrect');
                btn.textContent = index + 1;
                btn.onclick = () => goToQuestion(index);
                nav.appendChild(btn);
            });
        }

        function goToQuestion(index) { currentQuestionIndex = index; renderQuestion(); renderQuestionNav(); }

        function updateStats() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('incorrectCount').textContent = incorrectCount;
            const progress = (Object.keys(userAnswers).length / questions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        function renderQuestion() {
            const question = questions[currentQuestionIndex];
            const shuffled = shuffledOptions[currentQuestionIndex];
            const isAnswered = userAnswers[currentQuestionIndex] !== undefined;
            const userAnswer = userAnswers[currentQuestionIndex];
            const isCorrect = answerResults[currentQuestionIndex];
            
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionNumber').textContent = `Pregunta ${currentQuestionIndex + 1}`;
            document.getElementById('questionCategory').textContent = question.category;
            
            const typeLabel = document.getElementById('questionType');
            const typeMap = {scenario:'Escenario',trap:'Trampa',numerical:'Num√©rica',combined:'Combinada',negative:'Negativa',sequence:'Secuencia'};
            typeLabel.textContent = typeMap[question.type] || question.type;
            typeLabel.className = `question-type ${question.type}`;
            
            const diffBadge = document.getElementById('difficultyBadge');
            diffBadge.textContent = question.difficulty === 'extreme' ? 'üî• EXTREMO' : question.difficulty === 'expert' ? 'Experto' : 'Dif√≠cil';
            diffBadge.className = `difficulty-badge ${question.difficulty}`;
            
            const scenarioBox = document.getElementById('scenarioBox');
            scenarioBox.innerHTML = question.scenario ? `<div class="scenario-box">üìã <strong>ESCENARIO:</strong><br><br>${question.scenario}</div>` : '';
            
            document.getElementById('questionText').innerHTML = question.question;
            
            const questionCard = document.getElementById('questionCard');
            questionCard.classList.remove('answered-correct', 'answered-incorrect');
            if (isAnswered) questionCard.classList.add(isCorrect ? 'answered-correct' : 'answered-incorrect');
            
            const optionsList = document.getElementById('optionsList');
            const letters = ['A', 'B', 'C', 'D', 'E'];
            optionsList.innerHTML = shuffled.indices.map((originalIndex, displayIndex) => {
                const option = question.options[originalIndex];
                let className = 'option';
                let feedback = '';
                if (isAnswered) {
                    className += ' disabled';
                    if (displayIndex === shuffled.correctIndex) {
                        className += ' correct';
                        feedback = displayIndex === userAnswer ? '<span class="option-feedback correct">‚úì ¬°Correcto!</span>' : '<span class="option-feedback correct">‚úì Correcta</span>';
                        if (displayIndex !== userAnswer) className += ' show-correct';
                    } else if (displayIndex === userAnswer) {
                        className += ' incorrect';
                        feedback = '<span class="option-feedback incorrect">‚úó Incorrecto</span>';
                    }
                }
                return `<div class="${className}" onclick="${isAnswered ? '' : `selectOption(${displayIndex})`}"><span class="option-letter">${letters[displayIndex]}</span><span class="option-text">${option}</span>${feedback}</div>`;
            }).join('');
            
            const feedbackContainer = document.getElementById('feedbackContainer');
            if (isAnswered) {
                let feedbackHTML = isCorrect ? '<div class="feedback-message correct"><span class="feedback-icon">‚úÖ</span><span>¬°Correcto!</span></div>' : '<div class="feedback-message incorrect"><span class="feedback-icon">‚ùå</span><span>Incorrecto</span></div>';
                if (question.explanation) feedbackHTML += `<div class="explanation"><strong>üìñ Explicaci√≥n:</strong><br><br>${question.explanation}</div>`;
                feedbackContainer.innerHTML = feedbackHTML;
            } else feedbackContainer.innerHTML = '';
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            if (currentQuestionIndex === questions.length - 1) {
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('finishBtn').classList.remove('hidden');
            } else {
                document.getElementById('nextBtn').classList.remove('hidden');
                document.getElementById('finishBtn').classList.add('hidden');
            }
        }

        function selectOption(displayIndex) {
            if (userAnswers[currentQuestionIndex] !== undefined) return;
            const shuffled = shuffledOptions[currentQuestionIndex];
            const isCorrect = displayIndex === shuffled.correctIndex;
            userAnswers[currentQuestionIndex] = displayIndex;
            answerResults[currentQuestionIndex] = isCorrect;
            if (isCorrect) correctCount++; else incorrectCount++;
            updateStats();
            renderQuestion();
            renderQuestionNav();
        }

        function prevQuestion() { if (currentQuestionIndex > 0) { currentQuestionIndex--; renderQuestion(); renderQuestionNav(); } }
        function nextQuestion() { if (currentQuestionIndex < questions.length - 1) { currentQuestionIndex++; renderQuestion(); renderQuestionNav(); } }

        function finishExam() {
            const unanswered = questions.length - Object.keys(userAnswers).length;
            const score = Math.round((correctCount / questions.length) * 100);
            document.getElementById('examScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            document.getElementById('finalScore').textContent = `${score}%`;
            document.getElementById('finalCorrect').textContent = correctCount;
            document.getElementById('finalIncorrect').textContent = incorrectCount;
            document.getElementById('finalUnanswered').textContent = unanswered;
            let gradeText = '', gradeEmoji = '';
            if (score >= 95) { gradeText = 'MAESTRO'; gradeEmoji = 'üëë'; }
            else if (score >= 90) { gradeText = 'Excelente'; gradeEmoji = 'üèÜ'; }
            else if (score >= 85) { gradeText = 'Muy Bien'; gradeEmoji = 'üéâ'; }
            else if (score >= 80) { gradeText = 'Aprobado'; gradeEmoji = '‚úÖ'; }
            else if (score >= 70) { gradeText = 'Casi'; gradeEmoji = 'üìö'; }
            else { gradeText = 'No Aprobado'; gradeEmoji = '‚ùå'; }
            document.getElementById('gradeText').textContent = `${gradeEmoji} ${gradeText}`;
        }

        function reviewAnswers() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('reviewScreen').classList.remove('hidden');
            const container = document.getElementById('reviewContainer');
            const letters = ['A', 'B', 'C', 'D', 'E'];
            const typeMap = {scenario:'Escenario',trap:'Trampa',numerical:'Num√©rica',combined:'Combinada',negative:'Negativa',sequence:'Secuencia'};
            container.innerHTML = questions.map((question, qIndex) => {
                const shuffled = shuffledOptions[qIndex];
                const userAnswer = userAnswers[qIndex];
                const isCorrect = answerResults[qIndex];
                const isUnanswered = userAnswer === undefined;
                return `<div class="question-card fade-in" style="animation-delay: ${qIndex * 0.015}s">
                    <div class="question-header">
                        <span class="question-number">P${qIndex + 1}</span>
                        <span class="question-category">${question.category}</span>
                        <span class="question-type ${question.type}">${typeMap[question.type]||question.type}</span>
                        <span style="margin-left: auto; font-size: 1.5rem;">${isUnanswered ? '‚ö†Ô∏è' : (isCorrect ? '‚úÖ' : '‚ùå')}</span>
                    </div>
                    ${question.scenario ? `<div class="scenario-box">üìã <strong>ESCENARIO:</strong><br><br>${question.scenario}</div>` : ''}
                    <p class="question-text">${question.question}</p>
                    <div class="options-list">${shuffled.indices.map((originalIndex, displayIndex) => {
                        const option = question.options[originalIndex];
                        let className = 'option disabled';
                        let feedback = '';
                        if (displayIndex === shuffled.correctIndex) { className += ' correct'; feedback = '<span class="option-feedback correct">‚úì Correcta</span>'; }
                        else if (displayIndex === userAnswer && !isCorrect) { className += ' incorrect'; feedback = '<span class="option-feedback incorrect">Tu respuesta</span>'; }
                        return `<div class="${className}"><span class="option-letter">${letters[displayIndex]}</span><span class="option-text">${option}</span>${feedback}</div>`;
                    }).join('')}</div>
                    ${question.explanation ? `<div class="explanation"><strong>üìñ Explicaci√≥n:</strong><br><br>${question.explanation}</div>` : ''}
                </div>`;
            }).join('');
        }

        function backToResults() { document.getElementById('reviewScreen').classList.add('hidden'); document.getElementById('resultsScreen').classList.remove('hidden'); }

        function restartExam() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('reviewScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }
    </script>
</body>
</html>
