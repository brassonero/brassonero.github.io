<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Avanzado - Norma de Testing BBVA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f0f1a;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #25253d;
            --bg-card: #1e1e32;
            --accent-blue: #0066cc;
            --accent-cyan: #00d4ff;
            --accent-purple: #7c3aed;
            --accent-pink: #ec4899;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-yellow: #fbbf24;
            --accent-orange: #f97316;
            --text-primary: #ffffff;
            --text-secondary: #b4b4d4;
            --text-muted: #6b6b8d;
            --border-color: #2d2d4a;
            --glow-cyan: 0 0 30px rgba(0, 212, 255, 0.25);
            --glow-purple: 0 0 30px rgba(124, 58, 237, 0.25);
            --glow-green: 0 0 20px rgba(16, 185, 129, 0.3);
            --glow-red: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .bg-pattern {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: 
                radial-gradient(ellipse at 0% 0%, rgba(124, 58, 237, 0.15) 0%, transparent 50%),
                radial-gradient(ellipse at 100% 100%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                linear-gradient(rgba(124, 58, 237, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(124, 58, 237, 0.03) 1px, transparent 1px);
            background-size: 100% 100%, 100% 100%, 60px 60px, 60px 60px;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 2.5rem;
            padding: 2.5rem 2rem;
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
            border-radius: 24px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-cyan), var(--accent-pink), var(--accent-purple));
            background-size: 300% 100%;
            animation: gradient-shift 4s ease infinite;
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .logo-icon {
            width: 75px; height: 75px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            box-shadow: var(--glow-purple);
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-top: 0.5rem;
        }

        .badge-container {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .badge-purple { background: var(--accent-purple); color: white; }
        .badge-red { background: var(--accent-red); color: white; }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            padding: 1.2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover { transform: translateY(-2px); }
        .stat-card.correct-stat { border-color: var(--accent-green); }
        .stat-card.incorrect-stat { border-color: var(--accent-red); }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-value.correct { background: var(--accent-green); -webkit-background-clip: text; }
        .stat-value.incorrect { background: var(--accent-red); -webkit-background-clip: text; }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.3rem;
        }

        .progress-container {
            background: var(--bg-tertiary);
            border-radius: 10px;
            height: 10px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-cyan));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: var(--glow-cyan);
        }

        .question-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .question-card:hover { border-color: rgba(124, 58, 237, 0.4); }
        .question-card.answered-correct { border-color: var(--accent-green); box-shadow: var(--glow-green); }
        .question-card.answered-incorrect { border-color: var(--accent-red); box-shadow: var(--glow-red); }

        .question-header {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .question-number {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
            color: white;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 10px;
            font-size: 0.85rem;
        }

        .question-category {
            font-size: 0.8rem;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
        }

        .question-type {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .question-type.scenario { background: var(--accent-pink); color: white; }
        .question-type.conceptual { background: var(--accent-purple); color: white; }
        .question-type.numerical { background: var(--accent-cyan); color: black; }
        .question-type.tricky { background: var(--accent-orange); color: white; }

        .difficulty-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }
        .difficulty-badge.expert { background: #dc2626; color: white; }
        .difficulty-badge.hard { background: var(--accent-orange); color: white; }
        .difficulty-badge.medium { background: var(--accent-yellow); color: black; }

        .question-text {
            font-size: 1.05rem;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        .scenario-box {
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 12px;
            padding: 1.2rem;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .scenario-box strong { color: var(--accent-cyan); }
        .scenario-box .highlight { background: rgba(0, 212, 255, 0.2); padding: 0.1rem 0.3rem; border-radius: 3px; color: var(--accent-cyan); }

        .options-list { display: flex; flex-direction: column; gap: 0.75rem; }

        .option {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem 1.2rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover:not(.disabled) {
            border-color: var(--accent-purple);
            background: rgba(124, 58, 237, 0.1);
            transform: translateX(4px);
        }

        .option.correct {
            border-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.15);
        }

        .option.incorrect {
            border-color: var(--accent-red);
            background: rgba(239, 68, 68, 0.15);
        }

        .option.disabled { cursor: not-allowed; opacity: 0.7; }
        .option.show-correct { border-color: var(--accent-green); background: rgba(16, 185, 129, 0.1); }

        .option-letter {
            width: 38px; height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .option:hover:not(.disabled) .option-letter { background: var(--accent-purple); color: white; }
        .option.correct .option-letter { background: var(--accent-green); color: white; }
        .option.incorrect .option-letter { background: var(--accent-red); color: white; }
        .option.show-correct .option-letter { background: var(--accent-green); color: white; }

        .option-text { flex: 1; color: var(--text-primary); font-size: 0.95rem; line-height: 1.5; }

        .option-feedback {
            font-size: 0.85rem;
            font-weight: 500;
            margin-left: auto;
            flex-shrink: 0;
        }

        .option-feedback.correct { color: var(--accent-green); }
        .option-feedback.incorrect { color: var(--accent-red); }

        .feedback-message {
            margin-top: 1.5rem;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 500;
        }

        .feedback-message.correct {
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
        }

        .feedback-message.incorrect {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
        }

        .feedback-icon { font-size: 1.5rem; }

        .explanation {
            margin-top: 1rem;
            padding: 1rem 1.2rem;
            background: rgba(0, 212, 255, 0.08);
            border-left: 3px solid var(--accent-cyan);
            border-radius: 0 10px 10px 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .explanation strong { color: var(--accent-cyan); }
        .explanation .key-point { color: var(--accent-pink); font-weight: 600; }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            padding: 0.9rem 2rem;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
            color: white;
        }

        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--glow-purple); }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover { border-color: var(--accent-purple); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .question-nav {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(42px, 1fr));
            gap: 0.4rem;
            padding: 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            margin-bottom: 2rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .nav-btn {
            width: 42px; height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-btn:hover { border-color: var(--accent-purple); color: var(--accent-purple); }
        .nav-btn.current { background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan)); border-color: transparent; color: white; }
        .nav-btn.correct { background: var(--accent-green); border-color: transparent; color: white; }
        .nav-btn.incorrect { background: var(--accent-red); border-color: transparent; color: white; }

        .results-container { text-align: center; padding: 3rem; }

        .results-score {
            font-size: 5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .results-grade { font-size: 2rem; margin-bottom: 2rem; }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .result-stat { background: var(--bg-tertiary); padding: 1.5rem; border-radius: 14px; }

        .result-stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2.2rem;
            font-weight: 600;
        }

        .result-stat-value.correct { color: var(--accent-green); }
        .result-stat-value.incorrect { color: var(--accent-red); }
        .result-stat-value.unanswered { color: var(--accent-yellow); }

        .start-screen { text-align: center; padding: 3rem; }
        .start-screen h2 { font-size: 1.8rem; margin-bottom: 1.5rem; }

        .start-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 2rem 0;
            text-align: left;
        }

        .info-item {
            background: var(--bg-tertiary);
            padding: 1.2rem;
            border-radius: 14px;
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 1px solid var(--border-color);
        }

        .info-icon {
            width: 48px; height: 48px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
        }

        .info-text h4 { font-size: 0.85rem; color: var(--text-muted); font-weight: 400; }
        .info-text p { font-size: 1.05rem; color: var(--text-primary); font-weight: 600; }

        .warning-box {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(249, 115, 22, 0.1));
            border: 1px solid var(--accent-red);
            border-radius: 14px;
            padding: 1.2rem;
            margin: 1.5rem 0;
            text-align: left;
        }

        .warning-box h4 {
            color: var(--accent-red);
            margin-bottom: 0.5rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .warning-box p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .warning-box ul {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 0.5rem;
            padding-left: 1.2rem;
        }

        .question-limit {
            margin: 1.5rem 0;
            padding: 1.2rem;
            background: var(--bg-tertiary);
            border-radius: 14px;
            border: 1px solid var(--border-color);
        }

        .question-limit label { display: block; margin-bottom: 0.5rem; color: var(--text-secondary); }

        .question-limit input {
            width: 100px;
            padding: 0.6rem;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            text-align: center;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-purple); }

        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .stats-bar { grid-template-columns: repeat(2, 1fr); }
            .header h1 { font-size: 1.5rem; }
            .question-text { font-size: 1rem; }
            .start-info { grid-template-columns: 1fr; }
            .results-stats { grid-template-columns: 1fr; }
            .navigation { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
        }

        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse-green { 0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } }
        @keyframes pulse-red { 0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } }

        .option.correct { animation: pulse-green 0.5s ease; }
        .option.incorrect { animation: pulse-red 0.5s ease; }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    
    <div class="container">
        <header class="header">
            <div class="logo-container">
                <div class="logo-icon">‚ö°</div>
                <div>
                    <h1>Norma de Testing BBVA</h1>
                    <p class="subtitle">Examen Avanzado ‚Äî Nivel Experto</p>
                </div>
            </div>
            <div class="badge-container">
                <span class="badge badge-purple">SYSTEMS ENGINEERING</span>
                <span class="badge badge-red">DIFICULTAD ALTA</span>
            </div>
        </header>

        <div id="startScreen" class="question-card start-screen">
            <h2>üéØ Evaluaci√≥n Avanzada</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                Examen de nivel experto con preguntas basadas en escenarios reales,<br>
                casos de uso complejos y distractores desafiantes.
            </p>

            <div class="start-info">
                <div class="info-item">
                    <div class="info-icon">üìã</div>
                    <div class="info-text">
                        <h4>Total de preguntas</h4>
                        <p>55 preguntas</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">üéØ</div>
                    <div class="info-text">
                        <h4>Tipos de preguntas</h4>
                        <p>Escenarios + Conceptos</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">‚ö†Ô∏è</div>
                    <div class="info-text">
                        <h4>Dificultad</h4>
                        <p>Experto / Alta</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">‚úÖ</div>
                    <div class="info-text">
                        <h4>Para aprobar</h4>
                        <p>75% m√≠nimo</p>
                    </div>
                </div>
            </div>

            <div class="warning-box">
                <h4>‚ö†Ô∏è Advertencias del Examen</h4>
                <p>Este examen est√° dise√±ado para evaluar comprensi√≥n profunda:</p>
                <ul>
                    <li>Preguntas basadas en <strong>escenarios reales</strong></li>
                    <li>Opciones con <strong>diferencias sutiles</strong></li>
                    <li>Combinaciones de conceptos y responsabilidades</li>
                    <li>Valores num√©ricos espec√≠ficos (umbrales, tiempos)</li>
                </ul>
            </div>

            <div class="question-limit">
                <label>N√∫mero de preguntas:</label>
                <input type="number" id="questionLimit" min="10" max="55" value="55">
                <span style="color: var(--text-muted); margin-left: 0.5rem;">(10-55)</span>
            </div>

            <button class="btn btn-primary" onclick="startExam()" style="margin-top: 1.5rem; padding: 1rem 3rem; font-size: 1.1rem;">
                ‚ö° Iniciar Examen Avanzado
            </button>
        </div>

        <div id="examScreen" class="hidden">
            <div class="stats-bar">
                <div class="stat-card">
                    <div class="stat-value" id="currentQuestion">1</div>
                    <div class="stat-label">Actual</div>
                </div>
                <div class="stat-card correct-stat">
                    <div class="stat-value correct" id="correctCount">0</div>
                    <div class="stat-label">Correctas</div>
                </div>
                <div class="stat-card incorrect-stat">
                    <div class="stat-value incorrect" id="incorrectCount">0</div>
                    <div class="stat-label">Incorrectas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalQuestions">55</div>
                    <div class="stat-label">Total</div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>

            <div class="question-nav" id="questionNav"></div>

            <div class="question-card fade-in" id="questionCard">
                <div class="question-header">
                    <span class="question-number" id="questionNumber">Pregunta 1</span>
                    <span class="question-category" id="questionCategory">Categor√≠a</span>
                    <span class="question-type" id="questionType">Escenario</span>
                    <span class="difficulty-badge" id="difficultyBadge">Experto</span>
                </div>
                <div id="scenarioBox"></div>
                <p class="question-text" id="questionText">Texto de la pregunta...</p>
                <div class="options-list" id="optionsList"></div>
                <div id="feedbackContainer"></div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()">‚Üê Anterior</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">Siguiente ‚Üí</button>
                <button class="btn btn-primary hidden" id="finishBtn" onclick="finishExam()">üèÅ Finalizar</button>
            </div>
        </div>

        <div id="resultsScreen" class="hidden">
            <div class="question-card results-container">
                <h2 style="margin-bottom: 1rem;">Resultados del Examen Avanzado</h2>
                <div class="results-score" id="finalScore">0%</div>
                <div class="results-grade" id="gradeText">Calificaci√≥n</div>
                
                <div class="results-stats">
                    <div class="result-stat">
                        <div class="result-stat-value correct" id="finalCorrectCount">0</div>
                        <div class="stat-label">Correctas</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-stat-value incorrect" id="finalIncorrectCount">0</div>
                        <div class="stat-label">Incorrectas</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-stat-value unanswered" id="finalUnansweredCount">0</div>
                        <div class="stat-label">Sin responder</div>
                    </div>
                </div>

                <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="reviewAnswers()">üìã Revisar Respuestas</button>
                    <button class="btn btn-primary" onclick="restartExam()">üîÑ Nuevo Examen</button>
                </div>
            </div>
        </div>

        <div id="reviewScreen" class="hidden">
            <div class="question-card" style="margin-bottom: 1rem;">
                <h2 style="margin-bottom: 0.5rem;">Revisi√≥n de Respuestas</h2>
                <p style="color: var(--text-secondary);">An√°lisis detallado de cada pregunta</p>
            </div>
            <div id="reviewContainer"></div>
            <div class="navigation">
                <button class="btn btn-primary" onclick="backToResults()">‚Üê Volver a Resultados</button>
            </div>
        </div>
    </div>

    <script>
        const allQuestions = [
            // ========== ESCENARIOS COMPLEJOS ==========
            {id:1,category:"Escenario",type:"scenario",difficulty:"expert",
                scenario:"Tu equipo est√° desarrollando un nuevo m√≥dulo para el Core Bancario. El sistema est√° clasificado como <strong>cr√≠tico DORA</strong> y en alcance <strong>SOX</strong>. Durante las pruebas de integraci√≥n en el pipeline CI/CD, el an√°lisis est√°tico reporta 2 issues de tipo 'Major'.",
                question:"¬øQu√© suceder√° con el despliegue?",
                options:["El despliegue contin√∫a con una advertencia en el log","El despliegue es DETENIDO autom√°ticamente por comportamiento bloqueante","Se env√≠a notificaci√≥n al PO para aprobaci√≥n manual","El despliegue se programa para horario nocturno"],
                correct:1,explanation:"Para sistemas cr√≠ticos DORA/SOX, el Quality Gate de Sonar exige 0% Major. Al tener 2 issues Major, el comportamiento bloqueante DETIENE la construcci√≥n y despliegue."},

            {id:2,category:"Escenario",type:"scenario",difficulty:"expert",
                scenario:"Eres App Owner de un servicio N2. El Service Owner ha decidido que un bug detectado sea marcado como <strong>'Asumido'</strong> porque su impacto es tolerable para el negocio.",
                question:"¬øCu√°les son TODAS las implicaciones correctas de esta decisi√≥n?",
                options:["Solo se documenta en Jira y se cierra el ticket","Se documenta, genera deuda t√©cnica, y el SO es responsable de esta decisi√≥n","Se escala autom√°ticamente al PO para validaci√≥n adicional","El bug se elimina del backlog sin documentaci√≥n"],
                correct:1,explanation:"Cuando un error es 'Asumido': 1) Debe DOCUMENTARSE, 2) Genera deuda t√©cnica, 3) El Service Owner es el responsable de esta decisi√≥n."},

            {id:3,category:"Escenario",type:"scenario",difficulty:"hard",
                scenario:"Tu proyecto necesita usar datos de producci√≥n para pruebas porque los datos sint√©ticos no cubren ciertos escenarios edge-case. El equipo propone copiar directamente la base de datos.",
                question:"¬øCu√°l es el procedimiento COMPLETO correcto seg√∫n la Norma?",
                options:["Copiar datos y notificar al Service Owner","Usar HAD para enmascarar, asegurar seguridad equivalente, tiempo limitado y obtener consentimiento (DyD-09)","Solicitar aprobaci√≥n verbal del PO y proceder","Crear un ticket en Jira y esperar aprobaci√≥n autom√°tica"],
                correct:1,explanation:"Datos reales requieren: 1) Enmascaramiento con HAD, 2) Seguridad equivalente a producci√≥n, 3) Tiempo limitado (eliminar al finalizar), 4) Documento de consentimiento (Control DyD-09 del CVT)."},

            {id:4,category:"Escenario",type:"scenario",difficulty:"expert",
                scenario:"El equipo de desarrollo ha completado las pruebas unitarias con <strong>cobertura del 78%</strong> y <strong>100% Pass</strong>. El Change Lead est√° revisando el CVT para autorizar el pase a producci√≥n.",
                question:"¬øCu√°l debe ser la decisi√≥n del Change Lead?",
                options:["Aprobar el CVT porque el 100% Pass es lo importante","Rechazar el CVT porque la cobertura m√≠nima requerida es 80%","Aprobar con condici√≥n de mejorar cobertura post-producci√≥n","Escalar al Service Owner para decisi√≥n final"],
                correct:1,explanation:"El umbral de cobertura para pruebas unitarias es ‚â• 80%. Con 78% no se cumple el umbral, por lo que el CVT no puede ser aprobado. La cobertura es un requisito bloqueante."},

            {id:5,category:"Escenario",type:"scenario",difficulty:"hard",
                scenario:"Durante la fase de Pruebas E2E, se detecta un defecto en una funcionalidad. El desarrollador insiste que es un 'falso positivo' porque el requerimiento estaba mal especificado.",
                question:"¬øQui√©n tiene la responsabilidad de determinar si realmente es un Falso Positivo?",
                options:["Solo el desarrollador que hizo la implementaci√≥n","El PO/App Owner + DEV conjuntamente","El Service Owner exclusivamente","El Quality Coach del equipo"],
                correct:1,explanation:"La determinaci√≥n de Falso Positivo es responsabilidad conjunta del PO/App Owner + DEV, no solo del desarrollador."},

            {id:6,category:"Escenario",type:"scenario",difficulty:"expert",
                scenario:"Tu aplicaci√≥n tiene una interfaz de usuario que fue modificada en este sprint. La aplicaci√≥n est√° sujeta a la <strong>Ley de Accesibilidad</strong> del pa√≠s donde opera.",
                question:"¬øQu√© tipo de prueba se vuelve OBLIGATORIA en este caso espec√≠fico?",
                options:["Solo pruebas de UI est√°ndar","Pruebas de Accesibilidad porque aplica Ley + hubo cambio en UI","Pruebas de Rendimiento por ser visible al usuario","Pruebas de Seguridad adicionales"],
                correct:1,explanation:"Las pruebas de Accesibilidad son obligatorias cuando: 1) Aplica Ley de Accesibilidad Y 2) Hubo modificaci√≥n en la UI. Ambas condiciones se cumplen."},

            {id:7,category:"Escenario",type:"scenario",difficulty:"hard",
                scenario:"El Release Manager detecta que el CVT est√° incompleto: faltan evidencias de las pruebas de integraci√≥n. El equipo argumenta que las pruebas s√≠ se ejecutaron pero olvidaron adjuntar evidencias.",
                question:"¬øQu√© debe hacer el Release Manager?",
                options:["Confiar en el equipo y aprobar el pase","DETENER el despliegue hasta que el CVT est√© completo con todas las evidencias","Aprobar con la condici√≥n de adjuntar evidencias post-producci√≥n","Escalar al PO para decisi√≥n"],
                correct:1,explanation:"Regla de Oro #15: CVT incompleto = despliegue DETENIDO. Las evidencias son obligatorias y deben estar completas ANTES del pase a producci√≥n."},

            {id:8,category:"Escenario",type:"scenario",difficulty:"expert",
                scenario:"Tu sistema NO es cr√≠tico DORA ni est√° en alcance SOX. Las pruebas se ejecutaron hace <strong>4 meses</strong> y ahora auditor√≠a solicita las evidencias.",
                question:"¬øLas evidencias deber√≠an estar disponibles seg√∫n la Norma?",
                options:["S√≠, porque la retenci√≥n m√≠nima es 6 meses","No necesariamente, porque la retenci√≥n general es 3 meses o √∫ltimas 10 ejecuciones","S√≠, porque todas las evidencias se retienen 12 meses","Depende de la decisi√≥n del Service Owner"],
                correct:1,explanation:"Para sistemas generales (no DORA/SOX), la retenci√≥n m√≠nima es 3 meses o √∫ltimas 10 ejecuciones (lo que ocurra primero). A los 4 meses, las evidencias podr√≠an ya no estar disponibles."},

            // ========== PREGUNTAS DE N√öMEROS Y UMBRALES ==========
            {id:9,category:"Umbrales",type:"numerical",difficulty:"expert",
                question:"¬øCu√°les son los umbrales EXACTOS del Quality Gate de Sonar para el An√°lisis Est√°tico de C√≥digo?",
                options:["0% Critical, 5% Major, 0% Security","0% Critical, 0% Major, 0% Security","5% Critical, 5% Major, 5% Security","1% Critical, 1% Major, 0% Security"],
                correct:1,explanation:"Quality Gate de Sonar: 0% Critical, 0% Major, 0% Security. No se permite ning√∫n issue en estas categor√≠as."},

            {id:10,category:"Umbrales",type:"numerical",difficulty:"hard",
                question:"¬øCu√°l es la cobertura m√≠nima requerida para las pruebas unitarias?",
                options:["70%","75%","80%","85%"],
                correct:2,explanation:"La cobertura m√≠nima para pruebas unitarias es ‚â• 80% junto con 100% Pass."},

            {id:11,category:"Umbrales",type:"numerical",difficulty:"hard",
                question:"¬øCu√°ntos tipos de pruebas deben planificarse en el Plan de Pruebas Estrat√©gico para cada Servicio N2?",
                options:["5 tipos","7 tipos","8 tipos","10 tipos"],
                correct:3,explanation:"Se deben planificar los 10 tipos de pruebas para cada Servicio N2."},

            {id:12,category:"Umbrales",type:"numerical",difficulty:"expert",
                question:"Para sistemas en alcance DORA/SOX, ¬øcu√°l es el tiempo m√≠nimo de retenci√≥n de evidencias?",
                options:["3 meses","6 meses","12 meses","24 meses"],
                correct:2,explanation:"Para DORA/SOX: M√≠nimo 12 meses de retenci√≥n (requisitos de auditor√≠a)."},

            {id:13,category:"Umbrales",type:"numerical",difficulty:"medium",
                question:"Para sistemas generales (no DORA/SOX), la retenci√≥n de evidencias es:",
                options:["1 mes o √∫ltimas 5 ejecuciones","3 meses o √∫ltimas 10 ejecuciones (lo que ocurra primero)","6 meses o √∫ltimas 15 ejecuciones","12 meses obligatorio"],
                correct:1,explanation:"General: 3 meses o √∫ltimas 10 ejecuciones (lo que ocurra primero)."},

            // ========== PREGUNTAS TRICKY DE ROLES ==========
            {id:14,category:"Roles",type:"tricky",difficulty:"expert",
                question:"¬øQui√©n es responsable de la ejecuci√≥n de TODOS los tipos de pruebas seg√∫n la Norma?",
                options:["El Quality Coach (QC)","El App Owner (AO)","El equipo de Desarrollo (DEV)","El Product Owner (PO)"],
                correct:2,explanation:"DEV es responsable de la EJECUCI√ìN de todos los tipos de pruebas. El QC asegura calidad del proceso, el AO asegura umbrales, el PO certifica aceptaci√≥n."},

            {id:15,category:"Roles",type:"tricky",difficulty:"expert",
                question:"¬øQui√©n es responsable FINAL de la deuda t√©cnica en MANTENIMIENTOS (no nuevos desarrollos)?",
                options:["El Product Owner","El Service Owner","El App Owner","El desarrollador"],
                correct:1,explanation:"El PO es responsable de deuda t√©cnica en nuevos desarrollos. Para MANTENIMIENTOS, el responsable es el Service Owner."},

            {id:16,category:"Roles",type:"tricky",difficulty:"hard",
                question:"¬øQui√©n genera y mantiene el Plan de Pruebas Estrat√©gico?",
                options:["El Quality Coach","El Product Owner","El App Owner Principal + App Owners de servicios N2","El Release Manager"],
                correct:2,explanation:"Responsable del Plan de Pruebas Estrat√©gico: App Owner Principal + App Owners de servicios N2 participantes."},

            {id:17,category:"Roles",type:"tricky",difficulty:"hard",
                question:"¬øQui√©n ejecuta las pruebas de Hacking √âtico (HE)?",
                options:["El equipo de InfoSec exclusivamente","El DQ / Red Team","El App Owner (AO)","El desarrollador senior del equipo"],
                correct:2,explanation:"Las pruebas de Hacking √âtico las ejecuta el App Owner (AO), con apoyo de InfoSec."},

            {id:18,category:"Roles",type:"tricky",difficulty:"expert",
                question:"¬øQui√©n es responsable del CVT (Checklist de Validaci√≥n T√©cnica)?",
                options:["El Release Manager","El Service Owner","El Change Lead","El Quality Coach"],
                correct:2,explanation:"El Change Lead es responsable del CVT. Asegura que todas las evidencias est√©n completas antes del pase a producci√≥n."},

            {id:19,category:"Roles",type:"tricky",difficulty:"hard",
                question:"¬øQui√©n ejecuta las pruebas de Rendimiento/Capacidad para sistemas cr√≠ticos DORA?",
                options:["El equipo de desarrollo","El App Owner","El DQ / Red Team","El Service Owner"],
                correct:2,explanation:"DQ / Red Team ejecuta las pruebas de Rendimiento/Capacidad para sistemas cr√≠ticos DORA."},

            {id:20,category:"Roles",type:"tricky",difficulty:"expert",
                question:"¬øQui√©n otorga el Vo.Bo. (Visto Bueno) de las pruebas?",
                options:["El Product Owner","El Release Manager","El Service Owner","El Change Lead"],
                correct:2,explanation:"El Service Owner otorga el Vo.Bo. de las pruebas y es responsable de las decisiones de errores asumidos."},

            // ========== PREGUNTAS DE 7 PRINCIPIOS ==========
            {id:21,category:"Principios",type:"conceptual",difficulty:"expert",
                question:"Si existe conflicto entre dos regulaciones de DIFERENTE rango, ¬øcu√°l se aplica seg√∫n el Principio 1?",
                options:["La m√°s reciente","La m√°s restrictiva","La de MAYOR rango","La que determine el Service Owner"],
                correct:2,explanation:"Principio 1 (Prevalencia Legal): En conflicto entre regulaciones, se aplica la de mayor rango."},

            {id:22,category:"Principios",type:"conceptual",difficulty:"expert",
                question:"Si existe conflicto entre dos regulaciones del MISMO rango, ¬øcu√°l se aplica seg√∫n el Principio 2?",
                options:["La m√°s antigua","La de mayor rango","La M√ÅS RESTRICTIVA","La que beneficie al proyecto"],
                correct:2,explanation:"Principio 2 (Concurrencia): En conflicto entre regulaciones del mismo rango, se aplica la m√°s restrictiva."},

            {id:23,category:"Principios",type:"conceptual",difficulty:"hard",
                question:"Si una prueba no es viable t√©cnicamente, seg√∫n el Principio 3:",
                options:["Se omite autom√°ticamente","Puede no ejecutarse, pero debe DOCUMENTARSE como excepci√≥n + controles compensatorios","Se traslada a la siguiente fase","El PO decide si se ejecuta"],
                correct:1,explanation:"Principio 3: Si no es viable t√©cnicamente, puede no ejecutarse. DOCUMENTAR motivo como excepci√≥n + controles compensatorios."},

            {id:24,category:"Principios",type:"conceptual",difficulty:"hard",
                question:"El principio de Proporcionalidad (Riesgo/Criticidad) establece que:",
                options:["Todos los sistemas se prueban igual","Cuanto m√°s cr√≠tico el sistema, m√°s riguroso el testing","Solo los sistemas DORA requieren pruebas","La proporci√≥n de pruebas depende del presupuesto"],
                correct:1,explanation:"Principio 5: Cuanto m√°s cr√≠tico el sistema, m√°s riguroso el testing. Sistemas DORA cr√≠ticos = m√°xima exigencia."},

            {id:25,category:"Principios",type:"conceptual",difficulty:"medium",
                question:"¬øQu√© significa el principio 'Shift-Left'?",
                options:["Mover el testing a fases finales del SDLC","El testing debe hacerse desde las fases M√ÅS TEMPRANAS del SDLC","Priorizar pruebas del lado izquierdo de la pantalla","Ejecutar pruebas en paralelo"],
                correct:1,explanation:"Shift-Left: El testing debe hacerse desde las fases m√°s tempranas del SDLC. Encontrar defectos pronto = menor coste."},

            // ========== PREGUNTAS DE PROCESO E2E ==========
            {id:26,category:"Proceso",type:"conceptual",difficulty:"hard",
                question:"¬øEn qu√© fase del proceso E2E se genera el Plan de Pruebas Estrat√©gico?",
                options:["Ideaci√≥n y Evaluaci√≥n","Dise√±o","Desarrollo","Pruebas E2E"],
                correct:1,explanation:"El Plan de Pruebas Estrat√©gico se genera en la fase de Dise√±o y se mantiene actualizado durante todo el SDLC."},

            {id:27,category:"Proceso",type:"conceptual",difficulty:"hard",
                question:"¬øEn qu√© fase se definen los criterios de aceptaci√≥n?",
                options:["Dise√±o","Ideaci√≥n y Evaluaci√≥n","Desarrollo","Gesti√≥n de Cambios"],
                correct:1,explanation:"Los criterios de aceptaci√≥n se definen en la fase 1: Ideaci√≥n y Evaluaci√≥n."},

            {id:28,category:"Proceso",type:"conceptual",difficulty:"medium",
                question:"¬øQu√© es el informe RMP y cu√°ndo se genera?",
                options:["Reporte de M√©tricas del Proyecto, se genera al inicio","Riesgo Mitigado por Pruebas, se genera en la fase de Pruebas E2E","Registro de Modificaciones al Plan, se genera en Dise√±o","Reporte de Mantenimiento Preventivo, se genera post-producci√≥n"],
                correct:1,explanation:"RMP = Riesgo Mitigado por Pruebas. Se genera durante la fase de Pruebas E2E al ejecutar pruebas de integraci√≥n."},

            {id:29,category:"Proceso",type:"conceptual",difficulty:"expert",
                question:"¬øCu√°l es el orden correcto de actividades en la fase de Pruebas E2E?",
                options:["Ejecuci√≥n ‚Üí Despliegue ‚Üí Ambientaci√≥n ‚Üí RMP","Ambientaci√≥n ‚Üí Despliegue ‚Üí Ejecuci√≥n ‚Üí Vo.Bo.","Despliegue en Calidad ‚Üí Ambientaci√≥n ‚Üí Ejecuci√≥n ‚Üí RMP ‚Üí Defectos ‚Üí Vo.Bo. SO","Vo.Bo. ‚Üí Despliegue ‚Üí Ejecuci√≥n ‚Üí RMP"],
                correct:2,explanation:"Orden: Despliegue en Calidad ‚Üí Ambientaci√≥n y datos (C204) ‚Üí Ejecuci√≥n ‚Üí RMP ‚Üí Resoluci√≥n defectos ‚Üí Vo.Bo. del SO."},

            // ========== TRAZABILIDAD ==========
            {id:30,category:"Trazabilidad",type:"conceptual",difficulty:"hard",
                question:"¬øCu√°l es la cadena completa de trazabilidad seg√∫n la Norma?",
                options:["C√≥digo ‚Üí Pruebas ‚Üí Bug ‚Üí Fix","Requerimiento ‚Üí Pruebas ‚Üí Resultados ‚Üí CRQ","Jira ‚Üí C204 ‚Üí SonarQube ‚Üí Producci√≥n","Dise√±o ‚Üí Desarrollo ‚Üí Testing ‚Üí Deploy"],
                correct:1,explanation:"Trazabilidad completa: Requerimiento (Jira) ‚Üí Pruebas dise√±adas/ejecutadas (C204) ‚Üí Resultados (C204+T950) ‚Üí CRQ (identificador de cambio)."},

            {id:31,category:"Trazabilidad",type:"conceptual",difficulty:"hard",
                question:"¬øQu√© es el documento C204?",
                options:["El checklist de validaci√≥n t√©cnica","El plan de pruebas estrat√©gico","El formato est√°ndar de matriz de casos de prueba en M√©xico","El informe de riesgo mitigado"],
                correct:2,explanation:"El C204 es el formato est√°ndar de matriz de casos de prueba en M√©xico. Contiene: fechas, maquetas, ligas de Jira, casos de prueba, defectos y evidencias."},

            {id:32,category:"Trazabilidad",type:"conceptual",difficulty:"medium",
                question:"¬øD√≥nde se almacena el CVT (Checklist de Validaci√≥n T√©cnica)?",
                options:["En Jira","En el repositorio de c√≥digo","En el Centro √önico de Conocimiento (CUC)","En SharePoint del equipo"],
                correct:2,explanation:"El CVT se almacena en el Centro √önico de Conocimiento (CUC)."},

            // ========== TIPOS DE PRUEBAS - DETALLE ==========
            {id:33,category:"Tipos de Pruebas",type:"tricky",difficulty:"expert",
                question:"¬øCu√°l de los siguientes tipos de prueba NO bloquea el despliegue si falla?",
                options:["Pruebas Unitarias","An√°lisis Est√°tico","Pruebas de Aceptaci√≥n","Verificaci√≥n Postproducci√≥n"],
                correct:3,explanation:"La Verificaci√≥n Postproducci√≥n NO bloquea porque ya est√° en producci√≥n. Todos los dem√°s tipos S√ç bloquean."},

            {id:34,category:"Tipos de Pruebas",type:"tricky",difficulty:"hard",
                question:"Las pruebas de Rendimiento/Capacidad son obligatorias para:",
                options:["Todos los desarrollos propios","Sistemas con m√°s de 100 usuarios","Solo sistemas cr√≠ticos DORA por disponibilidad","Sistemas con bases de datos grandes"],
                correct:2,explanation:"Rendimiento/Capacidad: Solo obligatorias para sistemas cr√≠ticos DORA por disponibilidad."},

            {id:35,category:"Tipos de Pruebas",type:"tricky",difficulty:"hard",
                question:"¬øQu√© incluyen las pruebas de Seguridad seg√∫n la Norma?",
                options:["Solo SAST","Solo Hacking √âtico","SAST + Hacking √âtico","SAST + DAST + Hacking √âtico"],
                correct:2,explanation:"Las pruebas de Seguridad incluyen: SAST (An√°lisis Est√°tico de Seguridad) + Hacking √âtico."},

            {id:36,category:"Tipos de Pruebas",type:"conceptual",difficulty:"medium",
                question:"¬øCu√°ndo aplican las pruebas de Regresi√≥n?",
                options:["Siempre en todos los desarrollos","Solo en primer despliegue","Cuando aplique: versiones menores, parches, mayores con dependencias","Solo para sistemas DORA"],
                correct:2,explanation:"Pruebas de Regresi√≥n: Cuando aplique (versiones menores, parches, mayores con dependencias)."},

            {id:37,category:"Tipos de Pruebas",type:"conceptual",difficulty:"hard",
                question:"¬øQui√©n CERTIFICA las pruebas de aceptaci√≥n?",
                options:["El Quality Coach","El desarrollador","El Product Owner","El Service Owner"],
                correct:2,explanation:"Pruebas de Aceptaci√≥n: El PO certifica. DEV y QA ejecutan. Requiere aprobaci√≥n expl√≠cita del PO."},

            // ========== TERCEROS ==========
            {id:38,category:"Terceros",type:"conceptual",difficulty:"hard",
                question:"Para componentes de terceros integrados en desarrollos propios, ¬øqu√© se requiere?",
                options:["Solo pruebas funcionales","SCA, SAST y verificaci√≥n de integridad","No se requieren pruebas adicionales","Solo revisi√≥n de licencias"],
                correct:1,explanation:"Componentes de terceros requieren: SCA (An√°lisis de Composici√≥n), SAST y Verificaci√≥n de Firmas de Integridad."},

            {id:39,category:"Terceros",type:"conceptual",difficulty:"hard",
                question:"¬øQu√© identifica el SCA (Software Composition Analysis)?",
                options:["Vulnerabilidades en c√≥digo propio","Errores de sintaxis","Riesgos en c√≥digo de terceros, versiones obsoletas y licencias","Problemas de rendimiento"],
                correct:2,explanation:"SCA: identifica riesgos en c√≥digo de terceros, versiones obsoletas, licencias."},

            {id:40,category:"Terceros",type:"conceptual",difficulty:"medium",
                question:"La verificaci√≥n de Firmas de Integridad protege contra:",
                options:["Vulnerabilidades conocidas","Code Tampering (manipulaci√≥n del c√≥digo)","Versiones obsoletas","Problemas de licencias"],
                correct:1,explanation:"Verificaci√≥n de Firmas de Integridad: asegurar que el componente no ha sido manipulado (Code Tampering)."},

            // ========== ESCENARIOS ADICIONALES ==========
            {id:41,category:"Escenario",type:"scenario",difficulty:"expert",
                scenario:"El equipo complet√≥ todas las pruebas exitosamente. Sin embargo, durante la Verificaci√≥n Postproducci√≥n se detecta una <strong>no conformidad grave</strong> que afecta transacciones financieras.",
                question:"¬øC√≥mo debe tratarse esta situaci√≥n seg√∫n la Norma?",
                options:["Se documenta para el siguiente release","Se trata con ALTA PRIORIDAD","Se genera un ticket de baja prioridad","Se notifica al equipo BEx para que lo resuelvan"],
                correct:1,explanation:"Regla de Oro #14: No conformidades graves en Verificaci√≥n Postproducci√≥n = alta prioridad."},

            {id:42,category:"Escenario",type:"scenario",difficulty:"hard",
                scenario:"Tu equipo recibe un componente de software de un proveedor externo que ser√° integrado en tu desarrollo. El proveedor asegura que el software ya fue probado exhaustivamente.",
                question:"¬øQu√© pruebas son necesarias seg√∫n la Norma de BBVA?",
                options:["Ninguna, si el proveedor certifica calidad","Solo pruebas funcionales de integraci√≥n","SCA, SAST y verificaci√≥n de integridad, independientemente de lo que diga el proveedor","Solo si el PO lo solicita"],
                correct:2,explanation:"Para componentes de terceros, SIEMPRE se requiere: SCA, SAST y verificaci√≥n de integridad, sin importar certificaciones del proveedor."},

            {id:43,category:"Escenario",type:"scenario",difficulty:"expert",
                scenario:"Hay conflicto entre una regulaci√≥n local de M√©xico y una directriz global de BBVA. La regulaci√≥n local es m√°s antigua pero la directriz global es m√°s reciente.",
                question:"Seg√∫n el Principio 1 (Prevalencia Legal), ¬øcu√°l se aplica?",
                options:["La directriz global por ser m√°s reciente","La regulaci√≥n local si tiene mayor rango legal","Siempre la directriz global de BBVA","La que el Service Owner determine"],
                correct:1,explanation:"Principio 1: Se aplica la de MAYOR RANGO. Si la regulaci√≥n local tiene mayor rango legal que una directriz corporativa, prevalece la local."},

            {id:44,category:"Escenario",type:"scenario",difficulty:"hard",
                scenario:"Durante el sprint planning, el PO solicita que se omitan las pruebas de accesibilidad para acelerar la entrega. La aplicaci√≥n tiene UI y est√° sujeta a Ley de Accesibilidad.",
                question:"¬øQu√© debe hacer el equipo?",
                options:["Aceptar porque el PO tiene la decisi√≥n final","Rechazar porque las pruebas de Accesibilidad son OBLIGATORIAS en este caso","Escalar al Service Owner","Ejecutar pruebas parciales"],
                correct:1,explanation:"Las pruebas de Accesibilidad son obligatorias cuando aplica Ley de Accesibilidad + hay cambio en UI. No se pueden omitir."},

            // ========== PREGUNTAS TRICKY ADICIONALES ==========
            {id:45,category:"Conceptos",type:"tricky",difficulty:"expert",
                question:"La pregunta clave de la fase de VERIFICACI√ìN es:",
                options:["¬øSe construy√≥ un buen sistema?","¬øEl negocio est√° satisfecho?","¬øSe construy√≥ BIEN el sistema?","¬øEl usuario final lo acepta?"],
                correct:2,explanation:"Verificaci√≥n: '¬øSe construy√≥ BIEN el sistema?' (equipos t√©cnicos comprueban seg√∫n requisitos). Validaci√≥n: '¬øSe construy√≥ un BUEN sistema?' (PO comprueba necesidades de negocio)."},

            {id:46,category:"Conceptos",type:"tricky",difficulty:"hard",
                question:"¬øQu√© significa que los bugs 'NO deben postergarse indefinidamente'?",
                options:["Deben resolverse en el mismo sprint","La deuda t√©cnica debe gestionarse y eventualmente saldarse","Son responsabilidad exclusiva del desarrollador","Se escalan autom√°ticamente despu√©s de 2 semanas"],
                correct:1,explanation:"La deuda t√©cnica NO se acumula indefinidamente. El PO/SO es responsable de saldarla. Regulado por la Norma de Gesti√≥n de Deuda T√©cnica."},

            {id:47,category:"Conceptos",type:"tricky",difficulty:"hard",
                question:"¬øPor qu√© NO se deben probar solo 'happy paths'?",
                options:["Porque no son casos de prueba v√°lidos","Porque solo cubren el 50% del c√≥digo","Porque los defectos se ocultan en caminos alternos y situaciones de error","Porque la Norma lo proh√≠be expl√≠citamente"],
                correct:2,explanation:"Los defectos se ocultan en los comportamientos no ideales. Se DEBEN probar caminos alternos y situaciones de error, no solo escenarios de √©xito."},

            {id:48,category:"Conceptos",type:"tricky",difficulty:"expert",
                question:"¬øQu√© proceso se menciona para gesti√≥n de incidentes en Entornos Previos (EEPP) desde septiembre 2025?",
                options:["CVT Process","RMP Process","FDS (Frontline Development Support)","C204 Process"],
                correct:2,explanation:"FDS (Frontline Development Support): Desde septiembre 2025, nuevo proceso global para gesti√≥n de incidentes en EEPP. Herramienta: Helix (tickets INC)."},

            {id:49,category:"Herramientas",type:"conceptual",difficulty:"medium",
                question:"¬øQu√© herramienta se usa para tickets de incidentes en FDS?",
                options:["Jira","ServiceNow","Helix (tickets INC)","Remedy"],
                correct:2,explanation:"FDS usa Helix como herramienta principal (tickets INC)."},

            {id:50,category:"Herramientas",type:"conceptual",difficulty:"medium",
                question:"¬øQu√© herramienta se usa para enmascarar datos de producci√≥n?",
                options:["SonarQube","ACIS","HAD","Jira"],
                correct:2,explanation:"HAD es la herramienta para descargar y enmascarar datos de producci√≥n."},

            // ========== REGLAS DE ORO ==========
            {id:51,category:"Reglas de Oro",type:"conceptual",difficulty:"hard",
                question:"Seg√∫n las Reglas de Oro, ¬øqu√© tipos de software deben probarse antes de producci√≥n?",
                options:["Solo evolutivos y nuevos desarrollos","Solo correctivos cr√≠ticos","TODO software: evolutivos, correctivos, primera entrega, sin excepci√≥n","Solo lo que determine el PO"],
                correct:2,explanation:"Regla #1: TODO software debe probarse antes de producci√≥n, sin excepci√≥n (evolutivos, correctivos, primera entrega)."},

            {id:52,category:"Reglas de Oro",type:"conceptual",difficulty:"medium",
                question:"El principio de M√°xima Automatizaci√≥n significa:",
                options:["Automatizar el 100% de las pruebas","Priorizar pruebas autom√°ticas sobre procedimientos manuales","Solo usar herramientas autom√°ticas de testing","Eliminar completamente las pruebas manuales"],
                correct:1,explanation:"Principio 6: Priorizar pruebas autom√°ticas y mecanismos automatizados sobre procedimientos manuales."},

            {id:53,category:"Reglas de Oro",type:"tricky",difficulty:"expert",
                question:"Si el Quality Gate de Sonar reporta 1 issue de tipo 'Security', ¬øqu√© sucede?",
                options:["Se permite el despliegue con advertencia","El despliegue es BLOQUEADO","Se genera un ticket para revisi√≥n posterior","Depende de la criticidad del sistema"],
                correct:1,explanation:"El umbral es 0% Security Issues. Con 1 issue de Security, el Quality Gate falla y el despliegue es bloqueado."},

            {id:54,category:"Conceptos",type:"tricky",difficulty:"hard",
                question:"¬øCu√°l es la diferencia entre Verificaci√≥n y Validaci√≥n en el SDLC?",
                options:["Son sin√≥nimos con diferente nombre","Verificaci√≥n es para c√≥digo, Validaci√≥n para documentaci√≥n","Verificaci√≥n: t√©cnicos comprueban construcci√≥n; Validaci√≥n: PO comprueba necesidades del negocio","Verificaci√≥n es manual, Validaci√≥n es autom√°tica"],
                correct:2,explanation:"Verificaci√≥n: equipos t√©cnicos comprueban construcci√≥n seg√∫n requisitos. Validaci√≥n: PO comprueba que cubre necesidades del negocio."},

            {id:55,category:"Conceptos",type:"conceptual",difficulty:"hard",
                question:"Las regulaciones que impactan la Norma de Testing incluyen:",
                options:["Solo SOX","Solo DORA","DORA, SOX, EBA/GL/2019/4, entre otras","Solo regulaciones mexicanas"],
                correct:2,explanation:"La Norma re√∫ne criterios de m√∫ltiples regulaciones: DORA, SOX, EBA/GL/2019/4, etc."}
        ];

        let questions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let answerResults = {};
        let correctCount = 0;
        let incorrectCount = 0;
        let shuffledOptions = {};

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function shuffleOptionsForQuestion(question, qIndex) {
            const indices = question.options.map((_, i) => i);
            const shuffledIndices = shuffleArray(indices);
            const newCorrectIndex = shuffledIndices.indexOf(question.correct);
            shuffledOptions[qIndex] = { indices: shuffledIndices, correctIndex: newCorrectIndex };
        }

        function startExam() {
            let limit = parseInt(document.getElementById('questionLimit').value) || 55;
            limit = Math.max(10, Math.min(55, limit));
            questions = shuffleArray([...allQuestions]).slice(0, limit);
            shuffledOptions = {};
            questions.forEach((q, i) => shuffleOptionsForQuestion(q, i));
            currentQuestionIndex = 0;
            userAnswers = {};
            answerResults = {};
            correctCount = 0;
            incorrectCount = 0;
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('examScreen').classList.remove('hidden');
            document.getElementById('totalQuestions').textContent = questions.length;
            renderQuestionNav();
            renderQuestion();
            updateStats();
        }

        function renderQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            questions.forEach((_, index) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                if (index === currentQuestionIndex) btn.classList.add('current');
                if (answerResults[index] === true) btn.classList.add('correct');
                if (answerResults[index] === false) btn.classList.add('incorrect');
                btn.textContent = index + 1;
                btn.onclick = () => goToQuestion(index);
                nav.appendChild(btn);
            });
        }

        function goToQuestion(index) {
            currentQuestionIndex = index;
            renderQuestion();
            renderQuestionNav();
        }

        function updateStats() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('incorrectCount').textContent = incorrectCount;
            const answeredCount = Object.keys(userAnswers).length;
            const progress = (answeredCount / questions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        function renderQuestion() {
            const question = questions[currentQuestionIndex];
            const shuffled = shuffledOptions[currentQuestionIndex];
            const isAnswered = userAnswers[currentQuestionIndex] !== undefined;
            const userAnswer = userAnswers[currentQuestionIndex];
            const isCorrect = answerResults[currentQuestionIndex];
            
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionNumber').textContent = `Pregunta ${currentQuestionIndex + 1}`;
            document.getElementById('questionCategory').textContent = question.category;
            
            const typeLabel = document.getElementById('questionType');
            const typeMap = {scenario:'Escenario',conceptual:'Conceptual',numerical:'Num√©rica',tricky:'Detalle'};
            typeLabel.textContent = typeMap[question.type] || question.type;
            typeLabel.className = `question-type ${question.type}`;
            
            const diffBadge = document.getElementById('difficultyBadge');
            diffBadge.textContent = question.difficulty === 'expert' ? 'Experto' : question.difficulty === 'hard' ? 'Dif√≠cil' : 'Media';
            diffBadge.className = `difficulty-badge ${question.difficulty}`;
            
            const scenarioBox = document.getElementById('scenarioBox');
            if (question.scenario) {
                scenarioBox.innerHTML = `<div class="scenario-box">üìã <strong>Escenario:</strong><br>${question.scenario}</div>`;
            } else {
                scenarioBox.innerHTML = '';
            }
            
            document.getElementById('questionText').innerHTML = question.question;
            
            const questionCard = document.getElementById('questionCard');
            questionCard.classList.remove('answered-correct', 'answered-incorrect');
            if (isAnswered) questionCard.classList.add(isCorrect ? 'answered-correct' : 'answered-incorrect');
            
            const optionsList = document.getElementById('optionsList');
            const letters = ['A', 'B', 'C', 'D', 'E'];
            optionsList.innerHTML = shuffled.indices.map((originalIndex, displayIndex) => {
                const option = question.options[originalIndex];
                let className = 'option';
                let feedback = '';
                if (isAnswered) {
                    className += ' disabled';
                    if (displayIndex === shuffled.correctIndex) {
                        className += ' correct';
                        feedback = displayIndex === userAnswer ? '<span class="option-feedback correct">‚úì ¬°Correcto!</span>' : '<span class="option-feedback correct">‚úì Correcta</span>';
                        if (displayIndex !== userAnswer) className += ' show-correct';
                    } else if (displayIndex === userAnswer) {
                        className += ' incorrect';
                        feedback = '<span class="option-feedback incorrect">‚úó Incorrecto</span>';
                    }
                }
                return `<div class="${className}" onclick="${isAnswered ? '' : `selectOption(${displayIndex})`}"><span class="option-letter">${letters[displayIndex]}</span><span class="option-text">${option}</span>${feedback}</div>`;
            }).join('');
            
            const feedbackContainer = document.getElementById('feedbackContainer');
            if (isAnswered) {
                let feedbackHTML = isCorrect ? '<div class="feedback-message correct"><span class="feedback-icon">‚úÖ</span><span>¬°Correcto!</span></div>' : '<div class="feedback-message incorrect"><span class="feedback-icon">‚ùå</span><span>Incorrecto</span></div>';
                if (question.explanation) feedbackHTML += `<div class="explanation"><strong>üìñ Explicaci√≥n:</strong> ${question.explanation}</div>`;
                feedbackContainer.innerHTML = feedbackHTML;
            } else feedbackContainer.innerHTML = '';
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            if (currentQuestionIndex === questions.length - 1) {
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('finishBtn').classList.remove('hidden');
            } else {
                document.getElementById('nextBtn').classList.remove('hidden');
                document.getElementById('finishBtn').classList.add('hidden');
            }
        }

        function selectOption(displayIndex) {
            if (userAnswers[currentQuestionIndex] !== undefined) return;
            const shuffled = shuffledOptions[currentQuestionIndex];
            const isCorrect = displayIndex === shuffled.correctIndex;
            userAnswers[currentQuestionIndex] = displayIndex;
            answerResults[currentQuestionIndex] = isCorrect;
            if (isCorrect) correctCount++; else incorrectCount++;
            updateStats();
            renderQuestion();
            renderQuestionNav();
        }

        function prevQuestion() { if (currentQuestionIndex > 0) { currentQuestionIndex--; renderQuestion(); renderQuestionNav(); } }
        function nextQuestion() { if (currentQuestionIndex < questions.length - 1) { currentQuestionIndex++; renderQuestion(); renderQuestionNav(); } }

        function finishExam() {
            const unanswered = questions.length - Object.keys(userAnswers).length;
            const score = Math.round((correctCount / questions.length) * 100);
            document.getElementById('examScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            document.getElementById('finalScore').textContent = `${score}%`;
            document.getElementById('finalCorrectCount').textContent = correctCount;
            document.getElementById('finalIncorrectCount').textContent = incorrectCount;
            document.getElementById('finalUnansweredCount').textContent = unanswered;
            let gradeText = '', gradeEmoji = '';
            if (score >= 90) { gradeText = 'Excelente'; gradeEmoji = 'üèÜ'; }
            else if (score >= 80) { gradeText = 'Muy Bien'; gradeEmoji = 'üéâ'; }
            else if (score >= 75) { gradeText = 'Aprobado'; gradeEmoji = '‚úÖ'; }
            else if (score >= 60) { gradeText = 'Necesita Mejorar'; gradeEmoji = 'üìö'; }
            else { gradeText = 'No Aprobado'; gradeEmoji = '‚ùå'; }
            document.getElementById('gradeText').textContent = `${gradeEmoji} ${gradeText}`;
        }

        function reviewAnswers() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('reviewScreen').classList.remove('hidden');
            const container = document.getElementById('reviewContainer');
            const letters = ['A', 'B', 'C', 'D', 'E'];
            const typeMap = {scenario:'Escenario',conceptual:'Conceptual',numerical:'Num√©rica',tricky:'Detalle'};
            container.innerHTML = questions.map((question, qIndex) => {
                const shuffled = shuffledOptions[qIndex];
                const userAnswer = userAnswers[qIndex];
                const isCorrect = answerResults[qIndex];
                const isUnanswered = userAnswer === undefined;
                return `<div class="question-card fade-in" style="animation-delay: ${qIndex * 0.02}s">
                    <div class="question-header">
                        <span class="question-number">Pregunta ${qIndex + 1}</span>
                        <span class="question-category">${question.category}</span>
                        <span class="question-type ${question.type}">${typeMap[question.type]||question.type}</span>
                        <span style="margin-left: auto; font-size: 1.5rem;">${isUnanswered ? '‚ö†Ô∏è' : (isCorrect ? '‚úÖ' : '‚ùå')}</span>
                    </div>
                    ${question.scenario ? `<div class="scenario-box">üìã <strong>Escenario:</strong><br>${question.scenario}</div>` : ''}
                    <p class="question-text">${question.question}</p>
                    <div class="options-list">${shuffled.indices.map((originalIndex, displayIndex) => {
                        const option = question.options[originalIndex];
                        let className = 'option disabled';
                        let feedback = '';
                        if (displayIndex === shuffled.correctIndex) { className += ' correct'; feedback = '<span class="option-feedback correct">‚úì Correcta</span>'; }
                        else if (displayIndex === userAnswer && !isCorrect) { className += ' incorrect'; feedback = '<span class="option-feedback incorrect">Tu respuesta</span>'; }
                        return `<div class="${className}"><span class="option-letter">${letters[displayIndex]}</span><span class="option-text">${option}</span>${feedback}</div>`;
                    }).join('')}</div>
                    ${question.explanation ? `<div class="explanation"><strong>üìñ Explicaci√≥n:</strong> ${question.explanation}</div>` : ''}
                </div>`;
            }).join('');
        }

        function backToResults() { document.getElementById('reviewScreen').classList.add('hidden'); document.getElementById('resultsScreen').classList.remove('hidden'); }

        function restartExam() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('reviewScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
            questions = []; currentQuestionIndex = 0; userAnswers = {}; answerResults = {}; correctCount = 0; incorrectCount = 0; shuffledOptions = {};
        }
    </script>
</body>
</html>
