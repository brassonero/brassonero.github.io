<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen EXTREMO - Cumplimiento Normativo y Resiliencia BBVA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #050508;
            --bg-secondary: #0c0c12;
            --bg-tertiary: #14141e;
            --bg-card: #0e0e16;
            --accent-red: #dc2626;
            --accent-orange: #ea580c;
            --accent-amber: #d97706;
            --accent-purple: #7c3aed;
            --accent-pink: #db2777;
            --accent-cyan: #0891b2;
            --accent-emerald: #059669;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --border-color: #1f1f2e;
            --glow-purple: 0 0 40px rgba(124, 58, 237, 0.3);
            --glow-red: 0 0 30px rgba(220, 38, 38, 0.25);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .bg-pattern {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: 
                radial-gradient(ellipse at 15% 85%, rgba(124, 58, 237, 0.1) 0%, transparent 45%),
                radial-gradient(ellipse at 85% 15%, rgba(220, 38, 38, 0.08) 0%, transparent 45%),
                radial-gradient(ellipse at 50% 50%, rgba(8, 145, 178, 0.05) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 2.5rem;
            padding: 2.5rem 2rem;
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
            border-radius: 24px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-red), var(--accent-orange), var(--accent-purple));
            background-size: 300% 100%;
            animation: gradient-shift 4s ease infinite;
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .logo-icon {
            width: 80px; height: 80px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-red));
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: var(--glow-purple);
            animation: pulse-glow 2.5s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 25px rgba(124, 58, 237, 0.3); }
            50% { box-shadow: 0 0 50px rgba(124, 58, 237, 0.5); }
        }

        .header h1 {
            font-size: 1.9rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-top: 0.5rem;
        }

        .extreme-badge {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-red));
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 700;
            letter-spacing: 1.5px;
            color: white;
            margin-top: 1rem;
            animation: pulse-badge 1.5s ease-in-out infinite;
            box-shadow: var(--glow-purple);
        }

        @keyframes pulse-badge {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        .warning-banner {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(220, 38, 38, 0.08));
            border: 2px solid var(--accent-purple);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            text-align: left;
        }

        .warning-banner h3 {
            color: var(--accent-purple);
            font-size: 1.1rem;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .warning-banner ul {
            color: var(--text-secondary);
            font-size: 0.9rem;
            padding-left: 1.5rem;
            line-height: 1.9;
        }

        .warning-banner li strong {
            color: var(--accent-red);
        }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            padding: 1.2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card.correct-stat { border-color: var(--accent-emerald); }
        .stat-card.incorrect-stat { border-color: var(--accent-red); }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 600;
        }

        .stat-value.neutral { background: linear-gradient(135deg, var(--accent-purple), var(--accent-red)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-value.correct { color: var(--accent-emerald); }
        .stat-value.incorrect { color: var(--accent-red); }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.3rem;
        }

        .progress-container {
            background: var(--bg-tertiary);
            border-radius: 10px;
            height: 10px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-red));
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .question-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .question-card.answered-correct { border-color: var(--accent-emerald); box-shadow: 0 0 25px rgba(5, 150, 105, 0.2); }
        .question-card.answered-incorrect { border-color: var(--accent-red); box-shadow: var(--glow-red); }

        .question-header {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .question-number {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-red));
            color: white;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 10px;
            font-size: 0.85rem;
        }

        .question-category {
            font-size: 0.8rem;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
        }

        .question-type {
            font-size: 0.7rem;
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .question-type.scenario { background: var(--accent-pink); color: white; }
        .question-type.trap { background: var(--accent-red); color: white; }
        .question-type.numerical { background: var(--accent-cyan); color: white; }
        .question-type.combined { background: var(--accent-purple); color: white; }
        .question-type.negative { background: var(--accent-orange); color: white; }
        .question-type.roles { background: var(--accent-amber); color: black; }

        .difficulty-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            font-weight: 600;
        }
        .difficulty-badge.extreme { background: linear-gradient(135deg, #7c3aed, #dc2626); color: white; animation: pulse-badge 2s ease-in-out infinite; }
        .difficulty-badge.expert { background: #dc2626; color: white; }
        .difficulty-badge.hard { background: var(--accent-orange); color: white; }

        .question-text {
            font-size: 1.05rem;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        .scenario-box {
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.08), rgba(220, 38, 38, 0.06));
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-left: 4px solid var(--accent-purple);
            border-radius: 12px;
            padding: 1.2rem;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .scenario-box strong { color: var(--accent-purple); }
        .scenario-box .highlight { background: rgba(220, 38, 38, 0.2); padding: 0.1rem 0.3rem; border-radius: 3px; color: var(--accent-red); }
        .scenario-box .data { background: rgba(8, 145, 178, 0.2); padding: 0.1rem 0.3rem; border-radius: 3px; color: var(--accent-cyan); }

        .options-list { display: flex; flex-direction: column; gap: 0.75rem; }

        .option {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem 1.2rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover:not(.disabled) {
            border-color: var(--accent-purple);
            background: rgba(124, 58, 237, 0.1);
            transform: translateX(4px);
        }

        .option.correct { border-color: var(--accent-emerald); background: rgba(5, 150, 105, 0.15); }
        .option.incorrect { border-color: var(--accent-red); background: rgba(220, 38, 38, 0.15); }
        .option.disabled { cursor: not-allowed; opacity: 0.7; }
        .option.show-correct { border-color: var(--accent-emerald); background: rgba(5, 150, 105, 0.1); }

        .option-letter {
            width: 38px; height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .option:hover:not(.disabled) .option-letter { background: var(--accent-purple); color: white; }
        .option.correct .option-letter { background: var(--accent-emerald); color: white; }
        .option.incorrect .option-letter { background: var(--accent-red); color: white; }
        .option.show-correct .option-letter { background: var(--accent-emerald); color: white; }

        .option-text { flex: 1; color: var(--text-primary); font-size: 0.95rem; line-height: 1.5; }

        .option-feedback { font-size: 0.85rem; font-weight: 500; margin-left: auto; flex-shrink: 0; }
        .option-feedback.correct { color: var(--accent-emerald); }
        .option-feedback.incorrect { color: var(--accent-red); }

        .feedback-message {
            margin-top: 1.5rem;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 500;
        }

        .feedback-message.correct { background: rgba(5, 150, 105, 0.15); border: 1px solid var(--accent-emerald); color: var(--accent-emerald); }
        .feedback-message.incorrect { background: rgba(220, 38, 38, 0.15); border: 1px solid var(--accent-red); color: var(--accent-red); }

        .feedback-icon { font-size: 1.5rem; }

        .explanation {
            margin-top: 1rem;
            padding: 1.2rem;
            background: rgba(124, 58, 237, 0.06);
            border-left: 3px solid var(--accent-purple);
            border-radius: 0 10px 10px 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .explanation strong { color: var(--accent-purple); }
        .explanation .trap-warning { color: var(--accent-red); font-weight: 600; }
        .explanation .key-point { color: var(--accent-cyan); }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            padding: 0.9rem 2rem;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary { background: linear-gradient(135deg, var(--accent-purple), var(--accent-red)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--glow-purple); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-secondary:hover { border-color: var(--accent-purple); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .question-nav {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(42px, 1fr));
            gap: 0.4rem;
            padding: 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            margin-bottom: 2rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .nav-btn {
            width: 42px; height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-btn:hover { border-color: var(--accent-purple); color: var(--accent-purple); }
        .nav-btn.current { background: linear-gradient(135deg, var(--accent-purple), var(--accent-red)); border-color: transparent; color: white; }
        .nav-btn.correct { background: var(--accent-emerald); border-color: transparent; color: white; }
        .nav-btn.incorrect { background: var(--accent-red); border-color: transparent; color: white; }

        .results-container { text-align: center; padding: 3rem; }
        .results-score { font-size: 5rem; font-weight: 700; background: linear-gradient(135deg, var(--accent-purple), var(--accent-red)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 1rem; }
        .results-grade { font-size: 2rem; margin-bottom: 2rem; }
        .results-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin: 2rem 0; }
        .result-stat { background: var(--bg-tertiary); padding: 1.5rem; border-radius: 14px; }
        .result-stat-value { font-family: 'JetBrains Mono', monospace; font-size: 2.2rem; font-weight: 600; }
        .result-stat-value.correct { color: var(--accent-emerald); }
        .result-stat-value.incorrect { color: var(--accent-red); }
        .result-stat-value.unanswered { color: var(--accent-amber); }

        .start-screen { text-align: center; padding: 3rem; }
        .start-screen h2 { font-size: 1.8rem; margin-bottom: 1.5rem; color: var(--accent-purple); }

        .start-info { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 2rem 0; text-align: left; }
        .info-item { background: var(--bg-tertiary); padding: 1.2rem; border-radius: 14px; display: flex; align-items: center; gap: 1rem; border: 1px solid var(--border-color); }
        .info-icon { width: 48px; height: 48px; background: linear-gradient(135deg, var(--accent-purple), var(--accent-red)); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; }
        .info-text h4 { font-size: 0.85rem; color: var(--text-muted); font-weight: 400; }
        .info-text p { font-size: 1.05rem; color: var(--text-primary); font-weight: 600; }

        .question-limit { margin: 1.5rem 0; padding: 1.2rem; background: var(--bg-tertiary); border-radius: 14px; border: 1px solid var(--border-color); }
        .question-limit label { display: block; margin-bottom: 0.5rem; color: var(--text-secondary); }
        .question-limit input { width: 100px; padding: 0.6rem; border-radius: 10px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary); font-family: 'JetBrains Mono', monospace; font-size: 1rem; text-align: center; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-purple); }

        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .stats-bar { grid-template-columns: repeat(2, 1fr); }
            .header h1 { font-size: 1.5rem; }
            .start-info { grid-template-columns: 1fr; }
            .results-stats { grid-template-columns: 1fr; }
            .navigation { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
        }

        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    
    <div class="container">
        <header class="header">
            <div class="logo-container">
                <div class="logo-icon">‚ö°</div>
                <div>
                    <h1>Cumplimiento Normativo y Resiliencia</h1>
                    <p class="subtitle">Systems Engineering BBVA ‚Äî Nivel EXTREMO</p>
                </div>
            </div>
            <div class="extreme-badge">‚ò†Ô∏è DIFICULTAD M√ÅXIMA ‚ò†Ô∏è</div>
        </header>

        <div id="startScreen" class="question-card start-screen">
            <h2>üéØ Evaluaci√≥n de Certificaci√≥n Extrema</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                Examen dise√±ado para evaluar conocimiento profundo del marco normativo.<br>
                Incluye escenarios complejos, trampas sutiles y preguntas de combinaci√≥n.
            </p>

            <div class="warning-banner">
                <h3>‚ö†Ô∏è CARACTER√çSTICAS DEL EXAMEN</h3>
                <ul>
                    <li><strong>Escenarios multi-factor:</strong> Debes considerar m√∫ltiples normas simult√°neamente</li>
                    <li><strong>Trampas de roles:</strong> 1¬™ vs 2¬™ vs 3¬™ L√≠nea - diferencias sutiles</li>
                    <li><strong>Preguntas negativas:</strong> "¬øCu√°l NO es...?" - Lee con extremo cuidado</li>
                    <li><strong>M√©tricas exactas:</strong> RTO, RPO, MTTR, MTTD - valores y definiciones</li>
                    <li><strong>CVT detallado:</strong> 16 controles espec√≠ficos y sus requisitos</li>
                    <li><strong>CIDA completo:</strong> Confidencialidad, Integridad, Disponibilidad, Autenticidad</li>
                </ul>
            </div>

            <div class="start-info">
                <div class="info-item">
                    <div class="info-icon">üìã</div>
                    <div class="info-text">
                        <h4>Total de preguntas</h4>
                        <p>75 preguntas</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">üéØ</div>
                    <div class="info-text">
                        <h4>Nivel</h4>
                        <p>EXTREMO</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">‚è±Ô∏è</div>
                    <div class="info-text">
                        <h4>Tiempo sugerido</h4>
                        <p>100 minutos</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">‚úÖ</div>
                    <div class="info-text">
                        <h4>Para aprobar</h4>
                        <p>80% m√≠nimo</p>
                    </div>
                </div>
            </div>

            <div class="question-limit">
                <label>N√∫mero de preguntas:</label>
                <input type="number" id="questionLimit" min="10" max="75" value="75">
                <span style="color: var(--text-muted); margin-left: 0.5rem;">(10-75)</span>
            </div>

            <button class="btn btn-primary" onclick="startExam()" style="margin-top: 1.5rem; padding: 1rem 3rem; font-size: 1.1rem;">
                ‚ö° Iniciar Examen Extremo
            </button>
        </div>

        <div id="examScreen" class="hidden">
            <div class="stats-bar">
                <div class="stat-card"><div class="stat-value neutral" id="currentQuestion">1</div><div class="stat-label">Actual</div></div>
                <div class="stat-card correct-stat"><div class="stat-value correct" id="correctCount">0</div><div class="stat-label">Correctas</div></div>
                <div class="stat-card incorrect-stat"><div class="stat-value incorrect" id="incorrectCount">0</div><div class="stat-label">Incorrectas</div></div>
                <div class="stat-card"><div class="stat-value neutral" id="totalQuestions">75</div><div class="stat-label">Total</div></div>
            </div>
            <div class="progress-container"><div class="progress-bar" id="progressBar" style="width: 0%"></div></div>
            <div class="question-nav" id="questionNav"></div>
            <div class="question-card fade-in" id="questionCard">
                <div class="question-header">
                    <span class="question-number" id="questionNumber">Pregunta 1</span>
                    <span class="question-category" id="questionCategory">Categor√≠a</span>
                    <span class="question-type" id="questionType">Tipo</span>
                    <span class="difficulty-badge" id="difficultyBadge">Dificultad</span>
                </div>
                <div id="scenarioBox"></div>
                <p class="question-text" id="questionText">Texto...</p>
                <div class="options-list" id="optionsList"></div>
                <div id="feedbackContainer"></div>
            </div>
            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()">‚Üê Anterior</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">Siguiente ‚Üí</button>
                <button class="btn btn-primary hidden" id="finishBtn" onclick="finishExam()">üèÅ Finalizar</button>
            </div>
        </div>

        <div id="resultsScreen" class="hidden">
            <div class="question-card results-container">
                <h2 style="margin-bottom: 1rem;">Resultados del Examen Extremo</h2>
                <div class="results-score" id="finalScore">0%</div>
                <div class="results-grade" id="gradeText">Calificaci√≥n</div>
                <div class="results-stats">
                    <div class="result-stat"><div class="result-stat-value correct" id="finalCorrect">0</div><div class="stat-label">Correctas</div></div>
                    <div class="result-stat"><div class="result-stat-value incorrect" id="finalIncorrect">0</div><div class="stat-label">Incorrectas</div></div>
                    <div class="result-stat"><div class="result-stat-value unanswered" id="finalUnanswered">0</div><div class="stat-label">Sin responder</div></div>
                </div>
                <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="reviewAnswers()">üìã Revisar</button>
                    <button class="btn btn-primary" onclick="restartExam()">üîÑ Reintentar</button>
                </div>
            </div>
        </div>

        <div id="reviewScreen" class="hidden">
            <div class="question-card" style="margin-bottom: 1rem;">
                <h2 style="margin-bottom: 0.5rem;">Revisi√≥n Detallada</h2>
                <p style="color: var(--text-secondary);">An√°lisis completo con explicaciones</p>
            </div>
            <div id="reviewContainer"></div>
            <div class="navigation">
                <button class="btn btn-primary" onclick="backToResults()">‚Üê Volver</button>
            </div>
        </div>
    </div>

    <script>
        const allQuestions = [
            // ===== ESCENARIOS COMPLEJOS MULTI-NORMA =====
            {id:1,category:"Escenario Multi-Norma",type:"scenario",difficulty:"extreme",
            scenario:"Un desarrollador detecta tr√°fico an√≥malo a las 2AM: <span class='highlight'>consultas masivas</span> a la BD de clientes desde una IP interna que no reconoce. El sistema procesa <span class='data'>datos clasificados como Secretos</span>. El desarrollador cree que puede ser un proceso batch leg√≠timo.",
            question:"¬øCu√°l es la acci√≥n CORRECTA seg√∫n m√∫ltiples normas aplicables?",
            options:["Investigar primero para no generar falsas alarmas al CSIRT","Reportar INMEDIATAMENTE al CSIRT/CERT sin asumir que es leg√≠timo","Consultar con el Tech Lead antes de reportar","Revisar los logs para confirmar si es un proceso batch"],
            correct:1,
            explanation:"<span class='trap-warning'>TRAMPA:</span> La tentaci√≥n es 'investigar primero'. Pero la Norma de Incidentes establece: <span class='key-point'>Reportar INMEDIATAMENTE cualquier comportamiento an√≥malo al CSIRT/CERT. NO asumir que es un error sin importancia</span>. Con datos Secretos, la urgencia es mayor."},

            {id:2,category:"Escenario Multi-Norma",type:"scenario",difficulty:"extreme",
            scenario:"Aplicaci√≥n nueva necesita conectarse a una <span class='highlight'>API externa de un proveedor</span> que ofrece servicios de verificaci√≥n de identidad. El proveedor tiene certificaci√≥n ISO 27001. El deadline es en 2 semanas.",
            question:"¬øQu√© proceso(s) DEBE(N) completarse antes de la integraci√≥n?",
            options:["Solo evaluaci√≥n t√©cnica porque tiene ISO 27001","Clasificaci√≥n del servicio + Homologaci√≥n (Due Diligence) completa, independientemente del deadline","Solo firma del contrato con cl√°usulas de seguridad","Evaluaci√≥n t√©cnica + contrato, la homologaci√≥n puede hacerse despu√©s"],
            correct:1,
            explanation:"La certificaci√≥n ISO 27001 del proveedor <span class='key-point'>NO exime del proceso de homologaci√≥n</span>. Se requiere: 1) Clasificaci√≥n por criticidad y datos, 2) <span class='key-point'>Homologaci√≥n completa (Due Diligence)</span>. No puedes trabajar con proveedor no homologado."},

            {id:3,category:"Escenario Multi-Norma",type:"scenario",difficulty:"extreme",
            scenario:"Durante un DR Test (prueba de recuperaci√≥n de desastre), tu aplicaci√≥n <span class='highlight'>falla al conectarse</span> a una BD en el sitio de respaldo. El <span class='data'>RTO definido es 4 horas</span> y ya van 3.5 horas intentando.",
            question:"Seg√∫n las normas de Continuidad, ¬øqu√© debe ocurrir?",
            options:["Continuar intentando hasta las 4 horas completas","Escalar inmediatamente, documentar el fallo, y actualizar el runbook con el problema identificado","Declarar el DR Test como fallido y reprogramar","Cambiar el RTO a 6 horas para esta aplicaci√≥n"],
            correct:1,
            explanation:"Con <span class='key-point'>30 minutos restantes del RTO</span>, debes escalar de inmediato. El MTTR se minimiza con <span class='key-point'>runbooks detallados y pruebas de DR</span>. Este fallo debe documentarse y el runbook actualizarse para prevenir futuras ocurrencias."},

            {id:4,category:"Escenario Multi-Norma",type:"scenario",difficulty:"extreme",
            scenario:"Auditor√≠a de la <span class='highlight'>2¬™ L√≠nea (RCS IT)</span> solicita evidencia del control <span class='data'>DyD-003</span> para tu aplicaci√≥n. Tienes el reporte de Chimera pero muestra <span class='highlight'>3 vulnerabilidades Altas</span> que fueron clasificadas como 'falsos positivos' por el equipo.",
            question:"¬øEsta evidencia ser√° aceptada?",
            options:["S√≠, si el equipo document√≥ t√©cnicamente por qu√© son falsos positivos","No, las vulnerabilidades Altas deben corregirse siempre","Depende de si el SO autoriz√≥ la clasificaci√≥n como falsos positivos","Solo si fueron descartas en la herramienta Sonar/Chimera"],
            correct:2,
            explanation:"Los 'falsos positivos' deben ser <span class='key-point'>autorizados por el SO</span>, no solo documentados por el equipo. Adem√°s, deben <span class='key-point'>configurarse/descartarse en la herramienta</span>, no solo justificarse verbalmente. Sin autorizaci√≥n del SO, la evidencia no es v√°lida."},

            {id:5,category:"Escenario Multi-Norma",type:"scenario",difficulty:"extreme",
            scenario:"Un componente cr√≠tico usa <span class='highlight'>Java 8</span>, que perdi√≥ soporte LTS. El equipo argumenta que la migraci√≥n a Java 17 requiere <span class='data'>3 meses de trabajo</span> y hay otras prioridades de negocio.",
            question:"¬øQu√© establece la Norma de Obsolescencia?",
            options:["Se puede mantener Java 8 si hay otras prioridades de negocio","Software sin soporte = puerta abierta a atacantes; debe priorizarse la migraci√≥n","Se puede usar con una excepci√≥n documentada indefinidamente","Solo es problema si hay vulnerabilidades conocidas activas"],
            correct:1,
            explanation:"La Norma establece: <span class='key-point'>Software sin soporte = puerta abierta a atacantes (sin parches de seguridad)</span>. SIEMPRE usar versiones LTS. Las 'prioridades de negocio' no justifican el riesgo de seguridad."},

            // ===== TRES L√çNEAS DE DEFENSA - TRAMPAS =====
            {id:6,category:"3 L√≠neas",type:"trap",difficulty:"extreme",
            question:"En el Modelo de las Tres L√≠neas, ¬øcu√°l es la funci√≥n ESPEC√çFICA de la 2¬™ L√≠nea (RCS IT)?",
            options:["Ejecutar controles y aplicar normativas directamente","Auditar todos los procesos de forma independiente","Establecer reglas, asesorar y verificar independientemente con challenge constructivo","Aprobar todos los cambios a producci√≥n"],
            correct:2,
            explanation:"<span class='trap-warning'>TRAMPA:</span> La 1¬™ L√≠nea ejecuta, la 3¬™ audita. La <span class='key-point'>2¬™ L√≠nea (RCS IT) establece reglas, asesora y verifica independientemente</span>. Su rol es de 'challenge constructivo', no de ejecuci√≥n ni auditor√≠a."},

            {id:7,category:"3 L√≠neas",type:"trap",difficulty:"extreme",
            question:"¬øQui√©n es el 'due√±o del riesgo' seg√∫n el Modelo de Tres L√≠neas?",
            options:["RCS IT porque establece las reglas","Auditor√≠a Interna porque tiene visi√≥n global","T√∫, tu equipo, Tech Leads y POs (1¬™ L√≠nea)","El CISO porque es responsable de seguridad"],
            correct:2,
            explanation:"La <span class='key-point'>1¬™ L√≠nea (t√∫, tu equipo, Tech Leads, POs) son los due√±os del riesgo</span>. Conocen y aplican normativas. RCS IT asesora, Auditor√≠a verifica, pero el ownership es de la 1¬™ L√≠nea."},

            {id:8,category:"3 L√≠neas",type:"trap",difficulty:"extreme",
            question:"El proceso TOE (Test of Effectiveness) de RCS IT implica:",
            options:["Verificar que el dise√±o del control es correcto","Seleccionar una muestra (ej. 15 CRQs) y solicitar EVIDENCIA real de ejecuci√≥n","Aprobar el dise√±o de nuevos controles","Capacitar a los equipos sobre los controles"],
            correct:1,
            explanation:"TOE ‚â† TOD. <span class='key-point'>TOD verifica dise√±o, TOE verifica ejecuci√≥n real</span>. En TOE, RCS IT selecciona muestra (ej. 15 CRQs) y <span class='key-point'>TE PIDEN EVIDENCIA</span>. Si falta = Deficiencia con plan de acci√≥n."},

            {id:9,category:"3 L√≠neas",type:"roles",difficulty:"extreme",
            question:"Si RCS IT encuentra que falta evidencia en un control durante el TOE, ¬øqu√© ocurre?",
            options:["Se registra como observaci√≥n menor","Se registra como Deficiencia (Gap) con plan de acci√≥n, responsable y fechas compromiso","Se escala a Auditor√≠a Interna autom√°ticamente","Se da un plazo de gracia para conseguir la evidencia"],
            correct:1,
            explanation:"Evidencia faltante/incorrecta = <span class='key-point'>Deficiencia (Gap)</span> que requiere plan de acci√≥n, responsable y fechas compromiso. RCS IT da seguimiento hasta el cierre. No hay 'observaciones menores'."},

            // ===== CIDA AVANZADO =====
            {id:10,category:"CIDA",type:"combined",difficulty:"extreme",
            question:"Si la dimensi√≥n de 'Disponibilidad' de tu aplicaci√≥n tiene impacto CR√çTICO, ¬øqu√© controles se derivan?",
            options:["Solo backups m√°s frecuentes","Cifrado E2E y MFA","Alto nivel de HA (redundancia) y estrategia de recuperaci√≥n robusta","Solo monitoreo mejorado"],
            correct:2,
            explanation:"Disponibilidad cr√≠tica implica: <span class='key-point'>Alto nivel de HA</span> (cl√∫ster activo-activo, sin SPOFs) y <span class='key-point'>estrategia de recuperaci√≥n robusta</span> (RTO/RPO agresivos). El cifrado es para Confidencialidad."},

            {id:11,category:"CIDA",type:"trap",difficulty:"extreme",
            question:"La dimensi√≥n 'Autenticidad' en CIDA determina:",
            options:["Nivel de cifrado requerido","Controles de hashing y firmas digitales","Controles de autenticaci√≥n y no repudio","Frecuencia de backups"],
            correct:2,
            explanation:"<span class='trap-warning'>TRAMPA:</span> Autenticidad ‚â† Integridad. <span class='key-point'>Autenticidad determina controles de autenticaci√≥n y no repudio</span> (¬øconfiamos en el origen?). Integridad usa hashing y firmas para detectar alteraciones."},

            {id:12,category:"CIDA",type:"numerical",difficulty:"extreme",
            question:"¬øCu√°ntas dimensiones tiene CIDA y cu√°les son?",
            options:["3: Confidencialidad, Integridad, Disponibilidad","4: Confidencialidad, Integridad, Disponibilidad, Autenticidad","5: CIDA m√°s Trazabilidad","4: Clasificaci√≥n, Integridad, Disponibilidad, Acceso"],
            correct:1,
            explanation:"CIDA tiene <span class='key-point'>4 dimensiones</span>: <span class='key-point'>C</span>onfidencialidad, <span class='key-point'>I</span>ntegridad, <span class='key-point'>D</span>isponibilidad, <span class='key-point'>A</span>utenticidad. No es la tr√≠ada CIA tradicional."},

            // ===== CLASIFICACI√ìN DE INFORMACI√ìN =====
            {id:13,category:"Clasificaci√≥n",type:"trap",difficulty:"extreme",
            question:"Para informaci√≥n clasificada como 'Confidencial', ¬øcu√°les son los controles m√≠nimos?",
            options:["Solo control de acceso b√°sico","Cifrado, RBAC estricto, logs de acceso","Cifrado E2E, MFA, tokenizaci√≥n, pseudonimizaci√≥n, auditor√≠a total","Protecci√≥n b√°sica de integridad"],
            correct:1,
            explanation:"<span class='trap-warning'>TRAMPA:</span> Confidencial ‚â† Secreta. <span class='key-point'>Confidencial requiere: Cifrado, RBAC estricto, logs de acceso</span>. Los controles m√°s extremos (MFA, tokenizaci√≥n, auditor√≠a total) son para <span class='key-point'>Secreta</span>."},

            {id:14,category:"Clasificaci√≥n",type:"trap",difficulty:"extreme",
            question:"¬øCu√°l es el nivel de clasificaci√≥n para 'datos de clientes, credenciales y claves criptogr√°ficas'?",
            options:["Confidencial","Secreta","Interna con controles adicionales","Depende del volumen de datos"],
            correct:1,
            explanation:"Datos de clientes, credenciales y claves criptogr√°ficas son <span class='key-point'>Secreta</span> (m√°xima protecci√≥n). Requieren: Cifrado E2E, MFA, tokenizaci√≥n, pseudonimizaci√≥n, auditor√≠a total."},

            // ===== CRIPTOGRAF√çA AVANZADA =====
            {id:15,category:"Criptograf√≠a",type:"numerical",difficulty:"extreme",
            question:"¬øCu√°les son los √öNICOS algoritmos de criptograf√≠a aprobados seg√∫n la Norma?",
            options:["RSA-2048 (cifrado) y MD5 (hash)","AES-128 (cifrado) y SHA-1 (hash)","AES-256 (cifrado) y SHA-256 (hash)","3DES (cifrado) y SHA-512 (hash)"],
            correct:2,
            explanation:"Algoritmos aprobados: <span class='key-point'>AES-256</span> (cifrado) y <span class='key-point'>SHA-256</span> (hash). MD5 y SHA-1 est√°n obsoletos. AES-128 no est√° aprobado. Las claves deben rotarse peri√≥dicamente."},

            {id:16,category:"Criptograf√≠a",type:"negative",difficulty:"extreme",
            question:"¬øCu√°l de las siguientes pr√°cticas est√° PERMITIDA seg√∫n la Norma de Criptograf√≠a?",
            options:["Almacenar claves en variables de entorno del c√≥digo","Crear implementaciones criptogr√°ficas personalizadas para casos especiales","Usar el sistema de gesti√≥n de claves centralizado del banco","Almacenar claves cifradas en archivos de configuraci√≥n"],
            correct:2,
            explanation:"Solo est√° permitido <span class='key-point'>usar el sistema de gesti√≥n de claves centralizado</span> y bibliotecas aprobadas. NUNCA: implementaciones personalizadas, claves en c√≥digo, claves en configuraci√≥n (aunque est√©n cifradas)."},

            // ===== M√âTRICAS DE CONTINUIDAD =====
            {id:17,category:"M√©tricas",type:"trap",difficulty:"extreme",
            question:"¬øQu√© m√©trica determina la FRECUENCIA de backups?",
            options:["RTO (Recovery Time Objective)","RPO (Recovery Point Objective)","MTTR (Mean Time To Recovery)","MTTD (Mean Time To Detect)"],
            correct:1,
            explanation:"<span class='trap-warning'>TRAMPA com√∫n:</span> RTO es TIEMPO de recuperaci√≥n. <span class='key-point'>RPO (cantidad m√°xima de p√©rdida de datos) determina frecuencia de backups</span>. Si RPO=1 hora, backups cada hora m√°ximo."},

            {id:18,category:"M√©tricas",type:"trap",difficulty:"extreme",
            question:"¬øQu√© m√©trica se reduce con runbooks detallados, pruebas de DR y automatizaci√≥n?",
            options:["RTO","RPO","MTTR","MTTD"],
            correct:2,
            explanation:"<span class='key-point'>MTTR (Mean Time To Recovery)</span> se minimiza con runbooks detallados, pruebas de DR y automatizaci√≥n. RTO es el objetivo, MTTR es el promedio real."},

            {id:19,category:"M√©tricas",type:"trap",difficulty:"extreme",
            question:"¬øQu√© m√©trica se reduce exponiendo endpoint /health y definiendo umbrales de alerta?",
            options:["RTO","RPO","MTTR","MTTD"],
            correct:3,
            explanation:"<span class='key-point'>MTTD (Mean Time To Detect)</span> se reduce con monitoreo proactivo: endpoint /health, m√©tricas de salud, umbrales de alerta. Es el tiempo en DETECTAR, no en recuperar."},

            {id:20,category:"M√©tricas",type:"combined",difficulty:"extreme",
            question:"Si una aplicaci√≥n tiene RTO=2h y RPO=30min, ¬øqu√© implica para el dise√±o?",
            options:["Backups cada 2 horas, recuperaci√≥n r√°pida","Backups cada 30 minutos m√°ximo, arquitectura que permita recuperar en 2 horas","Backups diarios con restauraci√≥n en 30 minutos","Solo depende del RTO, el RPO es secundario"],
            correct:1,
            explanation:"RPO=30min implica <span class='key-point'>backups m√°ximo cada 30 minutos</span>. RTO=2h implica arquitectura (HA, runbooks, DR) que permita <span class='key-point'>recuperar el servicio en m√°ximo 2 horas</span>. Ambos son independientes pero complementarios."},

            // ===== ALTA DISPONIBILIDAD =====
            {id:21,category:"Alta Disponibilidad",type:"combined",difficulty:"extreme",
            question:"¬øCu√°l es la combinaci√≥n CORRECTA de principios de Alta Disponibilidad?",
            options:["Solo redundancia y backups frecuentes","Redundancia, Health Checks (/health), Failover Autom√°tico, Eliminar SPOFs, Sesi√≥n externalizada","Solo cl√∫ster activo-pasivo y monitoreo","Redundancia y documentaci√≥n de procedimientos"],
            correct:1,
            explanation:"Principios completos de HA: <span class='key-point'>Redundancia</span> (activo-activo), <span class='key-point'>Health Checks</span> (/health), <span class='key-point'>Failover Autom√°tico</span>, <span class='key-point'>Sin SPOFs</span>, <span class='key-point'>Sesi√≥n externalizada</span>, aplicaciones STATELESS."},

            {id:22,category:"Alta Disponibilidad",type:"trap",difficulty:"extreme",
            question:"¬øPor qu√© las aplicaciones deben ser STATELESS para Alta Disponibilidad?",
            options:["Porque consumen menos memoria","Porque permite m√∫ltiples instancias redundantes sin conflicto de estado","Porque es m√°s f√°cil de programar","Porque los balanceadores lo requieren"],
            correct:1,
            explanation:"STATELESS permite <span class='key-point'>m√∫ltiples instancias (cl√∫ster activo-activo)</span> donde cualquier instancia puede atender cualquier request. La sesi√≥n se externaliza a un componente compartido."},

            {id:23,category:"Alta Disponibilidad",type:"trap",difficulty:"extreme",
            question:"¬øQu√© son las copias 'air-gapped' y cu√°l es su prop√≥sito principal?",
            options:["Copias en la nube separadas del data center","Copias f√≠sicamente desconectadas, √∫ltima l√≠nea de defensa contra ransomware","Copias incrementales autom√°ticas","Copias en tiempo real a sitio remoto"],
            correct:1,
            explanation:"Copias air-gapped est√°n <span class='key-point'>f√≠sicamente desconectadas</span> de la red. Son la <span class='key-point'>√∫ltima l√≠nea de defensa contra ransomware</span> porque el malware no puede cifrarlas."},

            // ===== CVT DETALLADO =====
            {id:24,category:"CVT",type:"numerical",difficulty:"extreme",
            question:"¬øCu√°ntos controles tiene el CVT?",
            options:["12 controles","14 controles","16 controles","18 controles"],
            correct:2,
            explanation:"El CVT tiene exactamente <span class='key-point'>16 controles</span>: DyD-001 a DyD-009, PRO-01 a PRO-03, SEG-01 a SEG-02, FRA-01, DMA-01."},

            {id:25,category:"CVT",type:"trap",difficulty:"extreme",
            question:"El control PRO-02 (Ready for Operation) se requiere para:",
            options:["Todos los cambios a producci√≥n","Solo aplicaciones nuevas o cambios de infraestructura relevantes","Solo sistemas DORA/SOX","Solo cuando hay cambios en la base de datos"],
            correct:1,
            explanation:"<span class='key-point'>PRO-02 (RFO)</span> NO es para todos los cambios. Solo para <span class='key-point'>aplicaciones nuevas o cambios de infraestructura relevantes</span>. Requiere Bolet√≠n RFO + ID RFO de Continuum."},

            {id:26,category:"CVT",type:"trap",difficulty:"extreme",
            question:"¬øQu√© control del CVT requiere el documento de autorizaci√≥n para usar datos reales en ambientes previos?",
            options:["DyD-001 (Definici√≥n Funcional y T√©cnica)","DyD-006 (Pruebas Funcionales Previas)","DyD-09 (Consentimiento Datos Reales)","PRO-03 (Gesti√≥n de Respaldos)"],
            correct:2,
            explanation:"<span class='key-point'>DyD-09</span> es el control de Consentimiento para Datos Reales. Requiere documento de autorizaci√≥n expl√≠cito para usar datos de producci√≥n en ambientes previos."},

            {id:27,category:"CVT",type:"scenario",difficulty:"extreme",
            scenario:"Aplicaci√≥n distribuida nueva (ASO-API). Completando el CVT, el control <span class='data'>DyD-004</span> est√° marcado como 'No Aplica' por el equipo.",
            question:"¬øEs correcto marcar DyD-004 como 'No Aplica'?",
            options:["S√≠, DyD-004 es opcional para nuevas aplicaciones","No, DyD-004 (Pruebas de Seguridad Aplicativa) es obligatorio para sistemas distribuidos","S√≠, si el control DyD-005 (Hacking √âtico) est√° completo","Depende de la clasificaci√≥n CIDA de la aplicaci√≥n"],
            correct:1,
            explanation:"<span class='key-point'>DyD-004 aplica espec√≠ficamente para sistemas distribuidos</span> (ASO-API, Web, Mobile). Para una ASO-API nueva, <span class='key-point'>NO puede marcarse como 'No Aplica'</span>. Es obligatorio."},

            {id:28,category:"CVT",type:"trap",difficulty:"extreme",
            question:"¬øQui√©n es responsable de verificar que el CVT est√© completo?",
            options:["El PO del proyecto","El SO del servicio","El Change Lead de la instalaci√≥n","El AO de la aplicaci√≥n"],
            correct:2,
            explanation:"El <span class='key-point'>Change Lead de la instalaci√≥n</span> es responsable de la completitud del CVT. Es su 'gate final' antes de producci√≥n. El CVT incompleto = despliegue DETENIDO."},

            {id:29,category:"CVT",type:"trap",difficulty:"extreme",
            question:"¬øD√≥nde se almacena el Expediente T√©cnico B√°sico con todas las evidencias?",
            options:["En Confluence del equipo","En el repositorio del proyecto","En el Centro √önico de Conocimiento (CUC)","En ServiceNow junto al CRQ"],
            correct:2,
            explanation:"El Expediente T√©cnico B√°sico se almacena en el <span class='key-point'>Centro √önico de Conocimiento (CUC)</span>, no en herramientas de equipo ni repositorios de c√≥digo."},

            // ===== SDLC Y SEGURIDAD =====
            {id:30,category:"SDLC",type:"combined",difficulty:"extreme",
            question:"¬øQu√© controles de seguridad se integran en la fase de DISE√ëO del SDLC?",
            options:["SAST y SCA","Modelado de Amenazas (Threat Modeling) y Security by Design","CVT y CRQ","DAST y Hacking √âtico"],
            correct:1,
            explanation:"Fase de Dise√±o: <span class='key-point'>Modelado de Amenazas (Threat Modeling)</span> y <span class='key-point'>Security by Design</span>. SAST/SCA son de Construcci√≥n. DAST/Hacking √âtico de Pruebas."},

            {id:31,category:"SDLC",type:"combined",difficulty:"extreme",
            question:"¬øQu√© controles se integran en la fase de CONSTRUCCI√ìN?",
            options:["ART (An√°lisis de Riesgo Tecnol√≥gico)","CVT completo","SAST, SCA, Codificaci√≥n Segura (OWASP Top 10)","DAST y pruebas de penetraci√≥n"],
            correct:2,
            explanation:"Fase de Construcci√≥n: <span class='key-point'>SAST</span> (an√°lisis est√°tico), <span class='key-point'>SCA</span> (an√°lisis de componentes), <span class='key-point'>Codificaci√≥n Segura OWASP Top 10</span>."},

            {id:32,category:"SDLC",type:"trap",difficulty:"extreme",
            question:"El principio 'Shift Left' implica:",
            options:["Priorizar las pruebas de la izquierda del pipeline","Mover actividades de calidad y seguridad a fases TEMPRANAS del ciclo","Que el equipo de izquierda (desarrollo) haga las pruebas","Reducir pruebas en fases tard√≠as"],
            correct:1,
            explanation:"<span class='key-point'>Shift Left</span>: mover seguridad y calidad a fases <span class='key-point'>m√°s tempranas</span> donde los defectos son m√°s baratos de corregir. No es sobre 'izquierda del pipeline'."},

            // ===== OWASP Y CODIFICACI√ìN SEGURA =====
            {id:33,category:"OWASP",type:"trap",difficulty:"extreme",
            question:"¬øQu√© pr√°ctica previene TANTO Inyecci√≥n SQL COMO XSS?",
            options:["Usar HTTPS en todas las conexiones","Validaci√≥n estricta de TODAS las entradas del usuario","Cifrar los datos en la base de datos","Usar frameworks modernos autom√°ticamente"],
            correct:1,
            explanation:"<span class='key-point'>Validaci√≥n estricta de TODAS las entradas del usuario</span> previene tanto SQL Injection como XSS. HTTPS protege en tr√°nsito, no contra inyecci√≥n."},

            {id:34,category:"OWASP",type:"trap",difficulty:"extreme",
            question:"En el manejo seguro de errores, ¬øqu√© est√° PROHIBIDO?",
            options:["Registrar errores en logs","Mostrar mensajes de error gen√©ricos al usuario","Revelar informaci√≥n sensible (stack traces, rutas, versiones) en mensajes de error","Usar c√≥digos de error num√©ricos"],
            correct:2,
            explanation:"<span class='key-point'>PROHIBIDO revelar informaci√≥n sensible</span> en errores: stack traces, rutas de archivos, versiones de software, queries SQL. Los atacantes usan esta informaci√≥n."},

            // ===== MONITORIZACI√ìN Y LOGS =====
            {id:35,category:"Logs",type:"combined",difficulty:"extreme",
            question:"Un log de alta calidad debe incluir:",
            options:["Solo errores cr√≠ticos para reducir volumen","Qui√©n, qu√©, cu√°ndo, c√≥mo - con suficiente detalle para investigaci√≥n","Toda la informaci√≥n disponible incluyendo datos sensibles","Solo m√©tricas de rendimiento"],
            correct:1,
            explanation:"Logs de calidad: <span class='key-point'>qui√©n, qu√©, cu√°ndo, c√≥mo</span>. Eventos clave: logins (exitosos/fallidos), cambios de configuraci√≥n, accesos a ficheros, errores cr√≠ticos. <span class='key-point'>NUNCA datos sensibles</span>."},

            {id:36,category:"Logs",type:"negative",difficulty:"extreme",
            question:"¬øCu√°l de los siguientes datos NUNCA debe incluirse en logs?",
            options:["Timestamps de eventos","IPs de origen de conexiones","Contrase√±as, tokens, datos personales de clientes","Identificadores de sesi√≥n (ofuscados)"],
            correct:2,
            explanation:"<span class='key-point'>NUNCA en logs</span>: contrase√±as, tokens de autenticaci√≥n, datos personales de clientes, n√∫meros de tarjeta, etc. Los IPs y timestamps S√ç deben registrarse."},

            {id:37,category:"Logs",type:"trap",difficulty:"extreme",
            question:"¬øA d√≥nde deben enviarse los logs de seguridad?",
            options:["A archivos locales del servidor","Al SIEM corporativo usando formato est√°ndar","A la base de datos de la aplicaci√≥n","A un bucket de almacenamiento en la nube"],
            correct:1,
            explanation:"Los logs deben enviarse al <span class='key-point'>SIEM corporativo usando formato est√°ndar</span>. No a archivos locales (no centralizados) ni a la BD de la app (mezclado con datos de negocio)."},

            // ===== GESTI√ìN DE VULNERABILIDADES =====
            {id:38,category:"Vulnerabilidades",type:"combined",difficulty:"extreme",
            question:"Para una vulnerabilidad de criticidad CR√çTICA, ¬øcu√°l es la acci√≥n requerida?",
            options:["Incluir en el backlog del pr√≥ximo sprint","M√ÅXIMA PRIORIDAD: Correcci√≥n inmediata por encima de nuevas funcionalidades","Planificar parche dentro del SLA de 30 d√≠as","Evaluar si realmente es cr√≠tica"],
            correct:1,
            explanation:"Vulnerabilidades CR√çTICAS: <span class='key-point'>M√ÅXIMA PRIORIDAD. Correcci√≥n inmediata por encima de nuevas funcionalidades</span>. No hay SLA, es AHORA."},

            {id:39,category:"Vulnerabilidades",type:"trap",difficulty:"extreme",
            question:"¬øQu√© herramientas componen el an√°lisis de vulnerabilidades en el pipeline CI/CD?",
            options:["Solo SonarQube","SAST, DAST, SCA y Chimera para reportes consolidados","Solo an√°lisis manual de c√≥digo","SAST y pruebas unitarias"],
            correct:1,
            explanation:"Pipeline de seguridad: <span class='key-point'>SAST</span> (est√°tico), <span class='key-point'>DAST</span> (din√°mico), <span class='key-point'>SCA</span> (componentes), <span class='key-point'>Chimera</span> (reportes consolidados)."},

            // ===== INCIDENTES DE SEGURIDAD =====
            {id:40,category:"Incidentes",type:"scenario",difficulty:"extreme",
            scenario:"Recibes notificaci√≥n de que una <span class='highlight'>cuenta de servicio</span> de tu aplicaci√≥n est√° siendo usada para acceder a recursos que normalmente no accede. El acceso es t√©cnicamente leg√≠timo (la cuenta tiene permisos).",
            question:"¬øCu√°l es la acci√≥n correcta?",
            options:["Monitorear por 24 horas antes de actuar","Reportar inmediatamente al CSIRT aunque el acceso sea t√©cnicamente v√°lido","No hacer nada porque la cuenta tiene los permisos necesarios","Revocar los permisos de la cuenta preventivamente"],
            correct:1,
            explanation:"Comportamiento an√≥malo debe reportarse <span class='key-point'>INMEDIATAMENTE al CSIRT</span> aunque sea 't√©cnicamente v√°lido'. El m√≠nimo privilegio y acceso inusual son se√±ales de posible compromiso."},

            {id:41,category:"Incidentes",type:"combined",difficulty:"extreme",
            question:"En la fase de 'Lecciones Aprendidas' post-incidente, ¬øqu√© mejoras se implementan t√≠picamente?",
            options:["Solo documentar el incidente","Timeouts, reintentos, circuit breakers y actualizaciones a runbooks","Cambiar contrase√±as de todas las cuentas","Solo revisar los logs"],
            correct:1,
            explanation:"Lecciones Aprendidas: implementar mejoras como <span class='key-point'>timeouts, reintentos, circuit breakers</span>. Actualizar runbooks con lo aprendido. Es mejora continua, no solo documentaci√≥n."},

            // ===== REDES Y HARDENING =====
            {id:42,category:"Redes",type:"trap",difficulty:"extreme",
            question:"El principio de 'Segmentaci√≥n de Red' implica que como desarrollador debes:",
            options:["Asumir acceso libre entre todos los componentes","NO asumir acceso libre; declarar flujos necesarios y solicitar aperturas de firewall justificadas","Configurar tus propias reglas de firewall","Solo preocuparte por la red de desarrollo"],
            correct:1,
            explanation:"Segmentaci√≥n: <span class='key-point'>NO asumir acceso libre</span>. Debes <span class='key-point'>declarar flujos de comunicaci√≥n necesarios</span> y solicitar aperturas de firewall justificadas. El acceso debe ser expl√≠cito."},

            {id:43,category:"Redes",type:"trap",difficulty:"extreme",
            question:"'Hardening' significa:",
            options:["Aumentar los recursos del servidor","Configuraciones de seguridad estandarizadas con solo servicios estrictamente necesarios","Usar servidores m√°s potentes","Aumentar el nivel de logging"],
            correct:1,
            explanation:"Hardening: <span class='key-point'>Configuraciones de seguridad estandarizadas</span>, <span class='key-point'>solo servicios estrictamente necesarios</span>. Tu responsabilidad: desarrollar para entornos minimalistas, usar Golden Images corporativas."},

            // ===== GESTI√ìN DE TERCEROS =====
            {id:44,category:"Terceros",type:"trap",difficulty:"extreme",
            question:"¬øPuedes integrar con un proveedor que est√° en proceso de homologaci√≥n pero a√∫n no complet√≥?",
            options:["S√≠, si hay urgencia de negocio","S√≠, con aprobaci√≥n del PO","NO, no puedes trabajar con proveedor no homologado","S√≠, en ambiente de desarrollo mientras se completa"],
            correct:2,
            explanation:"<span class='key-point'>NO puedes trabajar con proveedor no homologado</span>, independientemente de urgencias o aprobaciones internas. Debes planificar tiempos para el proceso de Due Diligence."},

            {id:45,category:"Terceros",type:"scenario",difficulty:"extreme",
            scenario:"Un proveedor cloud cr√≠tico para tu aplicaci√≥n notifica un <span class='highlight'>incidente de seguridad</span> que podr√≠a haber expuesto datos. No hay confirmaci√≥n de que tus datos fueron afectados.",
            question:"¬øCu√°l es tu responsabilidad?",
            options:["Esperar confirmaci√≥n del proveedor antes de actuar","Evaluar impacto en tus apps y activar contingencia si es necesario (deshabilitar integraci√≥n)","Solo documentar la notificaci√≥n","Notificar a tu PO y esperar instrucciones"],
            correct:1,
            explanation:"Ante incidente de tercero: <span class='key-point'>Evaluar impacto en tus apps</span> de inmediato. <span class='key-point'>Activar contingencia si es necesario</span> (incluye deshabilitar integraci√≥n). No esperar confirmaci√≥n."},

            // ===== 20 REGLAS DE ORO =====
            {id:46,category:"Reglas de Oro",type:"trap",difficulty:"extreme",
            question:"La Regla de Oro #1 establece que la seguridad es:",
            options:["Responsabilidad del equipo de InfoSec","Responsabilidad del equipo de QA","TU responsabilidad como desarrollador, no de un equipo aparte","Responsabilidad compartida entre todos por igual"],
            correct:2,
            explanation:"Regla #1: <span class='key-point'>La seguridad es TU responsabilidad</span>, no de un equipo aparte. Como desarrollador profesional, la seguridad es parte integral de tu trabajo."},

            {id:47,category:"Reglas de Oro",type:"trap",difficulty:"extreme",
            question:"La Regla de Oro sobre RBAC establece:",
            options:["Permitir acceso amplio y restringir seg√∫n necesidad","Dise√±ar RBAC granular, denegar por defecto, solo permisos m√≠nimos indispensables","Copiar perfiles de acceso de usuarios similares","Dar acceso temporal amplio y reducir despu√©s"],
            correct:1,
            explanation:"Regla sobre RBAC: <span class='key-point'>Dise√±ar granular, denegar por defecto, solo permisos m√≠nimos indispensables</span>. Nunca 'permitir amplio y restringir'."},

            {id:48,category:"Reglas de Oro",type:"trap",difficulty:"extreme",
            question:"La Regla de Oro sobre claves y secretos establece:",
            options:["Cifrar las claves antes de ponerlas en el c√≥digo","NUNCA almacenar claves, contrase√±as o secretos en el c√≥digo","Usar variables de entorno en lugar de hardcoded","Rotar las claves frecuentemente si est√°n en c√≥digo"],
            correct:1,
            explanation:"Regla: <span class='key-point'>NUNCA almacenar claves, contrase√±as o secretos en el c√≥digo</span>. Ni cifradas, ni en variables de entorno del c√≥digo, ni en configuraci√≥n. Usar gesti√≥n de claves centralizada."},

            {id:49,category:"Reglas de Oro",type:"numerical",difficulty:"extreme",
            question:"¬øCu√°ntas Reglas de Oro del Desarrollador se definen en la Norma?",
            options:["10 reglas","15 reglas","20 reglas","25 reglas"],
            correct:2,
            explanation:"Se definen exactamente <span class='key-point'>20 Reglas de Oro</span> del Desarrollador en BBVA. Cubren desde seguridad hasta operaci√≥n, CVT y formaci√≥n."},

            // ===== PREGUNTAS NEGATIVAS =====
            {id:50,category:"Negativas",type:"negative",difficulty:"extreme",
            question:"¬øCu√°l de los siguientes NO es uno de los 4 niveles de clasificaci√≥n de informaci√≥n?",
            options:["P√∫blica","Interna","Restringida","Secreta"],
            correct:2,
            explanation:"Los 4 niveles son: <span class='key-point'>P√∫blica, Interna, Confidencial, Secreta</span>. '<span class='trap-warning'>Restringida</span>' NO existe como nivel de clasificaci√≥n en la Norma."},

            {id:51,category:"Negativas",type:"negative",difficulty:"extreme",
            question:"¬øCu√°l de las siguientes NO es una direcci√≥n responsable de normas en Engineering?",
            options:["Strategy & Control","RCS Third Party","Quality Assurance","Physical Security"],
            correct:2,
            explanation:"Las direcciones son: Strategy & Control, RCS Engineering, RCS Third Party, Information Security, Infrastructure & IT Ops, Physical Security, Systems. '<span class='trap-warning'>Quality Assurance</span>' NO es una direcci√≥n normativa."},

            {id:52,category:"Negativas",type:"negative",difficulty:"extreme",
            question:"¬øCu√°l de los siguientes NO es un estado de protecci√≥n de datos?",
            options:["En Tr√°nsito","En Reposo","En Proceso","En Uso"],
            correct:2,
            explanation:"Los 3 estados son: <span class='key-point'>En Tr√°nsito, En Reposo, En Uso</span>. '<span class='trap-warning'>En Proceso</span>' no existe; 'En Uso' es cuando los datos est√°n siendo procesados activamente."},

            // ===== REGULADORES =====
            {id:53,category:"Reguladores",type:"trap",difficulty:"extreme",
            question:"¬øQu√© entidad emite la Circular √önica de Bancos (CUB)?",
            options:["Banxico","CNBV","Secretar√≠a Anticorrupci√≥n","CONDUSEF"],
            correct:1,
            explanation:"La <span class='key-point'>CNBV (Comisi√≥n Nacional Bancaria y de Valores)</span> emite la CUB. Banxico regula sistemas de pago y ciberseguridad del sistema financiero."},

            {id:54,category:"Reguladores",type:"trap",difficulty:"extreme",
            question:"¬øQu√© ley vigila la Secretar√≠a Anticorrupci√≥n (antes INAI)?",
            options:["Ley de Instituciones de Cr√©dito","Ley de Protecci√≥n al Ahorro Bancario","LFPDPPP (Ley Federal de Protecci√≥n de Datos Personales)","Ley General de Transparencia"],
            correct:2,
            explanation:"La Secretar√≠a Anticorrupci√≥n vigila la <span class='key-point'>LFPDPPP (Ley Federal de Protecci√≥n de Datos Personales en Posesi√≥n de Particulares)</span>."},

            // ===== MODELO DE GOBIERNO =====
            {id:55,category:"Gobierno",type:"trap",difficulty:"extreme",
            question:"El 'Modelo de Gobierno de Engineering' es:",
            options:["El organigrama del √°rea de Engineering","La 'constituci√≥n' de Engineering: norma fundacional de la que emanan todas las normativas espec√≠ficas","El proceso de aprobaci√≥n de cambios","La metodolog√≠a de desarrollo"],
            correct:1,
            explanation:"El Modelo de Gobierno es la <span class='key-point'>'constituci√≥n' de Engineering</span>. Establece qui√©n toma decisiones, c√≥mo se estructuran equipos, y el origen del cuerpo normativo. De √©l emanan todas las dem√°s normas."},

            {id:56,category:"Gobierno",type:"trap",difficulty:"extreme",
            question:"¬øQu√© direcci√≥n es responsable del Modelo de Gobierno de Engineering?",
            options:["Systems","RCS Engineering","Strategy & Control","Information Security"],
            correct:2,
            explanation:"<span class='key-point'>Strategy & Control</span> es responsable del Modelo de Gobierno. Define estructura, roles, decisiones y origen del cuerpo normativo."},

            // ===== OPERACI√ìN TI =====
            {id:57,category:"Operaci√≥n",type:"combined",difficulty:"extreme",
            question:"Un Runbook debe incluir:",
            options:["Solo el procedimiento de arranque","Arranque, parada, alertas comunes, diagn√≥stico b√°sico","Solo contactos del equipo","Solo la arquitectura del sistema"],
            correct:1,
            explanation:"Runbook completo: <span class='key-point'>arranque, parada, alertas comunes, diagn√≥stico b√°sico</span>. Debe mantenerse actualizado. Reduce MTTR."},

            {id:58,category:"Operaci√≥n",type:"trap",difficulty:"extreme",
            question:"¬øQu√© significa que tu aplicaci√≥n debe ser 'automatizable' para Operaci√≥n TI?",
            options:["Que use CI/CD","Que tenga APIs para tareas admin, est√°ndares de configuraci√≥n, despliegues automatizados","Que no requiera intervenci√≥n humana nunca","Que use contenedores"],
            correct:1,
            explanation:"Aplicaci√≥n automatizable: <span class='key-point'>APIs para tareas admin</span>, est√°ndares de configuraci√≥n, despliegues automatizados. Permite operaci√≥n eficiente sin intervenci√≥n manual constante."},

            // ===== CMDB =====
            {id:59,category:"CMDB",type:"combined",difficulty:"extreme",
            question:"Al registrar tu aplicaci√≥n en CMDB, ¬øqu√© DEBES mapear?",
            options:["Solo el nombre y responsable","Solo las APIs que expone","La aplicaci√≥n, sus componentes y todas sus dependencias (BDs, APIs que consume, servicios de terceros)","Solo los servidores donde corre"],
            correct:2,
            explanation:"CMDB debe incluir: <span class='key-point'>aplicaci√≥n, componentes, TODAS las dependencias</span> (BDs, APIs que consume, servicios de terceros). Es necesario para an√°lisis de impacto."},

            {id:60,category:"CMDB",type:"trap",difficulty:"extreme",
            question:"¬øPara qu√© se usa la CMDB antes de hacer cambios?",
            options:["Para ver qui√©n es el due√±o del sistema","Para an√°lisis de impacto e identificar sistemas afectados","Para obtener aprobaci√≥n del cambio","Para programar el mantenimiento"],
            correct:1,
            explanation:"Antes de cambios: consultar CMDB para <span class='key-point'>an√°lisis de impacto</span> e <span class='key-point'>identificar sistemas afectados</span>. Las dependencias mapeadas son cr√≠ticas para esto."},

            // ===== SEGURIDAD F√çSICA =====
            {id:61,category:"Seg. F√≠sica",type:"combined",difficulty:"extreme",
            question:"¬øCu√°les son tus responsabilidades de seguridad f√≠sica seg√∫n la Norma?",
            options:["Solo portar identificaci√≥n","Portar ID visible, escritorio limpio, bloquear pantalla SIEMPRE, proteger tu port√°til","Solo no dejar documentos en la impresora","Solo no compartir tu contrase√±a"],
            correct:1,
            explanation:"Responsabilidades f√≠sicas: <span class='key-point'>ID visible, escritorio limpio, bloquear pantalla SIEMPRE al ausentarte, proteger port√°til</span> (su robo es incidente grave)."},

            {id:62,category:"Seg. F√≠sica",type:"trap",difficulty:"extreme",
            question:"Tu port√°til corporativo es robado. ¬øQu√© nivel de gravedad tiene este evento?",
            options:["Incidente menor si no ten√≠a datos sensibles","Potencialmente un incidente grave que debe reportarse inmediatamente","Solo es grave si ten√≠a c√≥digo fuente","Depende de si estaba cifrado"],
            correct:1,
            explanation:"El robo de port√°til <span class='key-point'>puede ser un incidente grave</span>. Eres directamente responsable. Debe reportarse inmediatamente independientemente del contenido."},

            // ===== IMPACTOS DEL INCUMPLIMIENTO =====
            {id:63,category:"Impactos",type:"combined",difficulty:"extreme",
            question:"¬øCu√°les son los impactos REGULATORIOS del incumplimiento normativo?",
            options:["Solo errores de c√≥digo","Solo retrabajos","Sanciones regulatorias, p√©rdida de confianza del cliente, p√©rdidas patrimoniales, riesgo reputacional","Solo improductividad"],
            correct:2,
            explanation:"Impactos regulatorios: <span class='key-point'>Sanciones regulatorias, p√©rdida de confianza del cliente, p√©rdidas patrimoniales, riesgo reputacional</span>. Van m√°s all√° de problemas t√©cnicos."},

            {id:64,category:"Impactos",type:"combined",difficulty:"extreme",
            question:"¬øCu√°les son los impactos T√âCNICOS del incumplimiento normativo?",
            options:["Sanciones econ√≥micas","Errores de dise√±o/implementaci√≥n, deficiente calidad del software, vulnerabilidades de seguridad, retrabajos","Solo problemas de rendimiento","Solo incompatibilidad de versiones"],
            correct:1,
            explanation:"Impactos t√©cnicos: <span class='key-point'>Errores de dise√±o/implementaci√≥n, deficiente calidad, vulnerabilidades, retrabajos</span>. El cumplimiento previene estos problemas."},

            // ===== ESCENARIOS FINALES COMPLEJOS =====
            {id:65,category:"Escenario Final",type:"scenario",difficulty:"extreme",
            scenario:"Sistema financiero con clasificaci√≥n CIDA: <span class='data'>Confidencialidad=Alta</span>, <span class='data'>Disponibilidad=Cr√≠tica</span>. Usa componentes de un proveedor externo. Pr√≥ximo a despliegue.",
            question:"¬øQu√© combinaci√≥n de controles es OBLIGATORIA?",
            options:["Solo pruebas funcionales y aprobaci√≥n del PO","Cifrado de datos + HA + pruebas de terceros (SCA/SAST/integridad) + CVT completo","Solo certificaci√≥n ISO del proveedor","Solo pruebas de rendimiento por la criticidad"],
            correct:1,
            explanation:"Confidencialidad Alta = <span class='key-point'>cifrado</span>. Disponibilidad Cr√≠tica = <span class='key-point'>HA</span>. Terceros = <span class='key-point'>SCA+SAST+integridad</span>. Despliegue = <span class='key-point'>CVT completo</span>. Todo es obligatorio."},

            {id:66,category:"Escenario Final",type:"scenario",difficulty:"extreme",
            scenario:"Auditor√≠a de <span class='highlight'>3¬™ L√≠nea</span> revisa tu aplicaci√≥n. Solicitan evidencia de <span class='data'>15 CRQs</span> del √∫ltimo a√±o. Tu sistema no es DORA/SOX. El √∫ltimo CRQ fue hace <span class='data'>4 meses</span>.",
            question:"¬øTendr√°s evidencias de los 15 CRQs?",
            options:["S√≠, todas las evidencias por 12 meses","No necesariamente, solo 3 meses o 10 ejecuciones para sistemas no DORA/SOX","S√≠, si fueron almacenadas en el CUC","Depende del tama√±o de las evidencias"],
            correct:1,
            explanation:"Sistemas no DORA/SOX: retenci√≥n de <span class='key-point'>3 meses o 10 ejecuciones, lo que ocurra primero</span>. Con 4 meses y 15 CRQs, probablemente <span class='key-point'>no tendr√°s todas las evidencias</span>."},

            {id:67,category:"Escenario Final",type:"scenario",difficulty:"extreme",
            scenario:"Durante Chaos Engineering, tu aplicaci√≥n <span class='highlight'>fall√≥ al perder conexi√≥n</span> con una API de terceros. No ten√≠a timeout configurado y se qued√≥ esperando indefinidamente.",
            question:"¬øQu√© mejoras debes implementar seg√∫n las Lecciones Aprendidas?",
            options:["Solo documentar el fallo","Timeouts, reintentos con backoff, circuit breakers","Solo aumentar el timeout","Solo monitorear m√°s de cerca"],
            correct:1,
            explanation:"Mejoras de resiliencia: <span class='key-point'>Timeouts</span> (no esperar indefinidamente), <span class='key-point'>reintentos con backoff</span>, <span class='key-point'>circuit breakers</span> (cortar llamadas a servicios que fallan)."},

            {id:68,category:"Escenario Final",type:"scenario",difficulty:"extreme",
            scenario:"Eres requerido en un 'war room' por un incidente de seguridad. El CSIRT solicita an√°lisis t√©cnico, buscar causa ra√≠z, y colaborar en soluci√≥n de emergencia.",
            question:"¬øEn qu√© fase del proceso de incidentes est√°s participando?",
            options:["Detecci√≥n","Respuesta","Contenci√≥n","Lecciones Aprendidas"],
            correct:1,
            explanation:"El 'war room' es fase de <span class='key-point'>Respuesta</span>. Detecci√≥n es reportar. Contenci√≥n es aislar. La fase de Respuesta incluye an√°lisis, causa ra√≠z y soluci√≥n de emergencia."},

            // ===== PREGUNTAS DE INTEGRACI√ìN FINAL =====
            {id:69,category:"Integraci√≥n",type:"combined",difficulty:"extreme",
            question:"Para una aplicaci√≥n STATELESS con HA, ¬øcu√°l es la arquitectura correcta?",
            options:["Un servidor con backups frecuentes","Cl√∫ster activo-pasivo con failover manual","Cl√∫ster activo-activo con sesi√≥n externalizada, health checks, sin SPOFs","M√∫ltiples servidores sin balanceador"],
            correct:2,
            explanation:"Arquitectura HA correcta: <span class='key-point'>activo-activo</span> (no pasivo), <span class='key-point'>sesi√≥n externalizada</span>, <span class='key-point'>health checks</span>, <span class='key-point'>sin SPOFs</span>. El balanceador usa /health para failover autom√°tico."},

            {id:70,category:"Integraci√≥n",type:"combined",difficulty:"extreme",
            question:"El principio de 'M√≠nimo Privilegio' combinado con 'Segregaci√≥n de Funciones' implica:",
            options:["Dar menos permisos y separar equipos","RBAC granular + denegar por defecto + doble aprobaci√≥n para operaciones sensibles","Solo usar MFA para todos","Revisar permisos mensualmente"],
            correct:1,
            explanation:"Combinaci√≥n: <span class='key-point'>RBAC granular + denegar por defecto</span> (m√≠nimo privilegio) + <span class='key-point'>doble aprobaci√≥n / cuatro ojos</span> para operaciones sensibles (segregaci√≥n). Quien crea ‚â† quien autoriza."},

            {id:71,category:"Integraci√≥n",type:"combined",difficulty:"extreme",
            question:"¬øCu√°l es la relaci√≥n entre el CVT y el CRQ?",
            options:["Son documentos independientes","El CVT debe completarse ANTES de aprobar el CRQ para producci√≥n","El CRQ incluye el CVT","El CVT reemplaza al CRQ"],
            correct:1,
            explanation:"El <span class='key-point'>CVT es prerequisito del CRQ</span>. CVT completo ‚Üí CRQ puede aprobarse. CVT incompleto = despliegue DETENIDO = CRQ no puede ejecutarse."},

            {id:72,category:"Integraci√≥n",type:"trap",difficulty:"extreme",
            question:"¬øQu√© tienen en com√∫n las normas de Information Security, Testing y SDLC?",
            options:["Todas son opcionales","Todas aplican solo a sistemas DORA/SOX","Todas tienen controles que deben evidenciarse y pueden ser auditados por las 3 l√≠neas","Todas son responsabilidad de un solo equipo"],
            correct:2,
            explanation:"Todas las normas <span class='key-point'>tienen controles que deben evidenciarse</span>. La 1¬™ L√≠nea ejecuta y documenta, la 2¬™ verifica, la 3¬™ audita. El cumplimiento no es opcional."},

            {id:73,category:"Integraci√≥n",type:"trap",difficulty:"extreme",
            question:"El cumplimiento normativo NO es:",
            options:["Responsabilidad de todos los desarrolladores","Base de la calidad, seguridad y resiliencia","Burocracia innecesaria que ralentiza el desarrollo","Protecci√≥n para el banco y los clientes"],
            correct:2,
            explanation:"<span class='key-point'>El cumplimiento normativo NO es burocracia</span>. Es la base de la calidad, seguridad y resiliencia de los sistemas que operan el dinero de los clientes."},

            {id:74,category:"Integraci√≥n",type:"combined",difficulty:"extreme",
            question:"¬øCu√°ntas direcciones tienen normas espec√≠ficas bajo el Modelo de Gobierno de Engineering?",
            options:["5 direcciones","6 direcciones","7 direcciones","8 direcciones"],
            correct:2,
            explanation:"<span class='key-point'>7 direcciones</span>: Strategy & Control, RCS Engineering, RCS Third Party, Information Security, Infrastructure & IT Ops, Physical Security, Systems."},

            {id:75,category:"Final",type:"combined",difficulty:"extreme",
            question:"¬øCu√°l es el prop√≥sito √öLTIMO de todo el marco normativo de Engineering seg√∫n el documento?",
            options:["Cumplir con reguladores externos","Evitar sanciones y auditor√≠as","Fortalecer la capacidad de resistir, responder y recuperarse ante incidentes tecnol√≥gicos (Resiliencia Digital)","Documentar todos los procesos"],
            correct:2,
            explanation:"El prop√≥sito √∫ltimo es la <span class='key-point'>Resiliencia Digital</span>: fortalecer la capacidad de <span class='key-point'>resistir, responder y recuperarse</span> ante ciberataques, fallos de software y cualquier incidente tecnol√≥gico. Que el banco siga funcionando."}
        ];

        let questions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let answerResults = {};
        let correctCount = 0;
        let incorrectCount = 0;
        let shuffledOptions = {};

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function shuffleOptionsForQuestion(question, qIndex) {
            const indices = question.options.map((_, i) => i);
            const shuffledIndices = shuffleArray(indices);
            const newCorrectIndex = shuffledIndices.indexOf(question.correct);
            shuffledOptions[qIndex] = { indices: shuffledIndices, correctIndex: newCorrectIndex };
        }

        function startExam() {
            let limit = parseInt(document.getElementById('questionLimit').value) || 75;
            limit = Math.max(10, Math.min(75, limit));
            questions = shuffleArray([...allQuestions]).slice(0, limit);
            shuffledOptions = {};
            questions.forEach((q, i) => shuffleOptionsForQuestion(q, i));
            currentQuestionIndex = 0;
            userAnswers = {};
            answerResults = {};
            correctCount = 0;
            incorrectCount = 0;
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('examScreen').classList.remove('hidden');
            document.getElementById('totalQuestions').textContent = questions.length;
            renderQuestionNav();
            renderQuestion();
            updateStats();
        }

        function renderQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            questions.forEach((_, index) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                if (index === currentQuestionIndex) btn.classList.add('current');
                if (answerResults[index] === true) btn.classList.add('correct');
                if (answerResults[index] === false) btn.classList.add('incorrect');
                btn.textContent = index + 1;
                btn.onclick = () => goToQuestion(index);
                nav.appendChild(btn);
            });
        }

        function goToQuestion(index) { currentQuestionIndex = index; renderQuestion(); renderQuestionNav(); }

        function updateStats() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('incorrectCount').textContent = incorrectCount;
            const progress = (Object.keys(userAnswers).length / questions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        function renderQuestion() {
            const question = questions[currentQuestionIndex];
            const shuffled = shuffledOptions[currentQuestionIndex];
            const isAnswered = userAnswers[currentQuestionIndex] !== undefined;
            const userAnswer = userAnswers[currentQuestionIndex];
            const isCorrect = answerResults[currentQuestionIndex];
            
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionNumber').textContent = `Pregunta ${currentQuestionIndex + 1}`;
            document.getElementById('questionCategory').textContent = question.category;
            
            const typeLabel = document.getElementById('questionType');
            const typeMap = {scenario:'Escenario',trap:'Trampa',numerical:'Num√©rica',combined:'Combinada',negative:'Negativa',roles:'Roles'};
            typeLabel.textContent = typeMap[question.type] || question.type;
            typeLabel.className = `question-type ${question.type}`;
            
            const diffBadge = document.getElementById('difficultyBadge');
            diffBadge.textContent = question.difficulty === 'extreme' ? '‚ö° EXTREMO' : question.difficulty === 'expert' ? 'Experto' : 'Dif√≠cil';
            diffBadge.className = `difficulty-badge ${question.difficulty}`;
            
            const scenarioBox = document.getElementById('scenarioBox');
            scenarioBox.innerHTML = question.scenario ? `<div class="scenario-box">üìã <strong>ESCENARIO:</strong><br><br>${question.scenario}</div>` : '';
            
            document.getElementById('questionText').innerHTML = question.question;
            
            const questionCard = document.getElementById('questionCard');
            questionCard.classList.remove('answered-correct', 'answered-incorrect');
            if (isAnswered) questionCard.classList.add(isCorrect ? 'answered-correct' : 'answered-incorrect');
            
            const optionsList = document.getElementById('optionsList');
            const letters = ['A', 'B', 'C', 'D', 'E'];
            optionsList.innerHTML = shuffled.indices.map((originalIndex, displayIndex) => {
                const option = question.options[originalIndex];
                let className = 'option';
                let feedback = '';
                if (isAnswered) {
                    className += ' disabled';
                    if (displayIndex === shuffled.correctIndex) {
                        className += ' correct';
                        feedback = displayIndex === userAnswer ? '<span class="option-feedback correct">‚úì ¬°Correcto!</span>' : '<span class="option-feedback correct">‚úì Correcta</span>';
                        if (displayIndex !== userAnswer) className += ' show-correct';
                    } else if (displayIndex === userAnswer) {
                        className += ' incorrect';
                        feedback = '<span class="option-feedback incorrect">‚úó Incorrecto</span>';
                    }
                }
                return `<div class="${className}" onclick="${isAnswered ? '' : `selectOption(${displayIndex})`}"><span class="option-letter">${letters[displayIndex]}</span><span class="option-text">${option}</span>${feedback}</div>`;
            }).join('');
            
            const feedbackContainer = document.getElementById('feedbackContainer');
            if (isAnswered) {
                let feedbackHTML = isCorrect ? '<div class="feedback-message correct"><span class="feedback-icon">‚úÖ</span><span>¬°Correcto!</span></div>' : '<div class="feedback-message incorrect"><span class="feedback-icon">‚ùå</span><span>Incorrecto</span></div>';
                if (question.explanation) feedbackHTML += `<div class="explanation"><strong>üìñ Explicaci√≥n:</strong><br><br>${question.explanation}</div>`;
                feedbackContainer.innerHTML = feedbackHTML;
            } else feedbackContainer.innerHTML = '';
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            if (currentQuestionIndex === questions.length - 1) {
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('finishBtn').classList.remove('hidden');
            } else {
                document.getElementById('nextBtn').classList.remove('hidden');
                document.getElementById('finishBtn').classList.add('hidden');
            }
        }

        function selectOption(displayIndex) {
            if (userAnswers[currentQuestionIndex] !== undefined) return;
            const shuffled = shuffledOptions[currentQuestionIndex];
            const isCorrect = displayIndex === shuffled.correctIndex;
            userAnswers[currentQuestionIndex] = displayIndex;
            answerResults[currentQuestionIndex] = isCorrect;
            if (isCorrect) correctCount++; else incorrectCount++;
            updateStats();
            renderQuestion();
            renderQuestionNav();
        }

        function prevQuestion() { if (currentQuestionIndex > 0) { currentQuestionIndex--; renderQuestion(); renderQuestionNav(); } }
        function nextQuestion() { if (currentQuestionIndex < questions.length - 1) { currentQuestionIndex++; renderQuestion(); renderQuestionNav(); } }

        function finishExam() {
            const unanswered = questions.length - Object.keys(userAnswers).length;
            const score = Math.round((correctCount / questions.length) * 100);
            document.getElementById('examScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            document.getElementById('finalScore').textContent = `${score}%`;
            document.getElementById('finalCorrect').textContent = correctCount;
            document.getElementById('finalIncorrect').textContent = incorrectCount;
            document.getElementById('finalUnanswered').textContent = unanswered;
            let gradeText = '', gradeEmoji = '';
            if (score >= 95) { gradeText = 'LEGENDARIO'; gradeEmoji = 'üëë'; }
            else if (score >= 90) { gradeText = 'Excelente'; gradeEmoji = 'üèÜ'; }
            else if (score >= 85) { gradeText = 'Muy Bien'; gradeEmoji = 'üéâ'; }
            else if (score >= 80) { gradeText = 'Aprobado'; gradeEmoji = '‚úÖ'; }
            else if (score >= 70) { gradeText = 'Casi'; gradeEmoji = 'üìö'; }
            else { gradeText = 'No Aprobado'; gradeEmoji = '‚ùå'; }
            document.getElementById('gradeText').textContent = `${gradeEmoji} ${gradeText}`;
        }

        function reviewAnswers() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('reviewScreen').classList.remove('hidden');
            const container = document.getElementById('reviewContainer');
            const letters = ['A', 'B', 'C', 'D', 'E'];
            const typeMap = {scenario:'Escenario',trap:'Trampa',numerical:'Num√©rica',combined:'Combinada',negative:'Negativa',roles:'Roles'};
            container.innerHTML = questions.map((question, qIndex) => {
                const shuffled = shuffledOptions[qIndex];
                const userAnswer = userAnswers[qIndex];
                const isCorrect = answerResults[qIndex];
                const isUnanswered = userAnswer === undefined;
                return `<div class="question-card fade-in" style="animation-delay: ${qIndex * 0.012}s">
                    <div class="question-header">
                        <span class="question-number">P${qIndex + 1}</span>
                        <span class="question-category">${question.category}</span>
                        <span class="question-type ${question.type}">${typeMap[question.type]||question.type}</span>
                        <span style="margin-left: auto; font-size: 1.5rem;">${isUnanswered ? '‚ö†Ô∏è' : (isCorrect ? '‚úÖ' : '‚ùå')}</span>
                    </div>
                    ${question.scenario ? `<div class="scenario-box">üìã <strong>ESCENARIO:</strong><br><br>${question.scenario}</div>` : ''}
                    <p class="question-text">${question.question}</p>
                    <div class="options-list">${shuffled.indices.map((originalIndex, displayIndex) => {
                        const option = question.options[originalIndex];
                        let className = 'option disabled';
                        let feedback = '';
                        if (displayIndex === shuffled.correctIndex) { className += ' correct'; feedback = '<span class="option-feedback correct">‚úì Correcta</span>'; }
                        else if (displayIndex === userAnswer && !isCorrect) { className += ' incorrect'; feedback = '<span class="option-feedback incorrect">Tu respuesta</span>'; }
                        return `<div class="${className}"><span class="option-letter">${letters[displayIndex]}</span><span class="option-text">${option}</span>${feedback}</div>`;
                    }).join('')}</div>
                    ${question.explanation ? `<div class="explanation"><strong>üìñ Explicaci√≥n:</strong><br><br>${question.explanation}</div>` : ''}
                </div>`;
            }).join('');
        }

        function backToResults() { document.getElementById('reviewScreen').classList.add('hidden'); document.getElementById('resultsScreen').classList.remove('hidden'); }

        function restartExam() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('reviewScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }
    </script>
</body>
</html>
