<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen - Cumplimiento Normativo y Resiliencia BBVA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --bg-tertiary: #1f2937;
            --bg-card: #151c2c;
            --accent-blue: #3b82f6;
            --accent-indigo: #6366f1;
            --accent-violet: #8b5cf6;
            --accent-emerald: #10b981;
            --accent-red: #ef4444;
            --accent-amber: #f59e0b;
            --accent-cyan: #06b6d4;
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --border-color: #374151;
            --glow-blue: 0 0 30px rgba(59, 130, 246, 0.3);
            --glow-violet: 0 0 30px rgba(139, 92, 246, 0.3);
            --glow-emerald: 0 0 20px rgba(16, 185, 129, 0.3);
            --glow-red: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .bg-pattern {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: 
                radial-gradient(ellipse at 10% 90%, rgba(99, 102, 241, 0.12) 0%, transparent 50%),
                radial-gradient(ellipse at 90% 10%, rgba(6, 182, 212, 0.08) 0%, transparent 50%),
                linear-gradient(rgba(99, 102, 241, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(99, 102, 241, 0.02) 1px, transparent 1px);
            background-size: 100% 100%, 100% 100%, 50px 50px, 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 2.5rem;
            padding: 2.5rem 2rem;
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
            border-radius: 24px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-indigo), var(--accent-cyan), var(--accent-violet), var(--accent-indigo));
            background-size: 300% 100%;
            animation: gradient-shift 5s ease infinite;
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .logo-icon {
            width: 75px; height: 75px;
            background: linear-gradient(135deg, var(--accent-indigo), var(--accent-cyan));
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            box-shadow: var(--glow-blue);
        }

        .header h1 {
            font-size: 1.9rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-top: 0.5rem;
        }

        .badge-container {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .badge-indigo { background: var(--accent-indigo); color: white; }
        .badge-cyan { background: var(--accent-cyan); color: black; }

        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            padding: 1.2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover { transform: translateY(-2px); }
        .stat-card.correct-stat { border-color: var(--accent-emerald); }
        .stat-card.incorrect-stat { border-color: var(--accent-red); }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--accent-indigo), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-value.correct { color: var(--accent-emerald); background: none; -webkit-text-fill-color: var(--accent-emerald); }
        .stat-value.incorrect { color: var(--accent-red); background: none; -webkit-text-fill-color: var(--accent-red); }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 0.3rem;
        }

        .progress-container {
            background: var(--bg-tertiary);
            border-radius: 10px;
            height: 10px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-indigo), var(--accent-cyan));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: var(--glow-blue);
        }

        .question-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }

        .question-card:hover { border-color: rgba(99, 102, 241, 0.4); }
        .question-card.answered-correct { border-color: var(--accent-emerald); box-shadow: var(--glow-emerald); }
        .question-card.answered-incorrect { border-color: var(--accent-red); box-shadow: var(--glow-red); }

        .question-header {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .question-number {
            background: linear-gradient(135deg, var(--accent-indigo), var(--accent-cyan));
            color: white;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 10px;
            font-size: 0.85rem;
        }

        .question-category {
            font-size: 0.8rem;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
        }

        .difficulty-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.6rem;
            border-radius: 4px;
            font-weight: 600;
        }
        .difficulty-badge.hard { background: var(--accent-red); color: white; }
        .difficulty-badge.medium { background: var(--accent-amber); color: black; }
        .difficulty-badge.easy { background: var(--accent-emerald); color: white; }

        .question-text {
            font-size: 1.05rem;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            line-height: 1.8;
        }

        .scenario-box {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 1.2rem;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .scenario-box strong { color: var(--accent-cyan); }

        .options-list { display: flex; flex-direction: column; gap: 0.75rem; }

        .option {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem 1.2rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option:hover:not(.disabled) {
            border-color: var(--accent-indigo);
            background: rgba(99, 102, 241, 0.1);
            transform: translateX(4px);
        }

        .option.correct { border-color: var(--accent-emerald); background: rgba(16, 185, 129, 0.15); }
        .option.incorrect { border-color: var(--accent-red); background: rgba(239, 68, 68, 0.15); }
        .option.disabled { cursor: not-allowed; opacity: 0.7; }
        .option.show-correct { border-color: var(--accent-emerald); background: rgba(16, 185, 129, 0.1); }

        .option-letter {
            width: 38px; height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border-radius: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .option:hover:not(.disabled) .option-letter { background: var(--accent-indigo); color: white; }
        .option.correct .option-letter { background: var(--accent-emerald); color: white; }
        .option.incorrect .option-letter { background: var(--accent-red); color: white; }
        .option.show-correct .option-letter { background: var(--accent-emerald); color: white; }

        .option-text { flex: 1; color: var(--text-primary); font-size: 0.95rem; line-height: 1.5; }

        .option-feedback { font-size: 0.85rem; font-weight: 500; margin-left: auto; flex-shrink: 0; }
        .option-feedback.correct { color: var(--accent-emerald); }
        .option-feedback.incorrect { color: var(--accent-red); }

        .feedback-message {
            margin-top: 1.5rem;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 500;
        }

        .feedback-message.correct { background: rgba(16, 185, 129, 0.15); border: 1px solid var(--accent-emerald); color: var(--accent-emerald); }
        .feedback-message.incorrect { background: rgba(239, 68, 68, 0.15); border: 1px solid var(--accent-red); color: var(--accent-red); }

        .feedback-icon { font-size: 1.5rem; }

        .explanation {
            margin-top: 1rem;
            padding: 1rem 1.2rem;
            background: rgba(6, 182, 212, 0.08);
            border-left: 3px solid var(--accent-cyan);
            border-radius: 0 10px 10px 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .explanation strong { color: var(--accent-cyan); }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            padding: 0.9rem 2rem;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary { background: linear-gradient(135deg, var(--accent-indigo), var(--accent-cyan)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--glow-blue); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-secondary:hover { border-color: var(--accent-indigo); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .question-nav {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(42px, 1fr));
            gap: 0.4rem;
            padding: 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            margin-bottom: 2rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .nav-btn {
            width: 42px; height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-btn:hover { border-color: var(--accent-indigo); color: var(--accent-indigo); }
        .nav-btn.current { background: linear-gradient(135deg, var(--accent-indigo), var(--accent-cyan)); border-color: transparent; color: white; }
        .nav-btn.correct { background: var(--accent-emerald); border-color: transparent; color: white; }
        .nav-btn.incorrect { background: var(--accent-red); border-color: transparent; color: white; }

        .results-container { text-align: center; padding: 3rem; }

        .results-score {
            font-size: 5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-indigo), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .results-grade { font-size: 2rem; margin-bottom: 2rem; }

        .results-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin: 2rem 0; }
        .result-stat { background: var(--bg-tertiary); padding: 1.5rem; border-radius: 14px; }
        .result-stat-value { font-family: 'JetBrains Mono', monospace; font-size: 2.2rem; font-weight: 600; }
        .result-stat-value.correct { color: var(--accent-emerald); }
        .result-stat-value.incorrect { color: var(--accent-red); }
        .result-stat-value.unanswered { color: var(--accent-amber); }

        .start-screen { text-align: center; padding: 3rem; }
        .start-screen h2 { font-size: 1.8rem; margin-bottom: 1.5rem; }

        .start-info { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin: 2rem 0; text-align: left; }

        .info-item {
            background: var(--bg-tertiary);
            padding: 1.2rem;
            border-radius: 14px;
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 1px solid var(--border-color);
        }

        .info-icon {
            width: 48px; height: 48px;
            background: linear-gradient(135deg, var(--accent-indigo), var(--accent-cyan));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
        }

        .info-text h4 { font-size: 0.85rem; color: var(--text-muted); font-weight: 400; }
        .info-text p { font-size: 1.05rem; color: var(--text-primary); font-weight: 600; }

        .category-selector { margin: 2rem 0; }
        .category-selector h3 { margin-bottom: 1rem; color: var(--text-secondary); font-size: 1rem; }

        .category-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.6rem; }

        .category-chip {
            padding: 0.7rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .category-chip:hover { border-color: var(--accent-indigo); }
        .category-chip.selected { border-color: var(--accent-cyan); background: rgba(6, 182, 212, 0.1); }
        .category-chip-name { font-weight: 500; color: var(--text-primary); font-size: 0.85rem; }
        .category-chip-count { font-size: 0.75rem; color: var(--text-muted); }

        .question-limit {
            margin: 1.5rem 0;
            padding: 1.2rem;
            background: var(--bg-tertiary);
            border-radius: 14px;
            border: 1px solid var(--border-color);
        }

        .question-limit label { display: block; margin-bottom: 0.5rem; color: var(--text-secondary); }

        .question-limit input {
            width: 100px;
            padding: 0.6rem;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            text-align: center;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-indigo); }

        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .stats-bar { grid-template-columns: repeat(2, 1fr); }
            .header h1 { font-size: 1.4rem; }
            .question-text { font-size: 1rem; }
            .start-info { grid-template-columns: 1fr; }
            .results-stats { grid-template-columns: 1fr; }
            .navigation { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
        }

        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse-green { 0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); } 50% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); } }
        @keyframes pulse-red { 0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } }
        .option.correct { animation: pulse-green 0.5s ease; }
        .option.incorrect { animation: pulse-red 0.5s ease; }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    
    <div class="container">
        <header class="header">
            <div class="logo-container">
                <div class="logo-icon">üõ°Ô∏è</div>
                <div>
                    <h1>Cumplimiento Normativo y Resiliencia</h1>
                    <p class="subtitle">Systems Engineering ‚Äî BBVA M√©xico</p>
                </div>
            </div>
            <div class="badge-container">
                <span class="badge badge-indigo">ENGINEERING</span>
                <span class="badge badge-cyan">COMPLIANCE</span>
            </div>
        </header>

        <div id="startScreen" class="question-card start-screen">
            <h2>üéØ Evaluaci√≥n de Conocimientos</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                Examen basado en el Cheat Sheet de Cumplimiento Normativo y Resiliencia.<br>
                Cubre regulaci√≥n, seguridad, SDLC, CVT y las 20 Reglas de Oro.
            </p>

            <div class="start-info">
                <div class="info-item">
                    <div class="info-icon">üìã</div>
                    <div class="info-text">
                        <h4>Total de preguntas</h4>
                        <p>70 preguntas</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">üìö</div>
                    <div class="info-text">
                        <h4>Categor√≠as</h4>
                        <p>12 temas</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">‚ö†Ô∏è</div>
                    <div class="info-text">
                        <h4>Dificultad</h4>
                        <p>Media-Alta</p>
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-icon">‚úÖ</div>
                    <div class="info-text">
                        <h4>Para aprobar</h4>
                        <p>70% m√≠nimo</p>
                    </div>
                </div>
            </div>

            <div class="category-selector">
                <h3>Filtrar por categor√≠as:</h3>
                <div class="category-grid" id="categoryGrid"></div>
            </div>

            <div class="question-limit">
                <label>N√∫mero de preguntas:</label>
                <input type="number" id="questionLimit" min="10" max="70" value="70">
                <span style="color: var(--text-muted); margin-left: 0.5rem;">(10-70)</span>
            </div>

            <button class="btn btn-primary" onclick="startExam()" style="margin-top: 1.5rem; padding: 1rem 3rem; font-size: 1.1rem;">
                üöÄ Iniciar Evaluaci√≥n
            </button>
        </div>

        <div id="examScreen" class="hidden">
            <div class="stats-bar">
                <div class="stat-card">
                    <div class="stat-value" id="currentQuestion">1</div>
                    <div class="stat-label">Actual</div>
                </div>
                <div class="stat-card correct-stat">
                    <div class="stat-value correct" id="correctCount">0</div>
                    <div class="stat-label">Correctas</div>
                </div>
                <div class="stat-card incorrect-stat">
                    <div class="stat-value incorrect" id="incorrectCount">0</div>
                    <div class="stat-label">Incorrectas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalQuestions">70</div>
                    <div class="stat-label">Total</div>
                </div>
            </div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>

            <div class="question-nav" id="questionNav"></div>

            <div class="question-card fade-in" id="questionCard">
                <div class="question-header">
                    <span class="question-number" id="questionNumber">Pregunta 1</span>
                    <span class="question-category" id="questionCategory">Categor√≠a</span>
                    <span class="difficulty-badge" id="difficultyBadge">Media</span>
                </div>
                <div id="scenarioBox"></div>
                <p class="question-text" id="questionText">Texto de la pregunta...</p>
                <div class="options-list" id="optionsList"></div>
                <div id="feedbackContainer"></div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="prevQuestion()">‚Üê Anterior</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">Siguiente ‚Üí</button>
                <button class="btn btn-primary hidden" id="finishBtn" onclick="finishExam()">üèÅ Finalizar</button>
            </div>
        </div>

        <div id="resultsScreen" class="hidden">
            <div class="question-card results-container">
                <h2 style="margin-bottom: 1rem;">Resultados de la Evaluaci√≥n</h2>
                <div class="results-score" id="finalScore">0%</div>
                <div class="results-grade" id="gradeText">Calificaci√≥n</div>
                
                <div class="results-stats">
                    <div class="result-stat">
                        <div class="result-stat-value correct" id="finalCorrectCount">0</div>
                        <div class="stat-label">Correctas</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-stat-value incorrect" id="finalIncorrectCount">0</div>
                        <div class="stat-label">Incorrectas</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-stat-value unanswered" id="finalUnansweredCount">0</div>
                        <div class="stat-label">Sin responder</div>
                    </div>
                </div>

                <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="reviewAnswers()">üìã Revisar Respuestas</button>
                    <button class="btn btn-primary" onclick="restartExam()">üîÑ Nuevo Examen</button>
                </div>
            </div>
        </div>

        <div id="reviewScreen" class="hidden">
            <div class="question-card" style="margin-bottom: 1rem;">
                <h2 style="margin-bottom: 0.5rem;">Revisi√≥n de Respuestas</h2>
                <p style="color: var(--text-secondary);">Las respuestas correctas se muestran en verde</p>
            </div>
            <div id="reviewContainer"></div>
            <div class="navigation">
                <button class="btn btn-primary" onclick="backToResults()">‚Üê Volver a Resultados</button>
            </div>
        </div>
    </div>

    <script>
        const allQuestions = [
            // ========== MARCO REGULATORIO ==========
            {id:1,category:"Marco Regulatorio",difficulty:"medium",question:"¬øQu√© ente regulador es emisor de la Circular √önica de Bancos (CUB)?",options:["Banxico","CNBV (Comisi√≥n Nacional Bancaria y de Valores)","Secretar√≠a Anticorrupci√≥n","Secretar√≠a de Hacienda"],correct:1,explanation:"La CNBV supervisa y regula entidades financieras y es emisora de la CUB."},
            {id:2,category:"Marco Regulatorio",difficulty:"medium",question:"¬øCu√°l es la funci√≥n principal de Banxico relacionada con Engineering?",options:["Supervisar entidades financieras","Emitir la CUB","Asegurar funcionamiento de sistemas de pago y regulaciones de ciberseguridad","Vigilar protecci√≥n de datos personales"],correct:2,explanation:"Banxico es el banco central que asegura el funcionamiento de sistemas de pago y emite regulaciones de ciberseguridad."},
            {id:3,category:"Marco Regulatorio",difficulty:"hard",question:"¬øQu√© ley vigila la Secretar√≠a Anticorrupci√≥n (antes INAI) que es fundamental para sistemas con informaci√≥n de clientes?",options:["Ley General de Bancos","LFPDPPP (Ley Federal de Protecci√≥n de Datos Personales)","Circular √önica de Bancos","Ley de Ciberseguridad"],correct:1,explanation:"La Secretar√≠a Anticorrupci√≥n (antes INAI) vigila el cumplimiento de la LFPDPPP."},
            {id:4,category:"Marco Regulatorio",difficulty:"easy",question:"¬øD√≥nde debe consultar un desarrollador la regulaci√≥n interna de BBVA?",options:["En Google","En el sitio bbva-regulacion-interna.appspot.com","En Wikipedia","Solo preguntando al Tech Lead"],correct:1,explanation:"El sitio oficial de regulaci√≥n interna es https://bbva-regulacion-interna.appspot.com/"},

            // ========== RESILIENCIA DIGITAL ==========
            {id:5,category:"Resiliencia",difficulty:"medium",question:"¬øQu√© es la Resiliencia Digital seg√∫n la norma?",options:["Capacidad de crear software r√°pidamente","Capacidad para resistir, responder y recuperarnos de cualquier incidente tecnol√≥gico","Capacidad de escalar aplicaciones","Capacidad de automatizar pruebas"],correct:1,explanation:"Resiliencia Digital: Capacidad para resistir, responder y recuperarnos de cualquier incidente tecnol√≥gico."},
            {id:6,category:"Resiliencia",difficulty:"hard",question:"¬øQu√© se considera el 'Modelo de Gobierno de Engineering'?",options:["Un framework de desarrollo √°gil","La 'constituci√≥n' de Engineering, norma fundacional de todas las normativas","Un documento de arquitectura","El organigrama del banco"],correct:1,explanation:"El Modelo de Gobierno es la 'constituci√≥n' de Engineering, de la que emanan todas las normativas espec√≠ficas."},
            {id:7,category:"Resiliencia",difficulty:"medium",question:"El 'Porqu√©' de la Resiliencia Operativa Digital es:",options:["Aumentar la velocidad de desarrollo","Fortalecer la capacidad de resistir, responder y recuperarse ante ciberataques y fallos","Reducir costos de infraestructura","Mejorar la experiencia del usuario"],correct:1,explanation:"El porqu√© es fortalecer la capacidad de resistir, responder y recuperarse ante ciberataques, fallos de software y cualquier incidente."},

            // ========== CUERPO NORMATIVO ==========
            {id:8,category:"Cuerpo Normativo",difficulty:"hard",question:"¬øQu√© direcci√≥n es responsable del Modelo de Gobierno de Engineering?",options:["Information Security","Systems","Strategy & Control","Infrastructure & IT Ops"],correct:2,explanation:"Strategy & Control es responsable del Modelo de Gobierno, la 'constituci√≥n' de Engineering."},
            {id:9,category:"Cuerpo Normativo",difficulty:"hard",question:"¬øQu√© direcci√≥n es responsable de las normas de SDLC, Seguridad en SDLC y Testing?",options:["Information Security","Systems","RCS Engineering","Infrastructure & IT Ops"],correct:1,explanation:"Systems es responsable de SDLC, Seguridad en SDLC, Adquisici√≥n/Desarrollo/Mantenimiento, Testing e Integridad de Informaci√≥n."},
            {id:10,category:"Cuerpo Normativo",difficulty:"medium",question:"¬øQu√© direcci√≥n es responsable de Continuidad TIC, CMDB, Backups y Alta Disponibilidad?",options:["Systems","Physical Security","Information Security","Infrastructure & IT Ops"],correct:3,explanation:"Infrastructure & IT Ops es responsable de Continuidad TIC, CMDB, Backups, Alta Disponibilidad, Obsolescencia, etc."},
            {id:11,category:"Cuerpo Normativo",difficulty:"medium",question:"¬øQu√© direcci√≥n maneja la evaluaci√≥n, homologaci√≥n y supervisi√≥n de proveedores?",options:["RCS Third Party","Systems","Information Security","Strategy & Control"],correct:0,explanation:"RCS Third Party es responsable de Riesgo TIC de Terceros y Ciclo de Vida de Servicios de Terceros."},

            // ========== SEGURIDAD DE LA INFORMACI√ìN ==========
            {id:12,category:"Seguridad Info",difficulty:"hard",question:"¬øCu√°les son los 4 niveles de clasificaci√≥n de la informaci√≥n?",options:["Baja, Media, Alta, Cr√≠tica","P√∫blica, Interna, Confidencial, Secreta","Nivel 1, 2, 3, 4","Abierta, Restringida, Privada, Ultra"],correct:1,explanation:"Los 4 niveles son: P√∫blica, Interna, Confidencial y Secreta."},
            {id:13,category:"Seguridad Info",difficulty:"hard",question:"¬øQu√© controles m√≠nimos requiere la informaci√≥n clasificada como 'Secreta'?",options:["Solo control de acceso b√°sico","Protecci√≥n b√°sica de integridad","Cifrado E2E, MFA, tokenizaci√≥n, pseudonimizaci√≥n, auditor√≠a total","Cifrado y RBAC estricto"],correct:2,explanation:"Informaci√≥n Secreta requiere: Cifrado E2E, MFA, tokenizaci√≥n, pseudonimizaci√≥n y auditor√≠a total."},
            {id:14,category:"Seguridad Info",difficulty:"medium",question:"¬øCu√°les son los 3 estados de los datos que requieren protecci√≥n?",options:["Creaci√≥n, Uso, Destrucci√≥n","En Tr√°nsito, En Reposo, En Uso","Entrada, Proceso, Salida","Almacenamiento, Transmisi√≥n, Procesamiento"],correct:1,explanation:"Los 3 estados son: En Tr√°nsito, En Reposo y En Uso."},
            {id:15,category:"Seguridad Info",difficulty:"medium",question:"¬øQu√© cifrado es obligatorio para datos 'En Tr√°nsito'?",options:["AES-256","SHA-256","TLS de extremo a extremo","MD5"],correct:2,explanation:"Para datos En Tr√°nsito es obligatorio el cifrado TLS de extremo a extremo."},
            {id:16,category:"Seguridad Info",difficulty:"hard",question:"¬øQu√© significan las siglas CIDA en clasificaci√≥n de activos?",options:["Control, Integridad, Disponibilidad, Acceso","Confidencialidad, Integridad, Disponibilidad, Autenticidad","Cifrado, Identidad, Datos, Auditor√≠a","Cumplimiento, Informaci√≥n, Desarrollo, Aplicaci√≥n"],correct:1,explanation:"CIDA = Confidencialidad, Integridad, Disponibilidad, Autenticidad."},
            {id:17,category:"Seguridad Info",difficulty:"hard",question:"En CIDA, la pregunta '¬øQu√© pasa si la informaci√≥n se fuga?' determina:",options:["Nivel de disponibilidad","Nivel de integridad","Nivel de cifrado y control de acceso (Confidencialidad)","Nivel de autenticaci√≥n"],correct:2,explanation:"La Confidencialidad determina el nivel de cifrado y control de acceso."},
            {id:18,category:"Seguridad Info",difficulty:"hard",question:"¬øCu√°les son los algoritmos de criptograf√≠a aprobados por el banco?",options:["MD5 y SHA-1","RSA y DSA","AES-256 (cifrado) y SHA-256 (hash)","DES y 3DES"],correct:2,explanation:"Algoritmos aprobados: AES-256 para cifrado y SHA-256 para hash."},
            {id:19,category:"Seguridad Info",difficulty:"medium",question:"Respecto a criptograf√≠a, ¬øqu√© est√° PROHIBIDO?",options:["Usar TLS","Rotar claves peri√≥dicamente","Crear implementaciones criptogr√°ficas personalizadas y almacenar claves en c√≥digo","Usar bibliotecas aprobadas"],correct:2,explanation:"PROHIBIDO: crear implementaciones propias y almacenar claves en c√≥digo o archivos de configuraci√≥n."},

            // ========== GESTI√ìN DE IDENTIDADES ==========
            {id:20,category:"Identidades",difficulty:"medium",question:"El principio de 'M√≠nimo Privilegio' significa:",options:["Dar acceso completo a desarrolladores senior","Denegar todo por defecto y solo dar permisos m√≠nimos e indispensables","Permitir acceso temporal a todos los recursos","Dar acceso seg√∫n antig√ºedad en la empresa"],correct:1,explanation:"M√≠nimo Privilegio: Denegar todo por defecto. Solo permisos m√≠nimos e indispensables."},
            {id:21,category:"Identidades",difficulty:"hard",question:"La 'Segregaci√≥n de Funciones' implica:",options:["Separar el c√≥digo en m√≥dulos","Implementar 'cuatro ojos' / doble aprobaci√≥n - quien crea ‚â† quien autoriza","Dividir el equipo en subequipos","Separar ambientes de desarrollo y producci√≥n"],correct:1,explanation:"Segregaci√≥n de Funciones: Implementar doble aprobaci√≥n para operaciones sensibles. Quien crea ‚â† quien autoriza."},
            {id:22,category:"Identidades",difficulty:"medium",question:"Cuando un miembro del equipo cambia de funci√≥n o deja el banco, ¬øqu√© debe hacerse?",options:["Nada, los accesos expiran autom√°ticamente","Notificar y revocar accesos a repositorios, herramientas y sistemas","Solo cambiar su contrase√±a","Esperar a que RH lo notifique"],correct:1,explanation:"Se debe notificar cuando un miembro cambia de funci√≥n o deja el banco y revocar todos sus accesos."},
            {id:23,category:"Identidades",difficulty:"medium",question:"La Trazabilidad en control de acceso significa:",options:["Seguir el c√≥digo en Git","Todas las acciones deben quedar registradas en logs inmutables: qui√©n, qu√©, cu√°ndo, c√≥mo","Documentar los requisitos","Rastrear bugs en Jira"],correct:1,explanation:"Trazabilidad: Todas las acciones deben quedar registradas. Logs de auditor√≠a inmutables."},

            // ========== REDES Y HARDENING ==========
            {id:24,category:"Redes",difficulty:"medium",question:"¬øQu√© significa 'Segmentaci√≥n de Red'?",options:["Dividir la aplicaci√≥n en microservicios","Infraestructura dividida en zonas de seguridad con tr√°fico restringido entre zonas","Separar frontend de backend","Crear m√∫ltiples bases de datos"],correct:1,explanation:"Segmentaci√≥n: Infraestructura dividida en zonas (producci√≥n, desarrollo, DMZ) con tr√°fico restringido."},
            {id:25,category:"Redes",difficulty:"medium",question:"¬øCu√°l es la pol√≠tica por defecto de los Firewalls seg√∫n la norma?",options:["Permitir todo y bloquear lo peligroso","Denegar todo por defecto, solo tr√°fico expl√≠citamente autorizado","Permitir tr√°fico interno, bloquear externo","Depende del tipo de aplicaci√≥n"],correct:1,explanation:"Firewalls: Denegar por defecto. Solo tr√°fico expl√≠citamente autorizado."},
            {id:26,category:"Redes",difficulty:"hard",question:"¬øQu√© son las 'Golden Images' corporativas?",options:["Logos oficiales de BBVA","Configuraciones de seguridad estandarizadas para servidores con solo servicios necesarios","Im√°genes de referencia para UI","Backups de oro de bases de datos"],correct:1,explanation:"Golden Images: Configuraciones de seguridad estandarizadas con solo servicios estrictamente necesarios."},
            {id:27,category:"Redes",difficulty:"medium",question:"Al desplegar una API, ¬øqu√© debes solicitar respecto a firewalls?",options:["Nada, se configura autom√°ticamente","Definir y solicitar reglas de firewall con puertos, IPs de origen y destino","Solo notificar al equipo de infraestructura","Abrir todos los puertos temporalmente"],correct:1,explanation:"Al desplegar APIs: definir y solicitar reglas de firewall espec√≠ficas con puertos, IPs de origen y destino."},

            // ========== MONITORIZACI√ìN Y VULNERABILIDADES ==========
            {id:28,category:"Vulnerabilidades",difficulty:"hard",question:"¬øQu√© herramientas se usan en el pipeline CI/CD para gesti√≥n de vulnerabilidades?",options:["Solo SonarQube","Jenkins y Git","SAST, DAST, SCA y Chimera (reportes)","Solo pruebas manuales"],correct:2,explanation:"Herramientas en pipeline: SAST (An√°lisis Est√°tico), DAST (An√°lisis Din√°mico), SCA (An√°lisis de Componentes), Chimera (reportes)."},
            {id:29,category:"Vulnerabilidades",difficulty:"hard",question:"Para vulnerabilidades de criticidad CR√çTICA, ¬øcu√°l es la acci√≥n requerida?",options:["Incluir en backlog de mantenimiento","Planificar parche en el siguiente sprint","M√ÅXIMA PRIORIDAD - Correcci√≥n inmediata por encima de nuevas funcionalidades","Documentar y escalar a seguridad"],correct:2,explanation:"Vulnerabilidades CR√çTICAS: M√ÅXIMA PRIORIDAD. Correcci√≥n inmediata por encima de nuevas funcionalidades."},
            {id:30,category:"Vulnerabilidades",difficulty:"medium",question:"¬øQu√© debe incluir un log de calidad seg√∫n la norma?",options:["Solo errores","Qui√©n, qu√©, cu√°ndo, c√≥mo - con suficiente detalle","Solo transacciones exitosas","Toda la informaci√≥n posible"],correct:1,explanation:"Logs de calidad: qui√©n, qu√©, cu√°ndo, c√≥mo, con suficiente detalle."},
            {id:31,category:"Vulnerabilidades",difficulty:"medium",question:"¬øQu√© est√° PROHIBIDO registrar en los logs?",options:["Errores cr√≠ticos","Cambios de configuraci√≥n","Datos sensibles (contrase√±as, datos personales, tokens)","Login exitosos"],correct:2,explanation:"NUNCA registrar datos sensibles en los logs (contrase√±as, datos personales, tokens)."},

            // ========== GESTI√ìN DE INCIDENTES ==========
            {id:32,category:"Incidentes",difficulty:"medium",question:"En la fase de Detecci√≥n de un incidente, ¬øqu√© debe hacer el desarrollador?",options:["Intentar solucionarlo solo","Reportar INMEDIATAMENTE al CSIRT/CERT cualquier comportamiento an√≥malo","Esperar confirmaci√≥n de que es un incidente real","Documentarlo en Jira"],correct:1,explanation:"Detecci√≥n: Reportar INMEDIATAMENTE al CSIRT/CERT. NO asumir que es un error sin importancia."},
            {id:33,category:"Incidentes",difficulty:"hard",question:"¬øQu√© es un 'war room' en el contexto de gesti√≥n de incidentes?",options:["Sala de reuniones del equipo","Lugar donde el desarrollador puede ser requerido para an√°lisis t√©cnico y b√∫squeda de causa ra√≠z","Sala de servidores","Centro de datos de respaldo"],correct:1,explanation:"War room: Lugar donde el desarrollador proporciona an√°lisis t√©cnico, busca causa ra√≠z y colabora en soluci√≥n de emergencia."},
            {id:34,category:"Incidentes",difficulty:"medium",question:"¬øQu√© mejoras se deben implementar en la fase de 'Lecciones Aprendidas'?",options:["Solo documentaci√≥n","Timeouts, reintentos, circuit breakers","Solo cambios de proceso","Nada, solo documentar lo ocurrido"],correct:1,explanation:"Lecciones Aprendidas: Implementar mejoras como timeouts, reintentos, circuit breakers."},

            // ========== SDLC ==========
            {id:35,category:"SDLC",difficulty:"hard",question:"¬øQu√© control se aplica en la fase de An√°lisis del SDLC?",options:["SAST","An√°lisis de Riesgo Tecnol√≥gico (ART)","Hacking √âtico","CVT"],correct:1,explanation:"En la fase de An√°lisis se aplica el An√°lisis de Riesgo Tecnol√≥gico (ART)."},
            {id:36,category:"SDLC",difficulty:"hard",question:"¬øQu√© controles se aplican en la fase de Dise√±o?",options:["SAST y SCA","Modelado de Amenazas (Threat Modeling) y Security by Design","CVT y CRQ","Pruebas de Rendimiento"],correct:1,explanation:"En Dise√±o: Modelado de Amenazas (Threat Modeling) y Security by Design."},
            {id:37,category:"SDLC",difficulty:"medium",question:"¬øQu√© controles se aplican en la fase de Construcci√≥n?",options:["DAST y Hacking √âtico","SAST, SCA y Codificaci√≥n Segura (OWASP Top 10)","Solo pruebas unitarias","CVT"],correct:1,explanation:"En Construcci√≥n: SAST, SCA, Codificaci√≥n Segura (OWASP Top 10)."},
            {id:38,category:"SDLC",difficulty:"medium",question:"¬øQu√© es el 'Shift Left' en seguridad?",options:["Mover la seguridad hacia las fases finales","Mover la seguridad hacia la IZQUIERDA (fases m√°s tempranas) del ciclo de vida","Desplazar el c√≥digo hacia la izquierda","Priorizar el frontend sobre el backend"],correct:1,explanation:"Shift Left: Mover la seguridad hacia las fases m√°s tempranas. Encontrar problemas antes es m√°s barato."},
            {id:39,category:"SDLC",difficulty:"medium",question:"¬øQu√© pr√°cticas de codificaci√≥n segura previenen Inyecci√≥n SQL y XSS?",options:["Usar frameworks modernos","Validaci√≥n estricta de TODAS las entradas del usuario","Solo usar HTTPS","Implementar MFA"],correct:1,explanation:"Prevenir Inyecci√≥n SQL y XSS: Validaci√≥n estricta de TODAS las entradas del usuario."},
            {id:40,category:"SDLC",difficulty:"easy",question:"Seg√∫n la Regla de Oro del Testing, ¬øqu√© es un c√≥digo sin pruebas?",options:["C√≥digo eficiente","C√≥digo incompleto","C√≥digo legacy","C√≥digo en revisi√≥n"],correct:1,explanation:"Un c√≥digo sin pruebas es un c√≥digo incompleto. La calidad NO es negociable."},

            // ========== CONTINUIDAD Y HA ==========
            {id:41,category:"Continuidad",difficulty:"hard",question:"¬øQu√© significa RTO (Recovery Time Objective)?",options:["Tiempo para crear un release","Tiempo m√°ximo aceptable para RECUPERAR el servicio","Tiempo de respuesta de la aplicaci√≥n","Tiempo para ejecutar pruebas"],correct:1,explanation:"RTO: Tiempo m√°ximo aceptable para recuperar el servicio despu√©s de un incidente."},
            {id:42,category:"Continuidad",difficulty:"hard",question:"¬øQu√© significa RPO (Recovery Point Objective)?",options:["Punto de recuperaci√≥n en el c√≥digo","Cantidad m√°xima aceptable de P√âRDIDA DE DATOS","Objetivo de rendimiento","Plan de recuperaci√≥n"],correct:1,explanation:"RPO: Cantidad m√°xima aceptable de p√©rdida de datos. Determina frecuencia de backups."},
            {id:43,category:"Continuidad",difficulty:"medium",question:"¬øQu√© m√©trica se minimiza con runbooks detallados, pruebas de DR y automatizaci√≥n?",options:["RTO","RPO","MTTR (Mean Time To Recovery)","MTTD"],correct:2,explanation:"MTTR (Tiempo promedio de recuperaci√≥n) se minimiza con runbooks, pruebas de DR y automatizaci√≥n."},
            {id:44,category:"Continuidad",difficulty:"medium",question:"¬øQu√© m√©trica se mejora exponiendo endpoint /health y definiendo umbrales de alerta?",options:["RTO","RPO","MTTR","MTTD (Mean Time To Detect)"],correct:3,explanation:"MTTD (Tiempo promedio en detectar) se mejora con m√©tricas expuestas (/health) y umbrales de alerta."},
            {id:45,category:"Continuidad",difficulty:"medium",question:"Para Alta Disponibilidad, las aplicaciones deben ser:",options:["Monol√≠ticas","STATELESS (sin estado)","Con mucha memoria","Sincr√≥nicas"],correct:1,explanation:"Para HA: Aplicaciones STATELESS. Sesi√≥n externalizada en componente externo compartido."},
            {id:46,category:"Continuidad",difficulty:"easy",question:"¬øQu√© endpoint HTTP deben exponer las aplicaciones para balanceadores de carga?",options:["/status","/ping","/health","/check"],correct:2,explanation:"Health Checks: Endpoint HTTP /health para balanceadores de carga."},
            {id:47,category:"Continuidad",difficulty:"hard",question:"¬øQu√© significa 'Sin SPOFs' en arquitectura?",options:["Sin errores de c√≥digo","Sin Single Points of Failure (puntos √∫nicos de fallo)","Sin servicios externos","Sin pruebas autom√°ticas"],correct:1,explanation:"Sin SPOFs: Eliminar todos los Single Points of Failure de la arquitectura."},
            {id:48,category:"Continuidad",difficulty:"medium",question:"¬øQu√© es 'Chaos Engineering'?",options:["Desarrollo sin metodolog√≠a","Observar comportamiento ante caos INDUCIDO e implementar mejoras","Pruebas aleatorias","Desarrollo experimental"],correct:1,explanation:"Chaos Engineering: Observar comportamiento ante caos inducido. Implementar mejoras: timeouts, reintentos, circuit breakers."},

            // ========== OPERACI√ìN Y TERCEROS ==========
            {id:49,category:"Operaci√≥n",difficulty:"medium",question:"¬øQu√© debe registrarse en la CMDB?",options:["Solo el c√≥digo fuente","Tu aplicaci√≥n, sus componentes y dependencias mapeadas","Solo los bugs","Los salarios del equipo"],correct:1,explanation:"CMDB: Registrar tu aplicaci√≥n y sus componentes. Mapear dependencias: BDs, APIs, servicios de terceros."},
            {id:50,category:"Operaci√≥n",difficulty:"medium",question:"¬øQu√© deben incluir los Runbooks?",options:["Solo c√≥digo de la aplicaci√≥n","Arranque, parada, alertas comunes, diagn√≥stico b√°sico","Solo informaci√≥n de contacto","Documentaci√≥n de requisitos"],correct:1,explanation:"Runbooks: Arranque, parada, alertas comunes, diagn√≥stico b√°sico. Mantener actualizados."},
            {id:51,category:"Operaci√≥n",difficulty:"hard",question:"Respecto a obsolescencia, ¬øqu√© versiones de software se deben usar?",options:["Las m√°s recientes siempre","Versiones beta para innovar","Versiones con soporte a largo plazo (LTS)","Cualquier versi√≥n estable"],correct:2,explanation:"SIEMPRE usar versiones con soporte a largo plazo (LTS). NUNCA versiones beta o a punto de perder soporte."},
            {id:52,category:"Operaci√≥n",difficulty:"hard",question:"¬øPor qu√© es peligroso usar software sin soporte?",options:["Es m√°s lento","Es una puerta abierta a atacantes (sin parches de seguridad)","Cuesta m√°s dinero","Es m√°s dif√≠cil de mantener"],correct:1,explanation:"Software sin soporte = puerta abierta a atacantes (sin parches de seguridad)."},
            {id:53,category:"Operaci√≥n",difficulty:"hard",question:"En la gesti√≥n de terceros, ¬øqu√© es la 'Homologaci√≥n (Due Diligence)'?",options:["Pruebas de rendimiento del proveedor","Evaluaci√≥n t√©cnica, financiera y de seguridad antes de trabajar con el proveedor","Negociaci√≥n de precios","Firma del contrato"],correct:1,explanation:"Homologaci√≥n: Evaluaci√≥n t√©cnica, financiera y de seguridad. No puedes trabajar con proveedor no homologado."},
            {id:54,category:"Operaci√≥n",difficulty:"medium",question:"Si un proveedor notifica un incidente de seguridad, ¬øqu√© debes hacer?",options:["Esperar instrucciones de seguridad","Evaluar impacto en tus apps y activar contingencia si es necesario","Solo documentarlo","Nada, es problema del proveedor"],correct:1,explanation:"Incidente de tercero: Evaluar impacto en tus apps. Activar contingencia si es necesario (deshabilitar integraci√≥n)."},

            // ========== MODELO 3 L√çNEAS ==========
            {id:55,category:"3 L√≠neas",difficulty:"hard",question:"¬øQui√©nes conforman la 1¬™ L√≠nea de Defensa?",options:["RCS IT","Auditor√≠a Interna","T√∫, tu equipo, Tech Leads, POs - Due√±os del riesgo","Consultores externos"],correct:2,explanation:"1¬™ L√≠nea: T√∫, tu equipo, Tech Leads, POs. Son due√±os del riesgo y deben conocer y aplicar normativas."},
            {id:56,category:"3 L√≠neas",difficulty:"hard",question:"¬øQu√© es la 2¬™ L√≠nea de Defensa?",options:["El equipo de desarrollo","RCS IT (Riesgos, Control y Soporte) - Establecer reglas y verificar independientemente","Auditor√≠a Interna","Proveedores externos"],correct:1,explanation:"2¬™ L√≠nea: RCS IT. Establecer reglas, asesorar, verificar independientemente."},
            {id:57,category:"3 L√≠neas",difficulty:"medium",question:"¬øQu√© es la 3¬™ L√≠nea de Defensa?",options:["El Product Owner","El Service Owner","Auditor√≠a Interna - Revisiones independientes y objetivas","El Change Lead"],correct:2,explanation:"3¬™ L√≠nea: Auditor√≠a Interna. Revisiones independientes y objetivas de todo el sistema."},
            {id:58,category:"3 L√≠neas",difficulty:"hard",question:"En el proceso de Testing de Controles de RCS IT, ¬øqu√© es el TOE?",options:["Test of Effectiveness - Verifica ejecuci√≥n real con muestra de evidencias","Test of Design - Eval√∫a si el control est√° bien dise√±ado","Tipo de prueba funcional","Test de operaci√≥n"],correct:0,explanation:"TOE (Test of Effectiveness): Verifica ejecuci√≥n real. Seleccionan muestra (ej. 15 CRQs) y piden EVIDENCIA."},
            {id:59,category:"3 L√≠neas",difficulty:"medium",question:"¬øQu√© resultado tiene el Testing de RCS IT si la evidencia es correcta?",options:["Deficiencia","Gap con plan de acci√≥n","Control Efectivo","Excepci√≥n documentada"],correct:2,explanation:"Evidencia correcta = Control Efectivo. Evidencia faltante/incorrecta = Deficiencia (Gap)."},

            // ========== CVT ==========
            {id:60,category:"CVT",difficulty:"medium",question:"¬øQu√© es el CVT (Checklist de Validaci√≥n T√©cnica)?",options:["Un tipo de prueba automatizada","La 'lista de verificaci√≥n del piloto' - garantiza cumplimiento de controles m√≠nimos antes de producci√≥n","Un documento de arquitectura","Una m√©trica de rendimiento"],correct:1,explanation:"CVT: Procedimiento formal que garantiza cumplimiento de controles m√≠nimos antes de instalar en producci√≥n."},
            {id:61,category:"CVT",difficulty:"hard",question:"¬øCu√°ntos controles tiene el CVT?",options:["10 controles","12 controles","16 controles","20 controles"],correct:2,explanation:"El CVT tiene 16 controles: DyD-001 a DyD-009, PRO-01 a PRO-03, SEG-01, SEG-02, FRA-01, DMA-01."},
            {id:62,category:"CVT",difficulty:"hard",question:"¬øQui√©n es el responsable del CVT en cada instalaci√≥n?",options:["El desarrollador principal","El Product Owner","El Change Lead de la instalaci√≥n","El Service Owner"],correct:2,explanation:"Responsable del CVT: Change Lead de la instalaci√≥n."},
            {id:63,category:"CVT",difficulty:"medium",question:"¬øD√≥nde se almacena el expediente final del CVT?",options:["En Jira","En el repositorio de c√≥digo","En el Centro √önico de Conocimiento (CUC)","En SharePoint del equipo"],correct:2,explanation:"El expediente final se almacena en el Centro √önico de Conocimiento (CUC)."},
            {id:64,category:"CVT",difficulty:"medium",question:"Si el CVT est√° incompleto, ¬øqu√© sucede con el despliegue?",options:["Se despliega con advertencia","El despliegue es DETENIDO hasta subsanaci√≥n","Se programa para horario nocturno","Se escala al PO"],correct:1,explanation:"CVT incompleto = despliegue DETENIDO hasta subsanaci√≥n."},
            {id:65,category:"CVT",difficulty:"hard",question:"¬øQu√© control del CVT requiere el CRQ aprobado, Plan de Instalaci√≥n y Plan de Retorno?",options:["DyD-001","DyD-006","PRO-01 (Gesti√≥n del Cambio)","SEG-01"],correct:2,explanation:"PRO-01 Gesti√≥n del Cambio: CRQ aprobado (Remedy/ServiceNow) + Plan Instalaci√≥n + Plan Retorno."},
            {id:66,category:"CVT",difficulty:"hard",question:"¬øQu√© control requiere el documento de autorizaci√≥n para usar datos reales en ambientes previos?",options:["DyD-001","DyD-09 (Consentimiento Datos Reales)","PRO-03","SEG-02"],correct:1,explanation:"DyD-09: Documento de autorizaci√≥n para usar datos reales en ambientes previos."},

            // ========== SEGURIDAD F√çSICA Y REGLAS DE ORO ==========
            {id:67,category:"Seguridad F√≠sica",difficulty:"easy",question:"¬øQu√© debes hacer SIEMPRE al ausentarte del puesto de trabajo?",options:["Apagar la computadora","Bloquear la pantalla","Cerrar todas las aplicaciones","Notificar al supervisor"],correct:1,explanation:"Bloquear pantalla SIEMPRE al ausentarte del puesto."},
            {id:68,category:"Seguridad F√≠sica",difficulty:"easy",question:"¬øQu√© es la pol√≠tica de 'escritorio limpio'?",options:["Limpiar el escritorio diariamente","Guardar documentos sensibles al final del d√≠a","No comer en el escritorio","Tener pocas cosas en el escritorio"],correct:1,explanation:"Pol√≠tica de escritorio limpio: guardar documentos sensibles al final del d√≠a."},
            {id:69,category:"Reglas de Oro",difficulty:"medium",question:"Seg√∫n las 20 Reglas de Oro, la seguridad es responsabilidad de:",options:["El equipo de seguridad","TU responsabilidad como desarrollador, no de un equipo aparte","Solo del CSIRT","Del Service Owner"],correct:1,explanation:"Regla #1: La seguridad es TU responsabilidad, no de un equipo aparte."},
            {id:70,category:"Reglas de Oro",difficulty:"hard",question:"¬øCu√°l es el impacto del incumplimiento normativo en el aspecto regulatorio y de negocio?",options:["Solo retrabajos en c√≥digo","Sanciones regulatorias, p√©rdida de confianza del cliente, p√©rdidas patrimoniales, riesgo reputacional","Solo mayor tiempo en revisiones","Solo vulnerabilidades de seguridad"],correct:1,explanation:"Impacto regulatorio/negocio: Sanciones, p√©rdida de confianza, p√©rdidas patrimoniales, riesgo reputacional."}
        ];

        const categories = {
            'Marco Regulatorio': { name: '‚öñÔ∏è Marco Regulatorio', count: 4 },
            'Resiliencia': { name: 'üîÑ Resiliencia', count: 3 },
            'Cuerpo Normativo': { name: 'üìö Cuerpo Normativo', count: 4 },
            'Seguridad Info': { name: 'üîê Seguridad Info', count: 8 },
            'Identidades': { name: 'üë§ Identidades', count: 4 },
            'Redes': { name: 'üåê Redes', count: 4 },
            'Vulnerabilidades': { name: 'üõ°Ô∏è Vulnerabilidades', count: 4 },
            'Incidentes': { name: 'üö® Incidentes', count: 3 },
            'SDLC': { name: 'üîÑ SDLC', count: 6 },
            'Continuidad': { name: '‚ö° Continuidad', count: 8 },
            'Operaci√≥n': { name: 'üñ•Ô∏è Operaci√≥n', count: 6 },
            '3 L√≠neas': { name: 'üèõÔ∏è 3 L√≠neas', count: 5 },
            'CVT': { name: '‚úÖ CVT', count: 7 },
            'Seguridad F√≠sica': { name: 'üè¢ Seg. F√≠sica', count: 2 },
            'Reglas de Oro': { name: 'üèÜ Reglas de Oro', count: 2 }
        };

        let questions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let answerResults = {};
        let correctCount = 0;
        let incorrectCount = 0;
        let selectedCategories = new Set();
        let shuffledOptions = {};

        function init() { renderCategories(); }

        function renderCategories() {
            const grid = document.getElementById('categoryGrid');
            grid.innerHTML = `<div class="category-chip selected" onclick="toggleAllCategories(this)" data-category="all"><div class="category-chip-name">üìö Todas</div><div class="category-chip-count">70 preguntas</div></div>`;
            Object.entries(categories).forEach(([key, value]) => {
                grid.innerHTML += `<div class="category-chip selected" onclick="toggleCategory('${key}', this)" data-category="${key}"><div class="category-chip-name">${value.name}</div><div class="category-chip-count">${value.count}</div></div>`;
            });
            selectedCategories = new Set(Object.keys(categories));
        }

        function toggleAllCategories(element) {
            const allChips = document.querySelectorAll('.category-chip');
            if (element.classList.contains('selected')) {
                allChips.forEach(chip => chip.classList.remove('selected'));
                selectedCategories.clear();
            } else {
                allChips.forEach(chip => chip.classList.add('selected'));
                selectedCategories = new Set(Object.keys(categories));
            }
        }

        function toggleCategory(category, element) {
            document.querySelector('[data-category="all"]').classList.remove('selected');
            if (selectedCategories.has(category)) {
                selectedCategories.delete(category);
                element.classList.remove('selected');
            } else {
                selectedCategories.add(category);
                element.classList.add('selected');
            }
            if (selectedCategories.size === Object.keys(categories).length) {
                document.querySelector('[data-category="all"]').classList.add('selected');
            }
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function shuffleOptionsForQuestion(question, qIndex) {
            const indices = question.options.map((_, i) => i);
            const shuffledIndices = shuffleArray(indices);
            const newCorrectIndex = shuffledIndices.indexOf(question.correct);
            shuffledOptions[qIndex] = { indices: shuffledIndices, correctIndex: newCorrectIndex };
        }

        function startExam() {
            if (selectedCategories.size === 0) { alert('Por favor selecciona al menos una categor√≠a'); return; }
            let limit = parseInt(document.getElementById('questionLimit').value) || 70;
            limit = Math.max(10, Math.min(70, limit));
            let filteredQuestions = allQuestions.filter(q => selectedCategories.has(q.category));
            filteredQuestions = shuffleArray(filteredQuestions);
            questions = filteredQuestions.slice(0, limit);
            shuffledOptions = {};
            questions.forEach((q, i) => shuffleOptionsForQuestion(q, i));
            currentQuestionIndex = 0;
            userAnswers = {};
            answerResults = {};
            correctCount = 0;
            incorrectCount = 0;
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('examScreen').classList.remove('hidden');
            document.getElementById('totalQuestions').textContent = questions.length;
            renderQuestionNav();
            renderQuestion();
            updateStats();
        }

        function renderQuestionNav() {
            const nav = document.getElementById('questionNav');
            nav.innerHTML = '';
            questions.forEach((_, index) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                if (index === currentQuestionIndex) btn.classList.add('current');
                if (answerResults[index] === true) btn.classList.add('correct');
                if (answerResults[index] === false) btn.classList.add('incorrect');
                btn.textContent = index + 1;
                btn.onclick = () => goToQuestion(index);
                nav.appendChild(btn);
            });
        }

        function goToQuestion(index) { currentQuestionIndex = index; renderQuestion(); renderQuestionNav(); }

        function updateStats() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('incorrectCount').textContent = incorrectCount;
            const progress = (Object.keys(userAnswers).length / questions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        function renderQuestion() {
            const question = questions[currentQuestionIndex];
            const shuffled = shuffledOptions[currentQuestionIndex];
            const isAnswered = userAnswers[currentQuestionIndex] !== undefined;
            const userAnswer = userAnswers[currentQuestionIndex];
            const isCorrect = answerResults[currentQuestionIndex];
            document.getElementById('currentQuestion').textContent = currentQuestionIndex + 1;
            document.getElementById('questionNumber').textContent = `Pregunta ${currentQuestionIndex + 1}`;
            document.getElementById('questionCategory').textContent = question.category;
            const diffBadge = document.getElementById('difficultyBadge');
            diffBadge.textContent = question.difficulty === 'hard' ? 'Dif√≠cil' : question.difficulty === 'medium' ? 'Media' : 'F√°cil';
            diffBadge.className = `difficulty-badge ${question.difficulty}`;
            const scenarioBox = document.getElementById('scenarioBox');
            scenarioBox.innerHTML = question.scenario ? `<div class="scenario-box">üìã <strong>Escenario:</strong><br>${question.scenario}</div>` : '';
            document.getElementById('questionText').innerHTML = question.question;
            const questionCard = document.getElementById('questionCard');
            questionCard.classList.remove('answered-correct', 'answered-incorrect');
            if (isAnswered) questionCard.classList.add(isCorrect ? 'answered-correct' : 'answered-incorrect');
            const optionsList = document.getElementById('optionsList');
            const letters = ['A', 'B', 'C', 'D', 'E'];
            optionsList.innerHTML = shuffled.indices.map((originalIndex, displayIndex) => {
                const option = question.options[originalIndex];
                let className = 'option';
                let feedback = '';
                if (isAnswered) {
                    className += ' disabled';
                    if (displayIndex === shuffled.correctIndex) {
                        className += ' correct';
                        feedback = displayIndex === userAnswer ? '<span class="option-feedback correct">‚úì ¬°Correcto!</span>' : '<span class="option-feedback correct">‚úì Correcta</span>';
                        if (displayIndex !== userAnswer) className += ' show-correct';
                    } else if (displayIndex === userAnswer) {
                        className += ' incorrect';
                        feedback = '<span class="option-feedback incorrect">‚úó Incorrecto</span>';
                    }
                }
                return `<div class="${className}" onclick="${isAnswered ? '' : `selectOption(${displayIndex})`}"><span class="option-letter">${letters[displayIndex]}</span><span class="option-text">${option}</span>${feedback}</div>`;
            }).join('');
            const feedbackContainer = document.getElementById('feedbackContainer');
            if (isAnswered) {
                let feedbackHTML = isCorrect ? '<div class="feedback-message correct"><span class="feedback-icon">‚úÖ</span><span>¬°Correcto!</span></div>' : '<div class="feedback-message incorrect"><span class="feedback-icon">‚ùå</span><span>Incorrecto</span></div>';
                if (question.explanation) feedbackHTML += `<div class="explanation"><strong>üìñ Explicaci√≥n:</strong> ${question.explanation}</div>`;
                feedbackContainer.innerHTML = feedbackHTML;
            } else feedbackContainer.innerHTML = '';
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            if (currentQuestionIndex === questions.length - 1) {
                document.getElementById('nextBtn').classList.add('hidden');
                document.getElementById('finishBtn').classList.remove('hidden');
            } else {
                document.getElementById('nextBtn').classList.remove('hidden');
                document.getElementById('finishBtn').classList.add('hidden');
            }
        }

        function selectOption(displayIndex) {
            if (userAnswers[currentQuestionIndex] !== undefined) return;
            const shuffled = shuffledOptions[currentQuestionIndex];
            const isCorrect = displayIndex === shuffled.correctIndex;
            userAnswers[currentQuestionIndex] = displayIndex;
            answerResults[currentQuestionIndex] = isCorrect;
            if (isCorrect) correctCount++; else incorrectCount++;
            updateStats();
            renderQuestion();
            renderQuestionNav();
        }

        function prevQuestion() { if (currentQuestionIndex > 0) { currentQuestionIndex--; renderQuestion(); renderQuestionNav(); } }
        function nextQuestion() { if (currentQuestionIndex < questions.length - 1) { currentQuestionIndex++; renderQuestion(); renderQuestionNav(); } }

        function finishExam() {
            const unanswered = questions.length - Object.keys(userAnswers).length;
            const score = Math.round((correctCount / questions.length) * 100);
            document.getElementById('examScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            document.getElementById('finalScore').textContent = `${score}%`;
            document.getElementById('finalCorrectCount').textContent = correctCount;
            document.getElementById('finalIncorrectCount').textContent = incorrectCount;
            document.getElementById('finalUnansweredCount').textContent = unanswered;
            let gradeText = '', gradeEmoji = '';
            if (score >= 90) { gradeText = 'Excelente'; gradeEmoji = 'üèÜ'; }
            else if (score >= 80) { gradeText = 'Muy Bien'; gradeEmoji = 'üéâ'; }
            else if (score >= 70) { gradeText = 'Aprobado'; gradeEmoji = '‚úÖ'; }
            else if (score >= 60) { gradeText = 'Necesita Mejorar'; gradeEmoji = 'üìö'; }
            else { gradeText = 'No Aprobado'; gradeEmoji = '‚ùå'; }
            document.getElementById('gradeText').textContent = `${gradeEmoji} ${gradeText}`;
        }

        function reviewAnswers() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('reviewScreen').classList.remove('hidden');
            const container = document.getElementById('reviewContainer');
            const letters = ['A', 'B', 'C', 'D', 'E'];
            container.innerHTML = questions.map((question, qIndex) => {
                const shuffled = shuffledOptions[qIndex];
                const userAnswer = userAnswers[qIndex];
                const isCorrect = answerResults[qIndex];
                const isUnanswered = userAnswer === undefined;
                return `<div class="question-card fade-in" style="animation-delay: ${qIndex * 0.02}s">
                    <div class="question-header">
                        <span class="question-number">Pregunta ${qIndex + 1}</span>
                        <span class="question-category">${question.category}</span>
                        <span class="difficulty-badge ${question.difficulty}">${question.difficulty === 'hard' ? 'Dif√≠cil' : question.difficulty === 'medium' ? 'Media' : 'F√°cil'}</span>
                        <span style="margin-left: auto; font-size: 1.5rem;">${isUnanswered ? '‚ö†Ô∏è' : (isCorrect ? '‚úÖ' : '‚ùå')}</span>
                    </div>
                    ${question.scenario ? `<div class="scenario-box">üìã <strong>Escenario:</strong><br>${question.scenario}</div>` : ''}
                    <p class="question-text">${question.question}</p>
                    <div class="options-list">${shuffled.indices.map((originalIndex, displayIndex) => {
                        const option = question.options[originalIndex];
                        let className = 'option disabled';
                        let feedback = '';
                        if (displayIndex === shuffled.correctIndex) { className += ' correct'; feedback = '<span class="option-feedback correct">‚úì Correcta</span>'; }
                        else if (displayIndex === userAnswer && !isCorrect) { className += ' incorrect'; feedback = '<span class="option-feedback incorrect">Tu respuesta</span>'; }
                        return `<div class="${className}"><span class="option-letter">${letters[displayIndex]}</span><span class="option-text">${option}</span>${feedback}</div>`;
                    }).join('')}</div>
                    ${question.explanation ? `<div class="explanation"><strong>üìñ Explicaci√≥n:</strong> ${question.explanation}</div>` : ''}
                </div>`;
            }).join('');
        }

        function backToResults() { document.getElementById('reviewScreen').classList.add('hidden'); document.getElementById('resultsScreen').classList.remove('hidden'); }

        function restartExam() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('reviewScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
            questions = []; currentQuestionIndex = 0; userAnswers = {}; answerResults = {}; correctCount = 0; incorrectCount = 0; shuffledOptions = {};
            renderCategories();
        }

        init();
    </script>
</body>
</html>
